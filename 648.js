(self["webpackChunkfireformily"]=self["webpackChunkfireformily"]||[]).push([[648],{74976:function(e,l,t){"use strict";t.r(l),t.d(l,{Dict:function(){return Oe},ImageView:function(){return Ue},Linkage:function(){return We},Loading:function(){return el},LongText:function(){return De},PopActions:function(){return F},QueryForm:function(){return M},QueryList:function(){return q},QueryTable:function(){return Ce},Suggestion:function(){return Me},TreeBase:function(){return Nl},TreeNodes:function(){return ql},colors:function(){return _e},dict:function(){return Jl},dictEffects:function(){return Wl},eqeq:function(){return Ne},getTreeHelper:function(){return sl},isColorStatus:function(){return Se},registerDictLoader:function(){return Ql},takeTake:function(){return $e},useLive:function(){return Xl}});var r=t(13378),n=t(2812),o=t(67294),a=t(48429),i=()=>{},s=e=>{var l,t,r=e.field,n=e.loading,s=e.open,d=e.scope,u=void 0!==(null===d||void 0===d?void 0:d.$index),c=n?i:s;return"visible"!==r.display?null:o.createElement(a.Z,{onClick:c,size:u?"small":null===(l=r.componentProps)||void 0===l?void 0:l.size,type:u?"link":null===(t=r.componentProps)||void 0===t?void 0:t.type},null===r||void 0===r?void 0:r.title)},d=t(44742),u=t(52663),c=t(49229),v=t(18042),p=t(45733),m=t(96730),f=t(74342),g=t(3911),h=t(49650),y=["pageSize","current"],b=()=>{},k=(0,o.createContext)(null),E=o.memo((e=>{var l,t=(0,v.useForm)(),r=(0,o.useRef)({}),n=(0,h.Z)(),a=(0,d.default)(n,2),i=a[0],s=a[1],c=(0,o.useRef)(!1),p=(0,v.useExpressionScope)(),f=(0,o.useRef)(!1),E=(0,o.useRef)({service:e.service}),j=(0,o.useCallback)((l=>{var n=E.current.service;if(r.current=l,e.syncUrl){var o=l||{pagination:{}},a=o.pagination,i=a.pageSize,d=a.current,c=o.params;s((e=>{var l=(0,u.Z)({},e);return Object.keys(l).forEach((e=>{l[e]=void 0})),(0,u.Z)((0,u.Z)((0,u.Z)({},l),c),{},{pageSize:i,current:d})}))}return C.current._loading=!0,n((0,u.Z)((0,u.Z)({},l),{},{scope:p})).then((e=>{var l=e.list,r=e.total,n=C.current._address.table,o=t.query(n).take();return n?(o.setState((e=>{(0,m.batch)((()=>{e.value=l,e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.total=r}))})),{list:l,total:r}):{list:[],total:0}})).finally((()=>{C.current._loading=!1}))}),[t,e.syncUrl,p,s]),x=(0,o.useCallback)((()=>{var e=C.current._address.query,l=t.query(e).take(),r=C.current._address.table,n=t.query(r).take();return j((0,u.Z)({params:null===l||void 0===l?void 0:l.value},null===n||void 0===n?void 0:n.data))}),[j,t]),Z=(0,o.useCallback)((()=>{var e=r.current;return j(e)}),[j]),R=(0,o.useCallback)((()=>{var e,l,r,n=null===C||void 0===C||null===(e=C.current)||void 0===e||null===(l=e._address)||void 0===l?void 0:l.table;n&&(null===(r=t.query(n).take())||void 0===r||r.setState((e=>{(0,m.batch)((()=>{e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.current=1}))})));return x()}),[x,t]),C=(0,o.useRef)((0,m.observable)((0,u.Z)((0,u.Z)({},e),{},{service:e.service?j:void 0,syncUrl:e.syncUrl,pageSize:e.pageSize,_refresh:e.service?Z:void 0,_reset:e.service?R:void 0,_trigger:e.service?x:void 0,_address:{query:"",table:""},_scope:p,_cofnig:{_size:null!==(l=e.size)&&void 0!==l?l:"default",_columns:[],_showColumns:[],_selectedRows:[],_selectedRowKeys:[],_selectClear:b,_selectReverse:b}})));return(0,o.useEffect)((()=>{if(e.syncUrl&&!c.current){var l,r,n=C.current._address,o=i||{},a=o.pageSize,s=(o.current,(0,g.Z)(o,y));if(a&&null!==n&&void 0!==n&&n.table)null===(l=t.query(n.table).take())||void 0===l||l.setState((e=>{(0,m.batch)((()=>{e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.pageSize=Number(i.pageSize),e.data.pagination.current=Number(i.current)}))}));if(s&&Object.keys(s).length>0&&null!==n&&void 0!==n&&n.query)null===(r=t.query(n.query).take())||void 0===r||r.setState((e=>{e.value=(0,u.Z)((0,u.Z)({},e.value),s)}));null!==n&&void 0!==n&&n.table&&setTimeout((()=>{c.current=!0}),0)}}),[t,e.syncUrl,i]),(0,o.useEffect)((()=>{if(E.current.service){var e=(0,m.autorun)((()=>{var e,l=null===(e=C.current._address)||void 0===e?void 0:e.table;!1===f.current&&l&&!1!==C.current.autoload&&setTimeout((()=>{x(),f.current=!0}))}));return()=>{e()}}}),[x]),(0,o.useEffect)((()=>{var l=C.current;l.autoload!==e.autoload&&(l.autoload=e.autoload),l.filterRemote!==e.filterRemote&&(l.filterRemote=e.filterRemote),l.sortRemote!==e.sortRemote&&(l.sortRemote=e.sortRemote),l.syncUrl!==e.syncUrl&&(l.syncUrl=e.syncUrl)}),[e.autoload,e.filterRemote,e.sortRemote,e.syncUrl]),o.createElement(k.Provider,{value:C.current},o.createElement(v.ExpressionScope,{value:{get $query(){var e,l=null===(e=C.current._address)||void 0===e?void 0:e.query;return l?t.query(l).take().value:null},get $list(){var e,l=null===(e=C.current._address)||void 0===e?void 0:e.table;return l?t.query(l).take().value:null}}},e.children))})),j=()=>{var e=(0,o.useContext)(k);return e},x=()=>new Promise((e=>{setTimeout((()=>{e("")}),0)})),Z=e=>(0,m.isObservable)(e)?e:Array.isArray(e)?[...e]:(0,u.Z)({},e),R=()=>Promise.resolve({}),C=e=>Promise.resolve((0,u.Z)({},e)),w=()=>{var e,l=(0,v.useExpressionScope)(),t=(0,v.useField)(),r=j(),n=null===t||void 0===t||null===(e=t.componentProps)||void 0===e?void 0:e.actions,i=(0,o.useRef)({open:!1,reset:!1,submit:!1}),s=(0,v.useFieldSchema)(),u=(0,f.Z)(n||{}),m=(0,o.useState)(!1),g=(0,d.default)(m,2),h=g[0],y=g[1],b=(0,o.useState)(!1),k=(0,d.default)(b,2),E=k[0],w=k[1],_=(0,o.useCallback)((()=>{if(!t.disabled&&!E&&!i.current.open){i.current.open=!0;var e=u.current.load||C;return w(!0),e(l).then((e=>{t.setState((l=>{l.value=Z(e)})),y(!0)})).finally((()=>{i.current.open=!1,w(!1)}))}}),[t,E,u,l]),S=(0,o.useCallback)((()=>{if(!t.disabled&&!E&&h&&!i.current.reset){i.current.reset=!0;var e=(0,c.JF)(t)?R:()=>t.reset(),r=u.current.cancel||R;return e().then((()=>r(l))).then((()=>{y(!1)})).finally((()=>{i.current.reset=!1,w(!1)}))}}),[t,E,u,l,h]),$=(0,o.useCallback)((()=>{if(!t.disabled&&!E&&h&&!i.current.submit){i.current.submit=!0;var e=(0,c.JF)(t)?R:()=>t.submit(),n=(0,c.JF)(t)?R:()=>t.reset(),o=u.current.submit||R;return e().then((e=>o(e,l))).then((()=>(y(!1),x().then(n)))).finally((()=>{var e;w(!1),i.current.submit=!1,null===r||void 0===r||null===(e=r._refresh)||void 0===e||e.call(r)}))}}),[r,t,E,u,l,h]),P=(0,o.useMemo)((()=>t.content?t.content:null),[t.content]),A=(0,o.useMemo)((()=>s?o.createElement(o.Fragment,null,o.createElement(v.RecursionField,{schema:s})):null),[s]),N=(0,o.useMemo)((()=>o.createElement(p.Z,{style:{display:"flex",justifyContent:"flex-end",marginBottom:"16px"}},o.createElement(a.Z,{loading:E,onClick:S},"\u53d6\u6d88"),o.createElement(a.Z,{loading:E,onClick:$,type:"primary"},"\u786e\u5b9a"))),[E,S,$]);return{submit:$,field:t,reset:S,open:_,visible:h,loading:E,body:A,header:P,footer:N,scope:l}},_=e=>{var l=w(),t=l.body,a=l.field,i=l.footer,d=l.header,u=l.loading,c=l.scope,v=l.open,p=l.reset,m=l.visible;return o.createElement(o.Fragment,null,o.createElement(n.Z,(0,r.Z)({width:"68.88%",closable:!0,keyboard:!0},e,{title:e.title||a.title,onClose:l=>{var t;p(),null===e||void 0===e||null===(t=e.onClose)||void 0===t||t.call(e,l)},open:m,afterOpenChange:l=>{var t;l||p(),null===e||void 0===e||null===(t=e.afterOpenChange)||void 0===t||t.call(e,l)},footer:i}),d,t),o.createElement(s,{open:v,field:a,loading:u,scope:c}))},S=t(86444),$=e=>{var l=w(),t=l.visible,n=l.body,a=l.field,i=l.scope,d=l.footer,u=l.header,c=l.loading,v=l.open,p=l.reset;return o.createElement(o.Fragment,null,o.createElement(S.Z,(0,r.Z)({maskClosable:!1,keyboard:!1,closable:!1,width:"68.88%"},e,{afterClose:()=>{var l;null===e||void 0===e||null===(l=e.afterClose)||void 0===l||l.call(e),p()},open:t,title:e.title||a.title,footer:d}),u,n),o.createElement(s,{open:v,field:a,loading:c,scope:i}))},P=t(7523),A=e=>{var l=w(),t=l.body,n=l.field,a=l.header,i=l.loading,d=l.scope,u=l.open,c=l.reset,v=l.submit,p=l.visible;return o.createElement(P.Z,(0,r.Z)({},e,{title:o.createElement(o.Fragment,null,o.createElement("h4",null,n.title||a),n.title?null:a,t),cancelButtonProps:{loading:i},okButtonProps:{loading:i},onCancel:c,onConfirm:v,open:p,onOpenChange:l=>{var t;l||c(),null===e||void 0===e||null===(t=e.onOpenChange)||void 0===t||t.call(e,l)}}),o.createElement(s,{open:u,field:n,loading:i,scope:d}))},N=t(56466),z=e=>{var l=w(),t=l.body,n=l.field,a=l.scope,i=l.footer,d=l.header,u=l.loading,c=l.open,v=l.reset,p=l.visible;return console.log("--popovver",{visible:p}),o.createElement(N.Z,(0,r.Z)({},e,{trigger:"click",title:e.title||n.title,content:o.createElement(o.Fragment,null,d,t,i),open:p,onOpenChange:l=>{var t;null===e||void 0===e||null===(t=e.onOpenChange)||void 0===t||t.call(e,l),l||v()}}),o.createElement(s,{open:c,field:n,loading:u,scope:a}))},F=$;F.Drawer=_,F.Modal=$,F.Popconfirm=A,F.Popover=z;var O,T=t(36158),K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=e.maxRows||1,t=(0,o.useMemo)((()=>T.T5.createFormGrid({maxColumns:e.maxColumns||4,maxWidth:e.maxWidth||320,maxRows:l,shouldVisible:(e,r)=>e.index===t.childSize-1||(r.maxRows===1/0||e.shadowRow<l+1)})),[e.maxColumns,e.maxWidth,l]),r=t.fullnessLastColumn?t.shadowRows-1:t.shadowRows,n=r<=l?void 0:t.maxRows===1/0,a=()=>{t.maxRows===1/0?t.maxRows=l:t.maxRows=1/0};return{grid:t,expanded:n,toggle:a}},M=(0,v.observer)((e=>{var l,t=e.resetText,n=e.submitText,i=(0,v.useField)(),s=(0,v.useForm)(),d=K(e.grid),u=d.grid,c=d.expanded,p=d.toggle,m=j(),f=m||{},g=f._loading,h=(f._refresh,f._reset),y=f._trigger,b=()=>{var e;g||(m?s.reset(null===(e=m._address)||void 0===e?void 0:e.query,{forceClear:!0,validate:!1}).then((()=>{null===h||void 0===h||h()})):setTimeout((()=>{null===h||void 0===h||h()})))},k=()=>{if(!g)return null===y||void 0===y?void 0:y()};(0,o.useEffect)((()=>{m&&(m._address.query=i.address.toString())}),[m,null===i||void 0===i||null===(l=i.address)||void 0===l?void 0:l.toString()]);var E=()=>o.createElement(T.d5,{align:"right",style:{width:"100%",marginBottom:"22px",display:"flex",justifyContent:"flex-end"}},void 0!==c?o.createElement(a.Z,{type:"link",onClick:e=>{e.preventDefault(),p()}},c?"\u6536\u8d77":"\u5c55\u5f00"):null,o.createElement(a.Z,{onClick:b},t||"\u91cd\u7f6e"),o.createElement(a.Z,{onClick:k,type:"primary"},n||"\u67e5\u8be2"));return e.children?o.createElement(T.T5,(0,r.Z)({},u,{grid:u}),e.children,o.createElement(T.T5.GridColumn,{gridSpan:-1,style:{display:"flex",justifyContent:"space-between"}},E())):null})),q=e=>o.createElement(E,e,e.children),D=t(39941),I=t(33634),L=e=>{var l=e.items||e,t=l.reduceProperties(((e,l)=>{var t;return e||("QueryTable"===l["x-component"]?null:(null===(t=l["x-component"])||void 0===t?void 0:t.indexOf("SortHandle"))>-1?l:l.properties||l.items?L(l):e)}));return t},U=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Column"))>-1},B=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Operations"))>-1},J=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Addition"))>-1},H=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Expand"))>-1},V=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Selection"))>-1},Q=()=>{var e=(0,v.useFieldSchema)();return e.reduceProperties(((e,l,t)=>J(l)?o.createElement(v.RecursionField,{schema:l,name:t}):e),null)},W=t(5085),G=t.n(W),X=t(62878),Y=t(91522),ee=t(2291),le=T.wR,te=(e,l)=>{if(!e)return[];var t=[],r=(0,X.isArr)(e)?e:[e];return r.reduce(((e,t)=>{var r=l(t);return r?e.concat(r):e}),t)},re=(e,l,t,r)=>{var n=Object.keys(l.properties||{}).length,a=e.maxItems||2,i=n>a?o.createElement(Y.Z,{mode:"vertical",items:l.mapProperties(((e,l,r)=>r<a?null:{key:r,label:o.createElement(v.RecursionField,{schema:e,name:"".concat(t,".").concat(l)})})).filter(Boolean)}):void 0;return o.createElement(le.Item,{index:t,record:()=>{var e;return null===r||void 0===r||null===(e=r.value)||void 0===e?void 0:e[t]}},o.createElement(p.Z,{size:"small"},l.mapProperties(((e,l,r)=>r>=a?null:o.createElement(v.RecursionField,{key:"".concat(t,".").concat(l),schema:e,name:"".concat(t,".").concat(l)}))),n>a?o.createElement(ee.Z,{overlay:i},o.createElement("a",null,o.createElement(G(),null))):null))},ne=e=>{var l=j(),t=(0,v.useFieldSchema)(),r=l=>{if(U(l)||B(l)||J(l)){var t,n,o;if((null===(t=l["x-component-props"])||void 0===t||!t.dataIndex)&&!l.name)return[];var a=(null===(n=l["x-component-props"])||void 0===n?void 0:n.dataIndex)||l.name,i=e.query(e.address.concat(a)).take(),s=(null===i||void 0===i||null===(o=i.component)||void 0===o?void 0:o[1])||l["x-component-props"]||{},d=(null===i||void 0===i?void 0:i.display)||l["x-display"];return[{name:a,display:d,field:i,schema:l,columnProps:s}]}return l.properties?l.reduceProperties(((e,l)=>e.concat(r(l))),[]):[]};if(!t)throw new Error("can not found schema object");var n=te(t.items,r),a=n.reduce(((t,r,n)=>{var a,i=r.name,s=r.columnProps,d=r.schema,c=r.display;return l&&l._cofnig&&(null===l||void 0===l?void 0:l._cofnig._showColumns.length)>0&&-1===(null===l||void 0===l||null===(a=l._cofnig._showColumns)||void 0===a?void 0:a.findIndex((e=>e===i)))||"hidden"===c?t:B(d)?t.concat((0,u.Z)((0,u.Z)({fixed:!0},s),{},{key:n,dataIndex:i,render:(l,t)=>{var r,n=null===e||void 0===e||null===(r=e.value)||void 0===r?void 0:r.indexOf(t);return re(s,d,n,e)}})):U(d)?t.concat((0,u.Z)((0,u.Z)({},s),{},{filters:Array.isArray(s.filters)?s.filters:void 0,key:i,dataIndex:i,render:(l,t)=>{var r,n=null===e||void 0===e||null===(r=e.value)||void 0===r?void 0:r.indexOf(t),a=o.createElement(le.Item,{index:n,record:()=>{var l;return null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l[n]}},o.createElement(v.RecursionField,{schema:d,name:n,onlyRenderProperties:!0}));return a}})):t}),[]),i=()=>n.map(((e,l)=>U(e.schema)?o.createElement(v.RecursionField,{key:l,schema:e.schema,name:e.name,onlyRenderSelf:!0}):null));return[a,i]},oe=e=>{var l;return"QueryList"===(null===(l=e.parent)||void 0===l?void 0:l["x-component"])?e.parent:e.parent?oe(e.parent):null},ae=e=>{if(e){var l=e.reduceProperties(((e,l)=>{if(e)return e;var t="QueryTable.Selection"===l["x-component"];return!!t||!!l.properties&&ae(l)}),!1);return l}return!1},ie=(e,l)=>{var t=(0,v.useField)(),r=j(),n=(0,v.useFieldSchema)(),a=ae(oe(n)),i=(0,o.useRef)(e);(0,o.useEffect)((()=>{i.current=e}),[e]);var s=(0,o.useCallback)((()=>{var e,n;if(r&&(a||l)){var o=r._cofnig,s=(0,m.observable)((0,u.Z)((0,u.Z)({type:"checkbox"},l),{},{selectedRows:null!==(e=o._selectedRows)&&void 0!==e?e:[],selectedRowKeys:null!==(n=o._selectedRowKeys)&&void 0!==n?n:[],clear:()=>{o._selectedRowKeys=[],o._selectedRows=[]},reverse:()=>{var e=t.value,l=e.filter((e=>!o._selectedRows.find((l=>l===e)))),r=l.map((e=>{var l="function"==typeof i.current?i.current(e):e[i.current];return l}));o._selectedRowKeys=r,o._selectedRows=l},onChange:(e,l)=>{o._selectedRowKeys=e,o._selectedRows=l}}));return o._selectReverse=s.reverse,o._selectClear=s.clear,s}}),[r,t.value,a,l]);return s()},se=t(49194),de=()=>{var e=j(),l=(0,v.useFieldSchema)(),t=l.reduceProperties(((l,t,r)=>(V(t)&&l.push(o.createElement(v.RecordScope,{key:r,getRecord:()=>{var l,t,r,n;return{selectedRowKeys:null!==(l=null===e||void 0===e||null===(t=e._cofnig)||void 0===t?void 0:t._selectedRowKeys)&&void 0!==l?l:[],selectedRows:null!==(r=null===e||void 0===e||null===(n=e._cofnig)||void 0===n?void 0:n._selectedRows)&&void 0!==r?r:[]}},getIndex:()=>-1},o.createElement(p.Z,{split:o.createElement(se.Z,{type:"vertical"})},t.mapProperties(((e,l)=>o.createElement(v.RecursionField,{key:l,schema:e,name:l})))))),l)),[]);return t.length>0?t:null},ue=t(98072),ce=t(24750),ve=(0,ce.W8)((e=>o.createElement("tr",e))),pe=(0,ce.JN)((e=>o.createElement("tbody",e))),me=e=>o.createElement(ve,(0,r.Z)({index:e["data-row-sort-index"]||0},e)),fe=(e,l)=>{var t=document.body.querySelector(".".concat(l,"-sort-helper"));if(t){var r=e.querySelectorAll("td");requestAnimationFrame((()=>{t.querySelectorAll("td").forEach(((e,l)=>{r[l]&&(e.style.width=getComputedStyle(r[l]).width)}))}))}},ge=e=>{var l=(0,ue.usePrefixCls)("formily-array-table"),t=(0,v.useField)(),n=(0,v.useFieldSchema)(),a=(0,v.useExpressionScope)(),i=(0,o.useMemo)((()=>L(n)),[n]),s=j(),d=(0,o.useCallback)((n=>o.createElement(pe,(0,r.Z)({useDragHandle:!0,lockAxis:"y",helperClass:"".concat(l,"-sort-helper"),helperContainer:()=>{var l;return null===(l=e.current)||void 0===l?void 0:l.querySelector("tbody")},onSortStart:e=>{var t=e.node;fe(t,l)},onSortEnd:e=>{var l,r=e.oldIndex,n=e.newIndex,o=null===(l=t.componentProps)||void 0===l?void 0:l.onSort;if("function"===typeof o){var i=o(r,n,(0,m.toJS)(t.value),a);i instanceof Promise?(t.setLoading(!0),t.move(r,n),i.then((e=>{var l;e&&(null===s||void 0===s||null===(l=s._refresh)||void 0===l||l.call(s));t.setLoading(!1)})).catch((()=>{t.move(n,r),t.setLoading(!1)}))):t.move(r,n)}else t.move(r,n)}},n))),[s,t,e,l,a]),u={wrapper:i?d:void 0,row:i?me:void 0};return u},he=T.wR,ye=e=>{var l=(0,v.useField)(),t=(0,v.useFieldSchema)(),r=t.reduceProperties(((e,l,t)=>H(l)?l:e),null),n=(0,o.useMemo)((()=>{if(r)return(0,u.Z)((0,u.Z)({},e),{},{expandedRowRender:(e,t,n,a)=>o.createElement(he.Item,{key:a?"expand-".concat(new Date):"hidden-".concat(t),index:t,record:()=>{var e;return null===l||void 0===l||null===(e=l.value)||void 0===e?void 0:e[t]}},o.createElement(v.RecursionField,{schema:r,name:t,onlyRenderProperties:!0}))})}),[null===l||void 0===l?void 0:l.value,r,e]);return n},be=t(59879),ke=t(17828),Ee=t(24616),je=t(42091),xe=t(45904),Ze=t(43732),Re=(0,v.observer)((e=>{var l=(0,v.useField)(),t=j();if(!t)return null;var r=null===t||void 0===t?void 0:t._cofnig,n=o.createElement(Y.Z,{selectable:!0,onSelect:e=>{r._size=e.key},defaultValue:r._size,items:[{label:"\u9ed8\u8ba4",key:"default"},{label:"\u4e2d\u7b49",key:"middle"},{label:"\u7d27\u51d1",key:"small"}]}),i=de(),s=o.createElement(Y.Z,{selectable:!0,multiple:!0,items:r._columns.map((e=>{var l=r._showColumns.findIndex((l=>l===e.key)),t=l>-1,n=n=>{n.stopPropagation(),n.preventDefault(),t?r._showColumns.splice(l,1):r._showColumns.push(e.key)};return{label:o.createElement(p.Z,{onClick:n},o.createElement(je.Z,{checked:t}),e.label),key:e.key}}))});return o.createElement(p.Z,{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"}},o.createElement(p.Z,{size:"small"},o.createElement(xe.Z.Title,{level:5},l.title||e.title),r._selectedRowKeys.length?o.createElement(Ze.Z,{style:{padding:"3px 4px"},type:"info",message:o.createElement(p.Z,{size:"small",split:o.createElement(se.Z,{type:"vertical"})},o.createElement(a.Z,{type:"text",size:"small"},"\u9009\u4e2d ",r._selectedRowKeys.length," \u9879"),o.createElement(a.Z,{size:"small",onClick:()=>{var e;null===(e=r._selectClear)||void 0===e||e.call(r)},type:"link"},"\u53d6\u6d88\u9009\u62e9"),o.createElement(a.Z,{size:"small",onClick:()=>{var e;null===(e=r._selectReverse)||void 0===e||e.call(r)},type:"link"},"\u53cd\u5411\u9009\u62e9"),i)}):null),o.createElement(p.Z,{size:"small"},o.createElement(p.Z,null,e.children),o.createElement(p.Z,{size:"large"},o.createElement(be.Z,{onClick:()=>{var e;null===t||void 0===t||null===(e=t._refresh)||void 0===e||e.call(t)},loop:null===t||void 0===t?void 0:t._loading}),o.createElement(ee.Z,{key:"size",overlay:n},o.createElement(ke.Z,null)),o.createElement(ee.Z,{key:"columns",overlay:s},o.createElement(Ee.Z,null)))))})),Ce=(0,v.observer)((e=>{var l,t,n=(0,o.useRef)(null),a=(0,D.F)("formily-array-table"),i=j(),s=(0,v.useField)(),c=Array.isArray(s.value)?s.value.slice():[],p=e=>c.indexOf(e),m=ge(n),f=ne(s),g=(0,d.default)(f,2),h=g[0],y=g[1],b=Q(),k=ye(e.expandable),E=ie(e.rowKey||p,e.rowSelection);(0,o.useEffect)((()=>{i&&(i._address.table=s.address.toString())}),[i,null===s||void 0===s||null===(l=s.address)||void 0===l?void 0:l.toString()]),(0,o.useEffect)((()=>{null!==i&&void 0!==i&&i.service&&s&&!s.data&&(s.data={},s.data.pagination={current:1,pageSize:i.pageSize||10})}),[i,s,e.pagination]),(0,o.useEffect)((()=>{if(i){var e=i._cofnig;h.forEach((l=>{-1===e._columns.findIndex((e=>e.key===l.dataIndex))&&(e._columns.push({label:l.title,key:l.dataIndex}),e._showColumns.push(l.dataIndex))}))}}),[h,i]);var x=()=>{var l,t=null===s||void 0===s||null===(l=s.data)||void 0===l?void 0:l.pagination,r=e.pagination||{},n=!!t&&(!(t.pageSize>t.total)&&(0,u.Z)((0,u.Z)((0,u.Z)({},r),t),{},{showTotal:(e,l)=>"\u7b2c ".concat(l[0],"-").concat(l[1]," \u6761, \u5171 ").concat(e," \u6761\u6570\u636e")}));return n};return o.createElement("div",{ref:n,className:a},o.createElement(T.wR,null,o.createElement(I.Z,(0,r.Z)({rowKey:p},e,{size:null===i||void 0===i||null===(t=i._cofnig)||void 0===t?void 0:t._size,expandable:k,rowSelection:E,onRow:(l,t)=>{var r,n=(null===e||void 0===e||null===(r=e.onRow)||void 0===r?void 0:r.call(e,l,t))||{};return n["data-row-sort-index"]=t,n},columns:h,loading:e.loading||(null===i||void 0===i?void 0:i._loading),components:{body:m},dataSource:c,pagination:x(),onChange:(e,l,t,r)=>{var n;if(s.setData({pagination:e,filters:l,sorter:t,extra:r}),"paginate"===r.action)null===i||void 0===i||null===(n=i._trigger)||void 0===n||n.call(i);else if("sort"===r.action&&null!==i&&void 0!==i&&i.sortRemote){var o;null===i||void 0===i||null===(o=i._trigger)||void 0===o||o.call(i)}else if("filter"===r.action&&null!==i&&void 0!==i&&i.filterRemote){var a;null===i||void 0===i||null===(a=i._trigger)||void 0===a||a.call(i)}}})),y(),b))}));null===T.wR||void 0===T.wR||null===(O=T.wR.mixin)||void 0===O||O.call(T.wR,Ce),Ce.Operations=()=>o.createElement(o.Fragment,null),Ce.Column=()=>o.createElement(o.Fragment,null),Ce.Expand=()=>o.createElement(o.Fragment,null),Ce.Selection=()=>o.createElement(o.Fragment,null),Ce.Titlebar=Re;var we={success:"green",processing:"blue",error:"red",warning:"gold",default:"#fafafa"},_e=(0,u.Z)({length:11,0:"magenta",1:"green",2:"cyan",3:"geekblue",4:"purple",5:"red",6:"orange",7:"lime",8:"blue",9:"volcano",10:"gold",magenta:"magenta",green:"green",cyan:"cyan",geekblue:"geekblue",purple:"purple",red:"red",orange:"orange",lime:"lime",blue:"blue",volcano:"volcano",gold:"gold"},we),Se=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Boolean(we[e])},$e=e=>l=>({get key(){return l?l[e.key]:l},set key(t){"object"===typeof l&&(l[e.key]=t)},get title(){return l?l[e.title]:l},set title(t){"object"===typeof l&&(l[e.title]=t)},get children(){return l?l[e.children]:l},set children(t){"object"===typeof l&&(l[e.children]=t)}}),Pe=Object.prototype.hasOwnProperty;function Ae(e,l){return e===l?0!==e||0!==l||1/e===1/l:e!==e&&l!==l}function Ne(e,l){if(Ae(e,l))return!0;if("object"!==typeof e||null===e||"object"!==typeof l||null===l)return!1;var t=Object.keys(e),r=Object.keys(l);if(t.length!==r.length)return!1;for(var n=0;n<t.length;n++)if(!Pe.call(l,t[n])||!Ae(e[t[n]],l[t[n]]))return!1;return!0}var ze=t(33227),Fe=t(74356),Oe=e=>{var l=e.strict,t=e.type,r=e.value,n=e.options,a=(0,o.useMemo)((()=>{if(!Array.isArray(n))return[];var e=Array.isArray(r)?r.map((e=>n.find((t=>l?t.value===e:t.value==e)))):[n.find((e=>l?e.value===r:e.value==r))];return e.filter(Boolean)}),[n,l,r]);return o.createElement(p.Z,{size:"small"},a.map((e=>"badge"===t?o.createElement(ze.Z,{key:null===e||void 0===e?void 0:e.key,status:Se(null===e||void 0===e?void 0:e.color)?null===e||void 0===e?void 0:e.color:void 0,color:Se(null===e||void 0===e?void 0:e.color)||null===e||void 0===e?void 0:e.color,text:null===e||void 0===e?void 0:e.label}):"tag"===t?o.createElement(Fe.Z,{key:null===e||void 0===e?void 0:e.key,color:null===e||void 0===e?void 0:e.color},null===e||void 0===e?void 0:e.label):null===e||void 0===e?void 0:e.label)))},Te=t(90407),Ke=(e,l)=>{var t=l;return e&&(t=Array.isArray(l)?l:[]),t},Me=e=>{var l=(0,o.useState)([]),t=(0,d.default)(l,2),r=t[0],n=t[1],a=(0,o.useState)(Ke(e.multiple,e.value)),i=(0,d.default)(a,2),s=i[0],c=i[1],v=(0,o.useState)(!1),p=(0,d.default)(v,2),m=p[0],f=p[1],g=(0,o.useRef)(e.suggest);(0,o.useEffect)((()=>{e.suggest&&(g.current=e.suggest)}),[e.suggest]);var h=(0,o.useRef)(null),y=(0,o.useRef)(0),b=(0,o.useCallback)((e=>{var l=++y.current;h.current&&clearTimeout(h.current),h.current=setTimeout((()=>{var t,r;f(!0),g.current||f(!1),null===(t=g.current)||void 0===t||null===(r=t.call(g,e))||void 0===r||r.then((e=>{l<y.current||n(e)})).finally((()=>{f(!1)}))}),200)}),[]),k=l=>{g.current&&(l?b((0,u.Z)((0,u.Z)({},e.params),{},{kw:l})):n([]))},E=l=>{var t;c(l),null===(t=e.onChange)||void 0===t||t.call(e,l)};return o.createElement(Te.Z,{showSearch:!0,loading:m,value:s,labelInValue:e.labelInValue,mode:e.multiple?"multiple":void 0,placeholder:e.placeholder,style:e.style,disabled:e.disabled,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:k,onChange:E,options:r})},qe=xe.Z.Paragraph,De=e=>o.createElement(qe,(0,r.Z)({copyable:!0,ellipsis:!0},e),e.value),Ie=t(69131),Le={width:"60px",height:"60px",objectFit:"contain"},Ue=e=>{var l=e.value,t=e.style,r=(0,o.useMemo)((()=>{var e=Array.isArray(l)?l:[l];return e.filter(Boolean)}),[l]),n=(0,o.useMemo)((()=>(0,u.Z)((0,u.Z)({},Le),t)),[t]);return o.createElement(o.Fragment,null,o.createElement(Ie.Z.PreviewGroup,null,r.map((e=>o.createElement(Ie.Z,{style:n,key:e,src:e,preview:!0})))))},Be=t(79594),Je=["value","loadAll","labelInValue","disabled","multiple","onChange","loadData"],He={width:"100%"},Ve=(e,l)=>e&&Array.isArray(l)&&l.length>0?null===l||void 0===l?void 0:l.reduceRight(((e,l)=>e?(l.children=e,l.__init=!0,[l]):(l.isLeaf=!0,[l])),null):[],Qe=e=>{var l=e.loadData,t=e.loadAll,r=e.value,n=e.labelInValue,a=(0,f.Z)(t||l),i=(0,o.useMemo)((()=>(0,m.observable)({inited:!1,loading:!1,options:Ve(n,r),load:e=>{var l,t,r=e[e.length-1];r&&(r.loading=!0,i.loading=!0,null===(l=a.current)||void 0===l||null===(t=l.call(a,e).then((e=>{e?r.children=e.map((e=>(0,u.Z)({isLeaf:!1},e))):r.isLeaf=!0})))||void 0===t||t.finally((()=>{r.loading=!1,i.loading=!1})))}})),[]);if(!i.inited&&!i.loading){var s,d,c;i.loading=!0,i.inited=!0;var v=Array.isArray(r)?n?r:r.map((e=>({value:e}))):[];null===(s=a.current)||void 0===s||null===(d=s.call(a,v))||void 0===d||null===(c=d.then((e=>{e&&(i.options=e.map((e=>(0,u.Z)({isLeaf:!1},e))))})))||void 0===c||c.finally((()=>{i.loading=!1}))}return i},We=e=>{var l=e.value,t=e.loadAll,n=e.labelInValue,a=e.disabled,i=e.multiple,s=e.onChange,d=(e.loadData,(0,g.Z)(e,Je)),u=Qe(e),c=(0,o.useCallback)(((e,l)=>n?null===s||void 0===s?void 0:s(l):null===s||void 0===s?void 0:s(e)),[n,s]),p=e=>Array.isArray(e)?e.map((e=>Array.isArray(e)?p(e):e.label?e.value:e)):[];return o.createElement(v.Observer,null,(()=>o.createElement(Be.Z,(0,r.Z)({disabled:a,multiple:i,changeOnSelect:!0},d,{loading:u.loading,value:p(l),style:e.style||He,options:[...u.options],loadData:t?void 0:u.load,onChange:c}))))},Ge=t(54943),Xe=t(81505),Ye={position:"absolute",transition:"all ease 0.2s"},el=e=>{var l=(0,o.useState)(!0),t=(0,d.default)(l,2),r=t[0],n=t[1];return(0,o.useLayoutEffect)((()=>{setTimeout((()=>{n(!1)}),67)}),[]),o.createElement(Xe.Z,{style:(0,u.Z)((0,u.Z)({},Ye),{},{display:r?"":"none"}),paragraph:!0,loading:!0})},ll=t(56630),tl=t(73171),rl=t(49101),nl=t(99165),ol=t(17244),al=(e,l)=>JSON.parse(JSON.stringify(e,((e,t)=>e===l?"__CLONE_".concat((0,ol.x0)()):t))),il=function e(l,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3?arguments[3]:void 0,a=o||{};return null===(r=t(l).children)||void 0===r||r.forEach(((r,o)=>{var i=[...n,o];a[t(r).key]={parentKey:t(l).key,index:o,pos:i},t(r).children&&e(r,t,i,a)})),a},sl=(e,l,t)=>{var r=$e(l),n=null!==t&&void 0!==t?t:e=>al(e,l.key),o={pos:{},mapper:{}},a=()=>{console.log("computed start");var l=performance.now();o.mapper=il(e.root,r),o.pos=Object.keys(o.mapper).reduce(((e,l)=>{var t=o.mapper[l].pos;return e[l]=t,e}),o.pos);var t=performance.now();console.log("computed end",t-l)},i=()=>{a(),r(e.root).children=[...r(e.root).children]};a();var s={get dataSource(){var l=r(e.root).children;return l},take(e){return r(e)},getPos(l){if(l===e.root)return[];var t=r(l).key;return t?(o.pos[t]||a(),o.pos[t]):null},posToParents(l){var t=e.root;return l.reduce(((e,l)=>{var n,o=null===(n=r(t).children)||void 0===n?void 0:n[l];return e.push(o),t=o,e}),[])},posToPath(e){if(e){var t=e.reduce(((e,t)=>e?"".concat(e,".").concat(l.children,".").concat(t):"".concat(l.children,".").concat(t)),"");return t}},getNodeAtPos(l){if(null===l)return null;var t=l.reduce(((e,l)=>{var t;return null===(t=r(e).children)||void 0===t?void 0:t[l]}),e.root);return t},append(e){for(var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"push",t=arguments.length,n=new Array(t>2?t-2:0),o=2;o<t;o++)n[o-2]=arguments[o];var a=this.getNodeAtPos(e);a&&(0,m.batch)((()=>{var e,t;r(a).children&&"replace"!==l?"push"===l?null===(e=r(a).children)||void 0===e||e.push(...n):null===(t=r(a).children)||void 0===t||t.unshift(...n):r(a).children=n;i()}))},copy(e,l){var t=this.getNodeAtPos(e),o=null!==l&&void 0!==l?l:n(t),a=e.slice(0,e.length-1),s=this.getNodeAtPos(a);s&&t&&(0,m.batch)((()=>{var l,t=e[e.length-1]+1;null===(l=r(s).children)||void 0===l||l.splice(t,0,o),i()}))},remove(e){var l=e.slice(0,e.length-1),t=e[e.length-1];if(null!=t){var n=this.getNodeAtPos(l);n&&(0,m.batch)((()=>{var e;null===(e=r(n).children)||void 0===e||e.splice(t,1),i()}))}},move(e,l){if(JSON.stringify(e)!==JSON.stringify(l)){var t=e.length===l.length&&e.slice(0,e.length-1).join("_")===l.slice(0,l.length-1).join("_");(0,m.batch)((()=>{if(t){var n,o,a=this.getNodeAtPos(e.slice(0,e.length-1)),s=e[e.length-1],d=l[l.length-1],u=null===(n=r(a).children)||void 0===n?void 0:n.splice(s,1)[0];null===(o=r(a).children)||void 0===o||o.splice(d,0,u)}else{var c,v,p,m,f=this.getNodeAtPos(e.slice(0,e.length-1)),g=null===(c=r(f).children)||void 0===c||null===(v=c.splice)||void 0===v?void 0:v.call(c,e[e.length-1],1)[0];if(console.log("move before pick",g),!g)return;var h=this.getNodeAtPos(l.slice(0,l.length-1));null===(p=r(h).children)||void 0===p||null===(m=p.splice)||void 0===m||m.call(p,l[l.length-1],0,g)}i()}))}}};return s},dl={title:"label",key:"value",children:"children"},ul=(0,o.createContext)(null),cl=(0,o.createContext)(null),vl=()=>{var e=(0,o.useContext)(ul);return e},pl=()=>{var e=vl();return null===e||void 0===e?void 0:e.$helper},ml=e=>{var l=vl(),t=(0,o.useContext)(cl);if(e){var r=Array.isArray(e)?null===l||void 0===l?void 0:l.$helper.take(null===l||void 0===l?void 0:l.$helper.getNodeAtPos(e)).key:e;return null===l||void 0===l?void 0:l.$refs.get(r)}return t},fl=e=>{var l=e.children,t=e.getRoot,r=(0,o.useRef)({getRoot:t}),n=(0,o.useMemo)((()=>{var l=new Map,t=(0,u.Z)((0,u.Z)({},dl),e.fieldNames),n=sl({root:r.current.getRoot()},t),o={get $root(){var e=r.current.getRoot();return e},get $helper(){return n},get $fieldNames(){return t},get $refs(){return l}};return o}),[]);return o.createElement(v.ExpressionScope,{value:n},o.createElement(ul.Provider,{value:n},l))},gl=e=>{var l=vl(),t=e.getPos,r=e.getNode,n=e.children,a=(0,o.useRef)({getPos:t,getNode:r,disposer:()=>{}}),i=(0,o.useMemo)((()=>{if(!l)return null;var t=l.$refs,r=l.$helper,n={get $root(){return l.$root},get $pos(){return a.current.getPos(l.$root)},get $path(){return r.posToPath(this.$pos)},get $extra(){var l;return null===(l=e.getExtra)||void 0===l?void 0:l.call(e,this.$root)},get $record(){var e="function"===typeof a.current.getNode?a.current.getNode(l.$root):r.getNodeAtPos(this.$pos),t=e===this.$root;return t?e:"object"===typeof e?(0,X.lazyMerge)(e,{get $lookup(){return n.$lookup},get $index(){return n.$index},get $pos(){return n.$pos}}):e},get $lookup(){var e,t,n=(null===(e=this.$pos)||void 0===e?void 0:e.slice(0,this.$pos.length-1))||[],o=r.getNodeAtPos(n),a=o?null===(t=l.$refs.get(r.take(o).key))||void 0===t?void 0:t.$record:void 0;return null!==a&&void 0!==a?a:this.$root},get $records(){var e;return null!==(e=r.take(this.$lookup).children)&&void 0!==e?e:[]},get $parents(){var e=Array.isArray(this.$pos)?[...this.$pos]:[],l=[];return e.reduce(((e,t)=>{var n;l.push(e);var o=null===(n=r.take(e).children)||void 0===n?void 0:n[t];return o}),this.$root),l},get $index(){return this.$pos?this.$pos[this.$pos.length-1]:-1}},o=r.take(n.$record).key;return t.set(o,n),n}),[]);return o.createElement(cl.Provider,{value:i},o.createElement(v.ExpressionScope,{value:i},n))},hl=["pos"],yl=["pos"],bl=["pos","factory","method"],kl=["pos","clone"],El=(0,o.createContext)(null),jl=(0,o.createContext)(null),xl=()=>(0,o.useContext)(El),Zl=e=>Array.isArray(e)?e:"string"===typeof e?e.split("-").map(Number).filter((e=>!Number.isNaN(e))):[],Rl=e=>{var l=ml();return e?Zl(e):null===l||void 0===l?void 0:l.$pos},Cl=e=>{var l=e.fieldNames,t=e.getRoot,r=e.children,n=(0,v.useField)(),a=(0,v.useFieldSchema)(),i=(0,o.useMemo)((()=>({field:n,schema:a,props:e})),[n,e,a]);return o.createElement(El.Provider,{value:i},o.createElement(fl,{fieldNames:l,getRoot:t},r))},wl=e=>{var l=e.pos,t=e.children,r=e.getNode,n=e.getExtra;return o.createElement(gl,{getPos:l,getNode:r,getExtra:n},o.createElement(jl.Provider,{value:e},t))},_l=e=>{var l,t=ml(e.pos);return(null===t||void 0===t?void 0:t.$record)===(null===t||void 0===t?void 0:t.$root)?null:o.createElement("span",e,"#",null===t||void 0===t||null===(l=t.$pos)||void 0===l?void 0:l.join("-")," ")},Sl=e=>{var l,t,n=e.pos,i=(0,g.Z)(e,hl),s=xl(),d=ml(n),u=(0,v.useField)(),c=pl();if((null===d||void 0===d?void 0:d.$record)===(null===d||void 0===d?void 0:d.$root))return null;if(!s)return null;if("editable"!==s.field.pattern)return null;var p="up"===e.to&&0===(null===d||void 0===d?void 0:d.$index)||"down"===e.to&&(null===d||void 0===d?void 0:d.$index)===(null!==(l=null===d||void 0===d||null===(t=d.$records)||void 0===t?void 0:t.length)&&void 0!==l?l:-1)-1;return p?null:o.createElement(a.Z,(0,r.Z)({type:"link",size:"small",icon:o.createElement(ll.Z,{rotate:"up"===e.to?0:180})},i,{onClick:l=>{var t,r;if(l.stopPropagation(),(null===u||void 0===u||!u.disabled)&&d){var n=d.$pos,o=[...n],a=n[n.length-1];o[o.length-1]="down"===e.to?a+1:Math.max(a-1,0);var i=null===(t=(r=s.props).onMove)||void 0===t?void 0:t.call(r,n,o,null===d||void 0===d?void 0:d.$root);"function"===typeof(null===i||void 0===i?void 0:i.then)?i.then((()=>{null===c||void 0===c||c.move(n,o)})):null===c||void 0===c||c.move(n,o)}}}),u.props.title||u.title)},$l=e=>{var l=e.pos,t=(0,g.Z)(e,yl),n=xl(),i=ml(l),s=(0,v.useField)(),d=pl();return n?"editable"!==n.field.pattern||(null===i||void 0===i?void 0:i.$record)===(null===i||void 0===i?void 0:i.$root)?null:o.createElement(P.Z,{title:s.content||"\u786e\u5b9a\u8981\u5220\u9664\u5f53\u524d\u6570\u636e\u5417?",okText:"\u662f\u7684",cancelText:"\u6211\u518d\u60f3\u60f3",onConfirm:e=>{var l,t,r;if(null===e||void 0===e||null===(l=e.stopPropagation)||void 0===l||l.call(e),(null===s||void 0===s||!s.disabled)&&i){var o=i.$pos,a=null===(t=(r=n.props).onRemove)||void 0===t?void 0:t.call(r,o,i.$record,i.$lookup,null===i||void 0===i?void 0:i.$root);"function"===typeof(null===a||void 0===a?void 0:a.then)?a.then((()=>{null===d||void 0===d||d.remove(o)})):null===d||void 0===d||d.remove(o)}}},o.createElement(a.Z,(0,r.Z)({onClick:e=>e.stopPropagation(),type:"link",size:"small",icon:o.createElement(tl.Z,null)},t),s.props.title||s.title)):null},Pl=e=>{var l=e.pos,t=e.factory,n=e.method,i=(0,g.Z)(e,bl),s=xl(),d=ml(l),u=(0,v.useField)(),c=pl();return s?"editable"!==s.field.pattern?null:o.createElement(a.Z,(0,r.Z)({type:"dashed",size:"small",icon:o.createElement(rl.Z,null)},i,{onClick:e=>{var l,r;if(e.stopPropagation(),(null===u||void 0===u||!u.disabled)&&d){var o=d.$pos,a=null===(l=s.props)||void 0===l||null===(r=l.onAdd)||void 0===r?void 0:r.call(l,o,d.$record,d.$lookup,d.$root);"function"===typeof(null===a||void 0===a?void 0:a.then)?a.then((e=>{setTimeout((()=>{null===c||void 0===c||c.append(o,n,null!==e&&void 0!==e?e:null===t||void 0===t?void 0:t(d.$record))}))})):null===c||void 0===c||c.append(o,n,(null===t||void 0===t?void 0:t(d.$record))||{})}}}),u.props.title||u.title):null},Al=e=>{var l=e.pos,t=e.clone,n=(0,g.Z)(e,kl),i=xl(),s=ml(l),d=(0,v.useField)(),u=pl();return i?"editable"!==i.field.pattern||(null===s||void 0===s?void 0:s.$record)===(null===s||void 0===s?void 0:s.$root)?null:o.createElement(a.Z,(0,r.Z)({type:"link",size:"small",icon:o.createElement(nl.Z,null)},n,{onClick:e=>{var l,r;if(e.stopPropagation(),(null===d||void 0===d||!d.disabled)&&s){var n=s.$pos,o=null===(l=i.props)||void 0===l||null===(r=l.onCopy)||void 0===r?void 0:r.call(l,n,s.$record,s.$lookup,s.$root);if("function"===typeof(null===o||void 0===o?void 0:o.then))o.then((e=>{var l=null!==e&&void 0!==e?e:null===t||void 0===t?void 0:t(s.$record);null===u||void 0===u||u.copy(n,l)}));else{var a=null===t||void 0===t?void 0:t(s.$record);null===u||void 0===u||u.copy(n,a)}}}}),d.props.title||d.title):null};Cl.Node=wl,Cl.Move=Sl,Cl.Pos=_l,Cl.Remove=$l,Cl.Append=Pl,Cl.Copy=Al,Cl.useNode=ml,Cl.useTree=xl,Cl.usePos=Rl,Cl.useRoot=vl,Cl.useHelper=pl,Cl.mixin=e=>(e.Node=Cl.Node,e.Move=Cl.Move,e.Pos=Cl.Pos,e.Remove=Cl.Remove,e.Append=Cl.Append,e.Copy=Cl.Copy,e.useNode=Cl.useNode,e.useTree=Cl.useTree,e.usePos=Cl.usePos,e.useRoot=Cl.useRoot,e.useHelper=Cl.useHelper,e);var Nl=Cl,zl=["loadAll","loadData","checkedKeys","fieldNames","children"],Fl=["onAdd","value","fieldNames","onCopy","onMove","onRemove","layout"],Ol={title:"label",key:"value",children:"children"},Tl=()=>{var e=(0,o.useRef)(null);return(0,o.useEffect)((()=>{var l,t=null===(l=e.current)||void 0===l?void 0:l.parentElement,r=null;while(t&&!r)r=/ant-tree-treenode/.test(t.getAttribute("class")||"")?t:null,t=t.parentElement;r&&r.setAttribute("style","display: none")}),[]),o.createElement("span",{ref:e},"hack")},Kl=e=>{var l=Nl.useTree(),t=Nl.useHelper(),r=Nl.useNode(),n=(null===t||void 0===t?void 0:t.take(null===r||void 0===r?void 0:r.$record).key)!==e.dataKey;return n?o.createElement(Tl,null):o.createElement("div",{onClick:e=>{var l;"INPUT"===(null===e||void 0===e||null===(l=e.target)||void 0===l?void 0:l.tagName)&&e.stopPropagation()}},o.createElement(v.RecursionField,{name:null===r||void 0===r?void 0:r.$path,schema:null===l||void 0===l?void 0:l.schema.items}))},Ml=(0,v.observer)((e=>{var l,t,n=e.loadAll,a=e.loadData,i=(e.checkedKeys,e.fieldNames),s=(e.children,(0,g.Z)(e,zl)),d=Nl.useHelper(),u=(0,v.useField)(),c=(0,f.Z)({loadData:a,loadAll:n,onDrop:e.onDrop}),p=(0,o.useCallback)((e=>{if(!c.current.loadAll&&c.current.loadData&&d){var l=d.getPos(e),t=d.posToParents(l),r=t[t.length-1];return r.loading=!0,c.current.loadData(t).then((e=>{d.append(l,"replace",...e)})).finally((()=>{r.loading=!1}))}}),[d,c]),m=(0,o.useCallback)((e=>{var l,t,r=e.dragNode,n=e.node,o=r.pos.split("-").map(Number);o.shift();var a=n.pos.split("-").map(Number);a.shift();var i=null===(l=(t=c.current).onDrop)||void 0===l?void 0:l.call(t,o,a);"function"===typeof(null===i||void 0===i?void 0:i.then)?i.then((()=>{null===d||void 0===d||d.move(o,a)})):null===d||void 0===d||d.move(o,a)}),[d,c]);return o.createElement(o.Fragment,null,o.createElement(el,null),o.createElement(Ge.Z,(0,r.Z)({showLine:!0,blockNode:!0},s,{className:"".concat(e.className," fireformily-tree"),titleRender:e=>{if(!d)return null;var l=d.getPos(e);return l?o.createElement(Nl.Node,{key:d.take(e).key,pos:()=>d.getPos(e),getExtra:()=>{var l,t,r,n,o=d.take(e).key,a=u.value,i=a,s=i.selectedKeys,c=void 0===s?[]:s,v=i.checkedKeys,p=void 0===v?[]:v,m=i.halfCheckedKeys,f=void 0===m?[]:m,g=i.expandedKeys,h=void 0===g?[]:g;return{checked:null===p||void 0===p||null===(l=p.includes)||void 0===l?void 0:l.call(p,o),halfChecked:null===f||void 0===f||null===(t=f.includes)||void 0===t?void 0:t.call(f,o),selecteds:null===c||void 0===c||null===(r=c.includes)||void 0===r?void 0:r.call(c,o),expanded:null===h||void 0===h||null===(n=h.includes)||void 0===n?void 0:n.call(h,o)}}},o.createElement(Kl,{dataKey:d.take(e).key})):o.createElement(Tl,null)},expandedKeys:null!==(l=u.value.expandedKeys)&&void 0!==l?l:[],onExpand:e=>{u.setState((l=>{l.value.expandedKeys=e}))},selectedKeys:null!==(t=u.value.selectedKeys)&&void 0!==t?t:[],onSelect:e=>{u.setState((l=>{l.value.selectedKeys=e}))},checkedKeys:u.value.checkedKeys,onCheck:(e,l)=>{if(u.value){var t=Array.isArray(e)?e:e.checked,r=Array.isArray(e)?l.halfCheckedKeys:e.halfChecked;u.setState((e=>{e.value.checkedKeys=t,e.value.halfCheckedKeys=null!==r&&void 0!==r?r:[]}))}},fieldNames:i,treeData:null===d||void 0===d?void 0:d.dataSource,onDrop:m,loadData:a&&!n?p:void 0})))})),ql=e=>{var l=e.onAdd,t=(e.value,e.fieldNames),n=e.onCopy,a=e.onMove,i=e.onRemove,s=e.layout,d=(0,g.Z)(e,Fl),c=(0,v.useField)(),m=(0,v.useFieldSchema)(),h=(0,o.useMemo)((()=>(0,u.Z)((0,u.Z)({},Ol),t)),[t]),y=(0,f.Z)({loader:e.loadAll||e.loadData});return(0,o.useEffect)((()=>{y.current.loader&&(c.selfModified||y.current.loader([]).then((e=>{console.log("reloaddd"),c.setState((l=>{l.value.children=e}))})))}),[]),o.createElement(o.Fragment,null,o.createElement(Nl,{getRoot:()=>c.value,fieldNames:h,onAdd:l,onRemove:i,onCopy:n,onMove:a},o.createElement(v.RecursionField,{schema:m,onlyRenderSelf:!0}),o.createElement(p.Z,(0,r.Z)({size:"small"},s),o.createElement(p.Z,{direction:"vertical",size:"small"},o.createElement(Nl.Node,{getNode:()=>c.value,pos:()=>[]},o.createElement(v.RecursionField,{schema:m.items,onlyRenderProperties:!0,name:""})),o.createElement(Ml,(0,r.Z)({},d,{fieldNames:h}))),o.createElement(v.RecursionField,{schema:m,name:"",onlyRenderProperties:!0}))))};Nl.mixin(ql);var Dl=e=>_e[e%_e.length],Il=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l={emap:e.reduce(((e,l)=>(e[l.value]=l.label,e[l.label]=l.value,e)),{}),colors:e.reduce(((e,l,t)=>{var r=l.color||Dl(t);return e[l.value]=r,e[l.label]=r,e}),{}),options:e.map(((e,l)=>(0,u.Z)((0,u.Z)({},e),{},{key:e.value,color:e.color||Dl(l)})))};return l},Ll=function(e){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";return e.map((e=>({key:e[t],label:e[l],value:e[t],color:e.color})))},Ul=function(e){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";return Il(e.map((e=>({key:e[t],label:e[l],value:e[t],color:e.color}))))},Bl=(0,m.observable)({}),Jl=Bl,Hl={},Vl={},Ql=(e,l)=>{Hl[e]=()=>l(Ll).then((l=>{var t=Ul(l);return Bl[e]=t,Bl[e]}))},Wl=e=>{(0,c.cW)("*",(e=>{var l,t=null===(l=e.data)||void 0===l?void 0:l.dict;if(t){var r=e.data.dictNoCache;if(!Bl[t]&&!Hl[t])throw new Error("\u8bcd\u5178 ".concat(t," \u7684\u52a0\u8f7d\u5668\u4e0d\u5b58\u5728!"),t);if(!0!==r&&Bl[t])e.setState((e=>{e.dataSource=Bl[t].options,e.componentProps&&(e.componentProps.options=e.dataSource)}));else if(t&&Hl[t]){e.setState((e=>{e.loading=!0}));var n=Vl[t]||Hl[t]();Vl[t]=n.then((l=>(e.setState((e=>{e.dataSource=l.options,e.componentProps&&(e.componentProps.options=e.dataSource),e.loading=!1})),l))).catch((l=>{throw e.setState((e=>{e.loading=!1})),l}))}}})),(0,c.lC)("*",(e=>{var l,t,r=null===(l=e.data)||void 0===l?void 0:l.dict;if(r){var n=(e,l)=>{var t=Array.isArray(e)?e[0]:e,r=Array.isArray(l)?l[0]:l;return t===r},o=e.readPretty||e.readOnly;o?n(e.component,Oe)||(e.data.__origin_component=e.component,e.setComponent(Oe)):null!==(t=e.data)&&void 0!==t&&t.__origin_component&&!n(e.data.__origin_component,e.component)&&e.setComponent(e.data.__origin_component)}}))},Gl=e=>{var l="function"===typeof e?e():e;return(0,m.isSupportObservable)(l)?(0,m.observable)(l):(console.log("WARNING!!, not support obserable"),l)},Xl=e=>{var l=(0,o.useMemo)((()=>Gl(null!==e&&void 0!==e?e:{})),[]);return l}},46700:function(e,l,t){var r={"./af":60757,"./af.js":60757,"./ar":22490,"./ar-dz":15633,"./ar-dz.js":15633,"./ar-kw":12602,"./ar-kw.js":12602,"./ar-ly":34074,"./ar-ly.js":34074,"./ar-ma":98317,"./ar-ma.js":98317,"./ar-sa":29752,"./ar-sa.js":29752,"./ar-tn":66061,"./ar-tn.js":66061,"./ar.js":22490,"./az":92136,"./az.js":92136,"./be":57080,"./be.js":57080,"./bg":48473,"./bg.js":48473,"./bm":38856,"./bm.js":38856,"./bn":17146,"./bn-bd":5223,"./bn-bd.js":5223,"./bn.js":17146,"./bo":30594,"./bo.js":30594,"./br":48831,"./br.js":48831,"./bs":67530,"./bs.js":67530,"./ca":82766,"./ca.js":82766,"./cs":3830,"./cs.js":3830,"./cv":74487,"./cv.js":74487,"./cy":60146,"./cy.js":60146,"./da":66186,"./da.js":66186,"./de":86621,"./de-at":72833,"./de-at.js":72833,"./de-ch":78113,"./de-ch.js":78113,"./de.js":86621,"./dv":32345,"./dv.js":32345,"./el":69981,"./el.js":69981,"./en-au":16498,"./en-au.js":16498,"./en-ca":94555,"./en-ca.js":94555,"./en-gb":93204,"./en-gb.js":93204,"./en-ie":89988,"./en-ie.js":89988,"./en-il":3777,"./en-il.js":3777,"./en-in":23231,"./en-in.js":23231,"./en-nz":30533,"./en-nz.js":30533,"./en-sg":73034,"./en-sg.js":73034,"./eo":21496,"./eo.js":21496,"./es":65678,"./es-do":76879,"./es-do.js":76879,"./es-mx":55440,"./es-mx.js":55440,"./es-us":66963,"./es-us.js":66963,"./es.js":65678,"./et":41003,"./et.js":41003,"./eu":90013,"./eu.js":90013,"./fa":29692,"./fa.js":29692,"./fi":68102,"./fi.js":68102,"./fil":22918,"./fil.js":22918,"./fo":87496,"./fo.js":87496,"./fr":67474,"./fr-ca":1853,"./fr-ca.js":1853,"./fr-ch":44675,"./fr-ch.js":44675,"./fr.js":67474,"./fy":97061,"./fy.js":97061,"./ga":96867,"./ga.js":96867,"./gd":18364,"./gd.js":18364,"./gl":96383,"./gl.js":96383,"./gom-deva":64220,"./gom-deva.js":64220,"./gom-latn":87202,"./gom-latn.js":87202,"./gu":25249,"./gu.js":25249,"./he":96022,"./he.js":96022,"./hi":65395,"./hi.js":65395,"./hr":29361,"./hr.js":29361,"./hu":93797,"./hu.js":93797,"./hy-am":85874,"./hy-am.js":85874,"./id":77084,"./id.js":77084,"./is":12592,"./is.js":12592,"./it":54296,"./it-ch":35272,"./it-ch.js":35272,"./it.js":54296,"./ja":17620,"./ja.js":17620,"./jv":46898,"./jv.js":46898,"./ka":62752,"./ka.js":62752,"./kk":5632,"./kk.js":5632,"./km":16667,"./km.js":16667,"./kn":88963,"./kn.js":88963,"./ko":35953,"./ko.js":35953,"./ku":72004,"./ku.js":72004,"./ky":71803,"./ky.js":71803,"./lb":12835,"./lb.js":12835,"./lo":98185,"./lo.js":98185,"./lt":40538,"./lt.js":40538,"./lv":74582,"./lv.js":74582,"./me":23663,"./me.js":23663,"./mi":35840,"./mi.js":35840,"./mk":88701,"./mk.js":88701,"./ml":2209,"./ml.js":2209,"./mn":38391,"./mn.js":38391,"./mr":14481,"./mr.js":14481,"./ms":20135,"./ms-my":29977,"./ms-my.js":29977,"./ms.js":20135,"./mt":81029,"./mt.js":81029,"./my":27402,"./my.js":27402,"./nb":18929,"./nb.js":18929,"./ne":29030,"./ne.js":29030,"./nl":18208,"./nl-be":92510,"./nl-be.js":92510,"./nl.js":18208,"./nn":46456,"./nn.js":46456,"./oc-lnc":98952,"./oc-lnc.js":98952,"./pa-in":9734,"./pa-in.js":9734,"./pl":67042,"./pl.js":67042,"./pt":97351,"./pt-br":63673,"./pt-br.js":63673,"./pt.js":97351,"./ro":62080,"./ro.js":62080,"./ru":78025,"./ru.js":78025,"./sd":51922,"./sd.js":51922,"./se":82651,"./se.js":82651,"./si":16258,"./si.js":16258,"./sk":23337,"./sk.js":23337,"./sl":8683,"./sl.js":8683,"./sq":10119,"./sq.js":10119,"./sr":72660,"./sr-cyrl":9322,"./sr-cyrl.js":9322,"./sr.js":72660,"./ss":33350,"./ss.js":33350,"./sv":19607,"./sv.js":19607,"./sw":16552,"./sw.js":16552,"./ta":25391,"./ta.js":25391,"./te":78149,"./te.js":78149,"./tet":27113,"./tet.js":27113,"./tg":4503,"./tg.js":4503,"./th":33665,"./th.js":33665,"./tk":68356,"./tk.js":68356,"./tl-ph":62917,"./tl-ph.js":62917,"./tlh":42669,"./tlh.js":42669,"./tr":34573,"./tr.js":34573,"./tzl":16022,"./tzl.js":16022,"./tzm":881,"./tzm-latn":30897,"./tzm-latn.js":30897,"./tzm.js":881,"./ug-cn":45472,"./ug-cn.js":45472,"./uk":1300,"./uk.js":1300,"./ur":96961,"./ur.js":96961,"./uz":51699,"./uz-latn":87476,"./uz-latn.js":87476,"./uz.js":51699,"./vi":91544,"./vi.js":91544,"./x-pseudo":22086,"./x-pseudo.js":22086,"./yo":85911,"./yo.js":85911,"./zh-cn":38098,"./zh-cn.js":38098,"./zh-hk":53720,"./zh-hk.js":53720,"./zh-mo":10794,"./zh-mo.js":10794,"./zh-tw":36087,"./zh-tw.js":36087};function n(e){var l=o(e);return t(l)}function o(e){if(!t.o(r,e)){var l=new Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",l}return r[e]}n.keys=function(){return Object.keys(r)},n.resolve=o,e.exports=n,n.id=46700}}]);