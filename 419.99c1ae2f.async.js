"use strict";(self.webpackChunkfireformily=self.webpackChunkfireformily||[]).push([[419],{53419:function(zr,he,b){b.r(he),b.d(he,{Dict:function(){return se},ImageView:function(){return We},Linkage:function(){return nn},Loading:function(){return xe},LongText:function(){return an},PopActions:function(){return Y},QueryForm:function(){return $n},QueryList:function(){return bn},QueryTable:function(){return H},Suggestion:function(){return nr},TreeBase:function(){return L},TreeNodes:function(){return De},colors:function(){return ue},dict:function(){return Zr},dictEffects:function(){return Dr},eqeq:function(){return He},getTreeHelper:function(){return we},isColorStatus:function(){return de},registerDictLoader:function(){return Er},takeTake:function(){return me},useExpressionScope:function(){return re},useLive:function(){return Ir}});var C=b(67294),Ke=b(97857),R=b.n(Ke),ge={success:"green",processing:"blue",error:"red",warning:"gold",default:"#fafafa"},ue=R()({length:11,0:"magenta",1:"green",2:"cyan",3:"geekblue",4:"purple",5:"red",6:"orange",7:"lime",8:"blue",9:"volcano",10:"gold",magenta:"magenta",green:"green",cyan:"cyan",geekblue:"geekblue",purple:"purple",red:"red",orange:"orange",lime:"lime",blue:"blue",volcano:"volcano",gold:"gold"},ge),de=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return!!ge[e]},Me=b(52677),V=b.n(Me),me=function(e){return function(n){return{get key(){return n&&n[e.key]},set key(r){V()(n)==="object"&&(n[e.key]=r)},get title(){return n&&n[e.title]},set title(r){V()(n)==="object"&&(n[e.title]=r)},get children(){return n&&n[e.children]},set children(r){V()(n)==="object"&&(n[e.children]=r)}}}},Be=Object.prototype.hasOwnProperty;function pe(l,e){return l===e?l!==0||e!==0||1/l===1/e:l!==l&&e!==e}function He(l,e){if(pe(l,e))return!0;if(V()(l)!=="object"||l===null||V()(e)!=="object"||e===null)return!1;var n=Object.keys(l),r=Object.keys(e);if(n.length!==r.length)return!1;for(var t=0;t<n.length;t++)if(!Be.call(e,n[t])||!pe(l[n[t]],e[n[t]]))return!1;return!0}var Z=b(26713),Qe=b(63922),Ue=b(20550),v=b(85893),se=function(e){var n=e.strict,r=e.type,t=e.value,a=e.options,i=(0,C.useMemo)(function(){if(!Array.isArray(a))return[];var o=Array.isArray(t)?t.map(function(d){return a.find(function(u){return n?u.value===d:u.value==d})}):[a.find(function(d){return n?d.value===t:d.value==t})];return o.filter(Boolean)},[a,n,t]);return(0,v.jsx)(Z.Z,{size:"small",children:i.map(function(o){return r==="badge"?(0,v.jsx)(Qe.Z,{status:de(o==null?void 0:o.color)?o==null?void 0:o.color:void 0,color:de(o==null?void 0:o.color)||o==null?void 0:o.color,text:o==null?void 0:o.label},o==null?void 0:o.key):r==="tag"?(0,v.jsx)(Ue.Z,{color:o==null?void 0:o.color,children:o==null?void 0:o.label},o==null?void 0:o.key):o==null?void 0:o.label})})},ye=b(63917),Ve={width:"60px",height:"60px",objectFit:"contain"},We=function(e){var n=e.value,r=e.style,t=(0,C.useMemo)(function(){var i=Array.isArray(n)?n:[n];return i.filter(Boolean)},[n]),a=(0,C.useMemo)(function(){return R()(R()({},Ve),r)},[r]);return(0,v.jsx)(C.Fragment,{children:(0,v.jsx)(ye.Z.PreviewGroup,{children:t.map(function(i){return(0,v.jsx)(ye.Z,{style:a,src:i,preview:!0},i)})})})},Je=b(19632),B=b.n(Je),Ge=b(13769),z=b.n(Ge),j=b(27420),O=b(85667),ee=b(3930),Xe=b(45239),Ye=["value","loadAll","labelInValue","disabled","multiple","onChange","loadData"],qe={width:"100%"},_e=function(e,n){return e&&Array.isArray(n)?n.length>0?n==null?void 0:n.reduceRight(function(r,t){return r?(t.children=r,t.__init=!0,[t]):(t.isLeaf=!0,[t])},null):[]:[]},en=function(e){var n=e.loadData,r=e.loadAll,t=e.value,a=e.labelInValue,i=(0,ee.Z)(r||n),o=(0,C.useMemo)(function(){return(0,O.observable)({inited:!1,loading:!1,options:_e(a,t),load:function(m){var f,h,p=m[m.length-1];p&&(p.loading=!0,o.loading=!0,(f=i.current)===null||f===void 0||(h=f.call(i,m).then(function(y){y?p.children=y.map(function(x){return R()({isLeaf:!1},x)}):p.isLeaf=!0}))===null||h===void 0||h.finally(function(){p.loading=!1,o.loading=!1}))}})},[]);if(!o.inited&&!o.loading){var d,u,g;o.loading=!0,o.inited=!0;var c=Array.isArray(t)?a?t:t.map(function(s){return{value:s}}):[];(d=i.current)===null||d===void 0||(u=d.call(i,c))===null||u===void 0||(g=u.then(function(s){s&&(o.options=s.map(function(m){return R()({isLeaf:!1},m)}))}))===null||g===void 0||g.finally(function(){o.loading=!1})}return o},nn=function(e){var n=e.value,r=e.loadAll,t=e.labelInValue,a=e.disabled,i=e.multiple,o=e.onChange,d=e.loadData,u=z()(e,Ye),g=en(e),c=(0,C.useCallback)(function(m,f){return t?o==null?void 0:o(f):o==null?void 0:o(m)},[t,o]),s=function m(f){return Array.isArray(f)?f.map(function(h){return Array.isArray(h)?m(h):h.label?h.value:h}):[]};return(0,v.jsx)(j.Observer,{children:function(){return(0,v.jsx)(Xe.Z,R()(R()({disabled:a,multiple:i,changeOnSelect:!0},u),{},{loading:g.loading,value:s(n),style:e.style||qe,options:B()(g.options),loadData:r?void 0:g.load,onChange:c}))}})},rn=b(5574),K=b.n(rn),tn=b(19491),on={position:"absolute",transition:"all ease 0.2s"},xe=function(e){var n=(0,C.useState)(!0),r=K()(n,2),t=r[0],a=r[1];return(0,C.useLayoutEffect)(function(){setTimeout(function(){a(!1)},67)},[]),(0,v.jsx)(tn.Z,{style:R()(R()({},on),{},{display:t?"":"none"}),paragraph:!0,loading:!0})},Ce=b(49420),ln=Ce.Z.Paragraph,an=function(e){return(0,v.jsx)(ln,R()(R()({copyable:!0,ellipsis:!0},e),{},{style:{marginBottom:0},children:e.value}))},un=b(63463),E=b(71577),dn=function(){},ne=function(e){var n,r,t,a,i=e.field,o=e.loading,d=e.open,u=e.scope,g=(u==null?void 0:u.$index)!==void 0,c=o?dn:d;return i.display!=="visible"?null:(0,v.jsx)(E.Z,{onClick:c,size:g?"small":(r=i.componentProps)===null||r===void 0?void 0:r.size,type:g?"link":(a=i.componentProps)===null||a===void 0?void 0:a.type,children:i==null?void 0:i.title})},G=b(99619),sn=b(44620),re=function(){var e=(0,j.useField)(),n=(0,j.useExpressionScope)();return e.record?R()({$record:e.record,$lookup:e.records,$records:e.records,$index:e.index},n):n},cn=["pageSize","current"],Re=function(){},$e=(0,C.createContext)(null),vn=C.memo(function(l){var e,n=(0,j.useForm)(),r=(0,C.useRef)({}),t=(0,sn.Z)(),a=K()(t,2),i=a[0],o=a[1],d=(0,C.useRef)(!1),u=re(),g=(0,C.useRef)(!1),c=(0,C.useRef)({service:l.service}),s=(0,C.useCallback)(function(y){var x=c.current.service;if(r.current=y,l.syncUrl){var $=y||{pagination:{}},S=$.pagination,A=S.pageSize,k=S.current,T=$.params;o(function(P){var w=R()({},P);return Object.keys(w).forEach(function(F){w[F]=void 0}),R()(R()(R()({},w),T),{},{pageSize:A,current:k})})}return p.current._loading=!0,x(R()(R()({},y),{},{scope:u})).then(function(P){var w=P.list,F=P.total,U=p.current._address.table,J=n.query(U).take();return U?(J.setState(function(I){(0,O.batch)(function(){I.value=w,I.data=I.data||{},I.data.pagination=I.data.pagination||{},I.data.pagination.total=F})}),{list:w,total:F}):{list:[],total:0}}).finally(function(){p.current._loading=!1})},[n,l.syncUrl,u,o]),m=(0,C.useCallback)(function(){var y=p.current._address.query,x=n.query(y).take(),$=p.current._address.table,S=n.query($).take();return s(R()({params:x==null?void 0:x.value},S==null?void 0:S.data))},[s,n]),f=(0,C.useCallback)(function(){var y=r.current;return s(y)},[s]),h=(0,C.useCallback)(function(){var y,x,$=p==null||(y=p.current)===null||y===void 0||(x=y._address)===null||x===void 0?void 0:x.table;if($){var S;(S=n.query($).take())===null||S===void 0||S.setState(function(A){(0,O.batch)(function(){A.data=A.data||{},A.data.pagination=A.data.pagination||{},A.data.pagination.current=1})})}return m()},[m,n]),p=(0,C.useRef)((0,O.observable)(R()(R()({},l),{},{service:l.service?s:void 0,syncUrl:l.syncUrl,pageSize:l.pageSize,_refresh:l.service?f:void 0,_reset:l.service?h:void 0,_trigger:l.service?m:void 0,_address:{query:"",table:""},_scope:u,_cofnig:{_size:(e=l.size)!==null&&e!==void 0?e:"default",_columns:[],_showColumns:[],_selectedRows:[],_selectedRowKeys:[],_selectClear:Re,_selectReverse:Re}})));return(0,C.useEffect)(function(){if(l.syncUrl&&!d.current){var y=p.current._address,x=i||{},$=x.pageSize,S=x.current,A=z()(x,cn);if($&&y!==null&&y!==void 0&&y.table){var k;(k=n.query(y.table).take())===null||k===void 0||k.setState(function(P){(0,O.batch)(function(){P.data=P.data||{},P.data.pagination=P.data.pagination||{},P.data.pagination.pageSize=Number(i.pageSize),P.data.pagination.current=Number(i.current)})})}if(A&&Object.keys(A).length>0&&y!==null&&y!==void 0&&y.query){var T;(T=n.query(y.query).take())===null||T===void 0||T.setState(function(P){P.value=R()(R()({},P.value),A)})}y!=null&&y.table&&setTimeout(function(){d.current=!0},0)}},[n,l.syncUrl,i]),(0,C.useEffect)(function(){if(c.current.service){var y=(0,O.autorun)(function(){var x,$=(x=p.current._address)===null||x===void 0?void 0:x.table;g.current===!1&&$&&p.current.autoload!==!1&&setTimeout(function(){m(),g.current=!0})});return function(){y()}}},[m]),(0,C.useEffect)(function(){var y=p.current;y.autoload!==l.autoload&&(y.autoload=l.autoload),y.filterRemote!==l.filterRemote&&(y.filterRemote=l.filterRemote),y.sortRemote!==l.sortRemote&&(y.sortRemote=l.sortRemote),y.syncUrl!==l.syncUrl&&(y.syncUrl=l.syncUrl)},[l.autoload,l.filterRemote,l.sortRemote,l.syncUrl]),(0,v.jsx)($e.Provider,{value:p.current,children:(0,v.jsx)(j.ExpressionScope,{value:{get $query(){var y,x=(y=p.current._address)===null||y===void 0?void 0:y.query;return x?n.query(x).take().value:null},get $list(){var y,x=(y=p.current._address)===null||y===void 0?void 0:y.table;return x?n.query(x).take().value:null}},children:l.children})})}),M=function(){var e=(0,C.useContext)($e);return e},fn=function(){return new Promise(function(e){setTimeout(function(){e("")},0)})},hn=function(e){return(0,O.isObservable)(e)?e:Array.isArray(e)?B()(e):R()({},e)},X=function(){return Promise.resolve({})},gn=function(e){return Promise.resolve(R()({},e))},te=function(){var e,n=(0,j.useField)(),r=re(),t=M(),a=n==null||(e=n.componentProps)===null||e===void 0?void 0:e.actions,i=(0,C.useRef)({open:!1,reset:!1,submit:!1}),o=(0,j.useFieldSchema)(),d=(0,ee.Z)(a||{}),u=(0,C.useState)(!1),g=K()(u,2),c=g[0],s=g[1],m=(0,C.useState)(!1),f=K()(m,2),h=f[0],p=f[1],y=(0,C.useCallback)(function(){if(!n.disabled&&!h&&!i.current.open){i.current.open=!0;var T=d.current.load||gn;return p(!0),T(r).then(function(P){n.setState(function(w){w.value=hn(P)}),s(!0)}).finally(function(){i.current.open=!1,p(!1)})}},[n,h,d,r]),x=(0,C.useCallback)(function(){if(!n.disabled&&!(h||!c)&&!i.current.reset){i.current.reset=!0;var T=(0,G.JF)(n)?X:function(){return n.reset()},P=d.current.cancel||X;return T().then(function(){return P(r)}).then(function(){s(!1)}).finally(function(){i.current.reset=!1,p(!1)})}},[n,h,d,r,c]),$=(0,C.useCallback)(function(){if(!n.disabled&&!(h||!c)&&!i.current.submit){i.current.submit=!0;var T=(0,G.JF)(n)?X:function(){return n.submit()},P=(0,G.JF)(n)?X:function(){return n.reset()},w=d.current.submit||X;return T().then(function(F){return w(F,r)}).then(function(){return s(!1),fn().then(P)}).finally(function(){var F;p(!1),i.current.submit=!1,t==null||(F=t._refresh)===null||F===void 0||F.call(t)})}},[t,n,h,d,r,c]),S=(0,C.useMemo)(function(){return n.content?n.content:null},[n.content]),A=(0,C.useMemo)(function(){return o?(0,v.jsx)(C.Fragment,{children:(0,v.jsx)(j.RecursionField,{schema:o})}):null},[o]),k=(0,C.useMemo)(function(){return(0,v.jsxs)(Z.Z,{style:{display:"flex",justifyContent:"flex-end",marginBottom:"16px"},children:[(0,v.jsx)(E.Z,{loading:h,onClick:x,children:"\u53D6\u6D88"}),(0,v.jsx)(E.Z,{loading:h,onClick:$,type:"primary",children:"\u786E\u5B9A"})]})},[h,x,$]);return{submit:$,field:n,reset:x,open:y,visible:c,loading:h,body:A,header:S,footer:k,scope:r}},mn=function(e){var n=te(),r=n.body,t=n.field,a=n.footer,i=n.header,o=n.loading,d=n.scope,u=n.open,g=n.reset,c=n.visible;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(un.Z,R()(R()({width:"68.88%",closable:!0,keyboard:!0},e),{},{title:e.title||t.title,onClose:function(m){var f;g(),e==null||(f=e.onClose)===null||f===void 0||f.call(e,m)},open:c,afterOpenChange:function(m){var f;m||g(),e==null||(f=e.afterOpenChange)===null||f===void 0||f.call(e,m)},footer:a,children:[i,r]})),(0,v.jsx)(ne,{open:u,field:t,loading:o,scope:d})]})},pn=b(85402),be=function(e){var n=te(),r=n.visible,t=n.body,a=n.field,i=n.scope,o=n.footer,d=n.header,u=n.loading,g=n.open,c=n.reset;return(0,v.jsxs)(v.Fragment,{children:[(0,v.jsxs)(pn.Z,R()(R()({maskClosable:!1,keyboard:!1,closable:!1,width:"68.88%"},e),{},{afterClose:function(){var m;e==null||(m=e.afterClose)===null||m===void 0||m.call(e),c()},open:r,title:e.title||a.title,footer:o,children:[d,t]})),(0,v.jsx)(ne,{open:g,field:a,loading:u,scope:i})]})},Se=b(65360),yn=function(e){var n=te(),r=n.body,t=n.field,a=n.header,i=n.loading,o=n.scope,d=n.open,u=n.reset,g=n.submit,c=n.visible;return(0,v.jsx)(Se.Z,R()(R()({},e),{},{title:(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("h4",{children:t.title||a}),t.title?null:a,r]}),cancelButtonProps:{loading:i},okButtonProps:{loading:i},onCancel:u,onConfirm:g,open:c,onOpenChange:function(m){var f;m||u(),e==null||(f=e.onOpenChange)===null||f===void 0||f.call(e,m)},children:(0,v.jsx)(ne,{open:d,field:t,loading:i,scope:o})}))},xn=b(55241),Cn=function(e){var n=te(),r=n.body,t=n.field,a=n.scope,i=n.footer,o=n.header,d=n.loading,u=n.open,g=n.reset,c=n.visible;return console.log("--popovver",{visible:c}),(0,v.jsx)(xn.Z,R()(R()({},e),{},{trigger:"click",title:e.title||t.title,content:(0,v.jsxs)(v.Fragment,{children:[o,r,i]}),open:c,onOpenChange:function(m){var f;e==null||(f=e.onOpenChange)===null||f===void 0||f.call(e,m),m||g()},children:(0,v.jsx)(ne,{open:u,field:t,loading:d,scope:a})}))},Y=be;Y.Drawer=mn,Y.Modal=be,Y.Popconfirm=yn,Y.Popover=Cn;var D=b(55668),Rn=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.maxRows||1,r=(0,C.useMemo)(function(){return D.T5.createFormGrid({maxColumns:e.maxColumns||4,maxWidth:e.maxWidth||320,maxRows:n,shouldVisible:function(d,u){return d.index===r.childSize-1||u.maxRows===1/0?!0:d.shadowRow<n+1}})},[e.maxColumns,e.maxWidth,n]),t=r.fullnessLastColumn?r.shadowRows-1:r.shadowRows,a=t<=n?void 0:r.maxRows===1/0,i=function(){r.maxRows===1/0?r.maxRows=n:r.maxRows=1/0};return{grid:r,expanded:a,toggle:i}},$n=(0,j.observer)(function(l){var e,n=l.resetText,r=l.submitText,t=(0,j.useField)(),a=(0,j.useForm)(),i=Rn(l.grid),o=i.grid,d=i.expanded,u=i.toggle,g=M(),c=g||{},s=c._loading,m=c._refresh,f=c._reset,h=c._trigger,p=function(){if(!s)if(g){var S;a.reset((S=g._address)===null||S===void 0?void 0:S.query,{forceClear:!0,validate:!1}).then(function(){f==null||f()})}else setTimeout(function(){f==null||f()})},y=function(){if(!s)return h==null?void 0:h()};(0,C.useEffect)(function(){g&&(g._address.query=t.address.toString())},[g,t==null||(e=t.address)===null||e===void 0?void 0:e.toString()]);var x=function(){return(0,v.jsxs)(D.d5,{align:"right",style:{width:"100%",marginBottom:"22px",display:"flex",justifyContent:"flex-end"},children:[d!==void 0?(0,v.jsx)(E.Z,{type:"link",onClick:function(A){A.preventDefault(),u()},children:d?"\u6536\u8D77":"\u5C55\u5F00"}):null,(0,v.jsx)(E.Z,{onClick:p,children:n||"\u91CD\u7F6E"}),(0,v.jsx)(E.Z,{onClick:y,type:"primary",children:r||"\u67E5\u8BE2"})]})};return l.children?(0,v.jsxs)(D.T5,R()(R()({},o),{},{grid:o,children:[l.children,(0,v.jsx)(D.T5.GridColumn,{gridSpan:-1,style:{display:"flex",justifyContent:"space-between"},children:x()})]})):null}),bn=function(e){return(0,v.jsx)(vn,R()(R()({},e),{},{children:e.children}))},Sn=b(31194),jn=b(86296),An=function l(e){var n=e.items||e,r=n.reduceProperties(function(t,a){var i;return t||(a["x-component"]==="QueryTable"?null:((i=a["x-component"])===null||i===void 0?void 0:i.indexOf("SortHandle"))>-1?a:a.properties||a.items?l(a):t)});return r},ce=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Column"))>-1},je=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Operations"))>-1},Ae=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Addition"))>-1},Pn=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Expand"))>-1},kn=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Selection"))>-1},Tn=function(){var e=(0,j.useFieldSchema)();return e.reduceProperties(function(n,r,t){return Ae(r)?(0,v.jsx)(j.RecursionField,{schema:r,name:t}):n},null)},Nn=b(5085),wn=b.n(Nn),Pe=b(3567),ve=b(13013),ke=D.wR,Fn=function(e,n){if(!e)return[];var r=[],t=(0,Pe.isArr)(e)?e:[e];return t.reduce(function(a,i){var o=n(i);return o?a.concat(o):a},r)},On=function(e,n,r,t){var a=Object.keys(n.properties||{}).length,i=e.maxItems||2,o=a>i?n.mapProperties(function(d,u,g){return g<i?null:{key:g,label:(0,v.jsx)(j.RecursionField,{schema:d,name:"".concat(r,".").concat(u)})}}).filter(Boolean):void 0;return(0,v.jsx)(ke.Item,{index:r,record:function(){var u;return t==null||(u=t.value)===null||u===void 0?void 0:u[r]},children:(0,v.jsxs)(Z.Z,{size:"small",children:[n.mapProperties(function(d,u,g){return g>=i?null:(0,v.jsx)(j.RecursionField,{schema:d,name:"".concat(r,".").concat(u)},"".concat(r,".").concat(u))}),a>i?(0,v.jsx)(ve.Z,{menu:{items:o},children:(0,v.jsx)("a",{children:(0,v.jsx)(wn(),{})})}):null]})})},Zn=function(e){var n=M(),r=(0,j.useFieldSchema)(),t=function d(u){if(ce(u)||je(u)||Ae(u)){var g,c,s;if(!((g=u["x-component-props"])!==null&&g!==void 0&&g.dataIndex)&&!u.name)return[];var m=((c=u["x-component-props"])===null||c===void 0?void 0:c.dataIndex)||u.name,f=e.query(e.address.concat(m)).take(),h=(f==null||(s=f.component)===null||s===void 0?void 0:s[1])||u["x-component-props"]||{},p=(f==null?void 0:f.display)||u["x-display"];return[{name:m,display:p,field:f,schema:u,columnProps:h}]}else return u.properties?u.reduceProperties(function(y,x){return y.concat(d(x))},[]):[]};if(!r)throw new Error("can not found schema object");var a=Fn(r.items,t),i=a.reduce(function(d,u,g){var c,s=u.name,m=u.columnProps,f=u.schema,h=u.display;return n&&n._cofnig&&(n==null?void 0:n._cofnig._showColumns.length)>0&&(n==null||(c=n._cofnig._showColumns)===null||c===void 0?void 0:c.findIndex(function(p){return p===s}))===-1||h==="hidden"?d:je(f)?d.concat(R()(R()({fixed:!0},m),{},{key:g,dataIndex:s,render:function(y,x){var $,S=e==null||($=e.value)===null||$===void 0?void 0:$.indexOf(x);return On(m,f,S,e)}})):ce(f)?d.concat(R()(R()({},m),{},{filters:Array.isArray(m.filters)?m.filters:void 0,key:s,dataIndex:s,render:function(y,x){var $,S=e==null||($=e.value)===null||$===void 0?void 0:$.indexOf(x),A=(0,v.jsx)(ke.Item,{index:S,record:function(){var T;return e==null||(T=e.value)===null||T===void 0?void 0:T[S]},children:(0,v.jsx)(j.RecursionField,{schema:f,name:S,onlyRenderProperties:!0})});return A}})):d},[]),o=function(){return a.map(function(u,g){return ce(u.schema)?(0,v.jsx)(j.RecursionField,{schema:u.schema,name:u.name,onlyRenderSelf:!0},g):null})};return[i,o]},En=function l(e){var n;return((n=e.parent)===null||n===void 0?void 0:n["x-component"])==="QueryList"?e.parent:e.parent?l(e.parent):null},Dn=function l(e){if(e){var n=e.reduceProperties(function(r,t){if(r)return r;var a=t["x-component"]==="QueryTable.Selection";return a?!0:t.properties?l(t):!1},!1);return n}else return!1},Ln=function(e,n){var r=(0,j.useField)(),t=M(),a=(0,j.useFieldSchema)(),i=Dn(En(a)),o=(0,C.useRef)(e);(0,C.useEffect)(function(){o.current=e},[e]);var d=(0,C.useCallback)(function(){var u,g;if(t&&!(!i&&!n)){var c=t._cofnig,s=(0,O.observable)(R()(R()({type:"checkbox"},n),{},{selectedRows:(u=c._selectedRows)!==null&&u!==void 0?u:[],selectedRowKeys:(g=c._selectedRowKeys)!==null&&g!==void 0?g:[],clear:function(){c._selectedRowKeys=[],c._selectedRows=[]},reverse:function(){var f=r.value,h=f.filter(function(y){return!c._selectedRows.find(function(x){return x===y})}),p=h.map(function(y){var x=typeof o.current=="function"?o.current(y):y[o.current];return x});c._selectedRowKeys=p,c._selectedRows=h},onChange:function(f,h){c._selectedRowKeys=f,c._selectedRows=h}}));return c._selectReverse=s.reverse,c._selectClear=s.clear,s}},[t,r.value,i,n]);return d()},Te=b(27049),In=function(){var e=M(),n=(0,j.useFieldSchema)(),r=n.reduceProperties(function(t,a,i){return kn(a)&&t.push((0,v.jsx)(j.RecordScope,{getRecord:function(){var d,u,g,c;return{selectedRowKeys:(d=e==null||(u=e._cofnig)===null||u===void 0?void 0:u._selectedRowKeys)!==null&&d!==void 0?d:[],selectedRows:(g=e==null||(c=e._cofnig)===null||c===void 0?void 0:c._selectedRows)!==null&&g!==void 0?g:[]}},getIndex:function(){return-1},children:(0,v.jsx)(Z.Z,{split:(0,v.jsx)(Te.Z,{type:"vertical"}),children:a.mapProperties(function(o,d){return(0,v.jsx)(j.RecursionField,{schema:o,name:d},d)})})},i)),t},[]);return r.length>0?r:null},zn=b(8683),Ne=b(95742),Kn=(0,Ne.W8)(function(l){return(0,v.jsx)("tr",R()({},l))}),Mn=(0,Ne.JN)(function(l){return(0,v.jsx)("tbody",R()({},l))}),Bn=function(e){return(0,v.jsx)(Kn,R()({index:e["data-row-sort-index"]||0},e))},Hn=function(e,n){var r=document.body.querySelector(".".concat(n,"-sort-helper"));if(r){var t=e.querySelectorAll("td");requestAnimationFrame(function(){r.querySelectorAll("td").forEach(function(a,i){t[i]&&(a.style.width=getComputedStyle(t[i]).width)})})}},Qn=function(e){var n=(0,zn.usePrefixCls)("formily-array-table"),r=(0,j.useField)(),t=(0,j.useFieldSchema)(),a=re(),i=(0,C.useMemo)(function(){return An(t)},[t]),o=M(),d=(0,C.useCallback)(function(g){return(0,v.jsx)(Mn,R()({useDragHandle:!0,lockAxis:"y",helperClass:"".concat(n,"-sort-helper"),helperContainer:function(){var s;return(s=e.current)===null||s===void 0?void 0:s.querySelector("tbody")},onSortStart:function(s){var m=s.node;Hn(m,n)},onSortEnd:function(s){var m,f=s.oldIndex,h=s.newIndex,p=(m=r.componentProps)===null||m===void 0?void 0:m.onSort;if(typeof p=="function"){var y=p(f,h,(0,O.toJS)(r.value),a);y instanceof Promise?(r.setLoading(!0),r.move(f,h),y.then(function(x){if(x){var $;o==null||($=o._refresh)===null||$===void 0||$.call(o)}r.setLoading(!1)}).catch(function(){r.move(h,f),r.setLoading(!1)})):r.move(f,h)}else r.move(f,h)}},g))},[o,r,e,n,a]),u={wrapper:i?d:void 0,row:i?Bn:void 0};return u},Un=D.wR,Vn=function(e){var n=(0,j.useField)(),r=(0,j.useFieldSchema)(),t=r.reduceProperties(function(i,o,d){return Pn(o)?o:i},null),a=(0,C.useMemo)(function(){if(t)return R()(R()({},e),{},{expandedRowRender:function(o,d,u,g){return(0,v.jsx)(Un.Item,{index:d,record:function(){var s;return n==null||(s=n.value)===null||s===void 0?void 0:s[d]},children:(0,v.jsx)(j.RecursionField,{schema:t,name:d,onlyRenderProperties:!0})},g?"expand-".concat(new Date):"hidden-".concat(d))}})},[n==null?void 0:n.value,t,e]);return a},Wn=b(7339),Jn=b(24887),Gn=b(15026),Xn=b(32808),Yn=b(14670),qn=(0,j.observer)(function(l){var e=(0,j.useField)(),n=M();if(!n)return null;var r=n==null?void 0:n._cofnig,t=[{label:"\u9ED8\u8BA4",key:"default"},{label:"\u4E2D\u7B49",key:"middle"},{label:"\u7D27\u51D1",key:"small"}],a=In(),i=r._columns.map(function(o){var d=r._showColumns.findIndex(function(c){return c===o.key}),u=d>-1,g=function(s){s.stopPropagation(),s.preventDefault(),u?r._showColumns.splice(d,1):r._showColumns.push(o.key)};return{label:(0,v.jsxs)(Z.Z,{onClick:g,children:[(0,v.jsx)(Xn.Z,{checked:u}),o.label]}),key:o.key}});return(0,v.jsxs)(Z.Z,{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[(0,v.jsxs)(Z.Z,{size:"small",children:[(0,v.jsx)(Ce.Z.Title,{level:5,children:e.title||l.title}),r._selectedRowKeys.length?(0,v.jsx)(Yn.Z,{style:{padding:"3px 4px"},type:"info",message:(0,v.jsxs)(Z.Z,{size:"small",split:(0,v.jsx)(Te.Z,{type:"vertical"}),children:[(0,v.jsxs)(E.Z,{type:"text",size:"small",children:["\u9009\u4E2D ",r._selectedRowKeys.length," \u9879"]}),(0,v.jsx)(E.Z,{size:"small",onClick:function(){var d;(d=r._selectClear)===null||d===void 0||d.call(r)},type:"link",children:"\u53D6\u6D88\u9009\u62E9"}),(0,v.jsx)(E.Z,{size:"small",onClick:function(){var d;(d=r._selectReverse)===null||d===void 0||d.call(r)},type:"link",children:"\u53CD\u5411\u9009\u62E9"}),a]})}):null]}),(0,v.jsxs)(Z.Z,{size:"small",children:[(0,v.jsx)(Z.Z,{children:l.children}),(0,v.jsxs)(Z.Z,{size:"large",children:[(0,v.jsx)(Wn.Z,{onClick:function(){var d;n==null||(d=n._refresh)===null||d===void 0||d.call(n)},loop:n==null?void 0:n._loading}),(0,v.jsx)(ve.Z,{menu:{onClick:function(d){r._size=d.key},defaultValue:r._size,items:t},children:(0,v.jsx)(Jn.Z,{})},"size"),(0,v.jsx)(ve.Z,{menu:{items:i},children:(0,v.jsx)(Gn.Z,{})},"columns")]})]})]})}),fe,Kr=function(e,n){return"\u7B2C ".concat(n[-1],"-").concat(n[1]," \u6761, \u5171 ").concat(e," \u6761\u6570\u636E")},H=(0,j.observer)(function(l){var e,n,r=(0,C.useRef)(null),t=(0,Sn.F)("formily-array-table"),a=M(),i=(0,j.useField)(),o=Array.isArray(i.value)?i.value.slice():[],d=function($){return o.indexOf($)},u=Qn(r),g=Zn(i),c=K()(g,2),s=c[0],m=c[1],f=Tn(),h=Vn(l.expandable),p=Ln(l.rowKey||d,l.rowSelection);(0,C.useEffect)(function(){a&&(a._address.table=i.address.toString())},[a,i==null||(e=i.address)===null||e===void 0?void 0:e.toString()]),(0,C.useEffect)(function(){a!=null&&a.service&&i&&!i.data&&(i.data={},i.data.pagination={current:1,pageSize:a.pageSize||10})},[a,i,l.pagination]),(0,C.useEffect)(function(){if(a){var x=a._cofnig;s.forEach(function($){x._columns.findIndex(function(S){return S.key===$.dataIndex})===-1&&(x._columns.push({label:$.title,key:$.dataIndex}),x._showColumns.push($.dataIndex))})}},[s,a]);var y=function(){var $,S=i==null||($=i.data)===null||$===void 0?void 0:$.pagination,A=l.pagination||{},k=S?S.pageSize>S.total?!1:R()(R()(R()({},A),S),{},{showTotal:function(P,w){return"\u7B2C ".concat(w[0],"-").concat(w[1]," \u6761, \u5171 ").concat(P," \u6761\u6570\u636E")}}):!1;return k};return(0,v.jsx)("div",{ref:r,className:t,children:(0,v.jsxs)(D.wR,{children:[(0,v.jsx)(jn.Z,R()(R()({rowKey:d},l),{},{size:a==null||(n=a._cofnig)===null||n===void 0?void 0:n._size,expandable:h,rowSelection:p,onRow:function($,S){var A,k=(l==null||(A=l.onRow)===null||A===void 0?void 0:A.call(l,$,S))||{};return k["data-row-sort-index"]=S,k},columns:s,loading:l.loading||(a==null?void 0:a._loading),components:{body:u},dataSource:o,pagination:y(),onChange:function($,S,A,k){if(i.setData({pagination:$,filters:S,sorter:A,extra:k}),k.action==="paginate"){var T;a==null||(T=a._trigger)===null||T===void 0||T.call(a)}else if(k.action==="sort"&&a!==null&&a!==void 0&&a.sortRemote){var P;a==null||(P=a._trigger)===null||P===void 0||P.call(a)}else if(k.action==="filter"&&a!==null&&a!==void 0&&a.filterRemote){var w;a==null||(w=a._trigger)===null||w===void 0||w.call(a)}}})),m(),f]})})});D.wR===null||D.wR===void 0||(fe=D.wR.mixin)===null||fe===void 0||fe.call(D.wR,H),H.Operations=function(){return(0,v.jsx)(C.Fragment,{})},H.Column=function(){return(0,v.jsx)(C.Fragment,{})},H.Expand=function(){return(0,v.jsx)(C.Fragment,{})},H.Selection=function(){return(0,v.jsx)(C.Fragment,{})},H.Titlebar=qn;var _n=b(34041),er=function(e,n){var r=n;return e&&(r=Array.isArray(n)?n:[]),r},nr=function(e){var n=(0,C.useState)([]),r=K()(n,2),t=r[0],a=r[1],i=(0,C.useState)(er(e.multiple,e.value)),o=K()(i,2),d=o[0],u=o[1],g=(0,C.useState)(!1),c=K()(g,2),s=c[0],m=c[1],f=(0,C.useRef)(e.suggest);(0,C.useEffect)(function(){e.suggest&&(f.current=e.suggest)},[e.suggest]);var h=(0,C.useRef)(null),p=(0,C.useRef)(0),y=(0,C.useCallback)(function(S){var A=++p.current;h.current&&clearTimeout(h.current),h.current=setTimeout(function(){var k,T;m(!0),f.current||m(!1),(k=f.current)===null||k===void 0||(T=k.call(f,S))===null||T===void 0||T.then(function(P){A<p.current||a(P)}).finally(function(){m(!1)})},200)},[]),x=function(A){f.current&&(A?y(R()(R()({},e.params),{},{kw:A})):a([]))},$=function(A){var k;u(A),(k=e.onChange)===null||k===void 0||k.call(e,A)};return(0,v.jsx)(_n.Z,{showSearch:!0,loading:s,value:d,labelInValue:e.labelInValue,mode:e.multiple?"multiple":void 0,placeholder:e.placeholder,style:e.style,disabled:e.disabled,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:x,onChange:$,options:t})},rr=b(45211),tr=b(98261),or=b(82061),lr=b(51042),ir=b(85175),ar=b(53416),ur=function(e,n){return JSON.parse(JSON.stringify(e,function(r,t){return r===n?"__CLONE_".concat((0,ar.x0)()):t}))},dr=function l(e,n){var r,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,i=a||{};return(r=n(e).children)===null||r===void 0||r.forEach(function(o,d){var u=[].concat(B()(t),[d]);i[n(o).key]={parentKey:n(e).key,index:d,pos:u},n(o).children&&l(o,n,u,i)}),i},we=function(e,n,r){var t=me(n),a=r!=null?r:function(g){return ur(g,n.key)},i={pos:{},mapper:{}},o=function(){console.log("computed start");var c=performance.now();i.mapper=dr(e.root,t),i.pos=Object.keys(i.mapper).reduce(function(m,f){var h=i.mapper[f].pos;return m[f]=h,m},i.pos);var s=performance.now();console.log("computed end",s-c)},d=function(){o(),t(e.root).children=B()(t(e.root).children)};o();var u={get dataSource(){var g=t(e.root).children;return g},take:function(c){return t(c)},getPos:function(c){if(c===e.root)return[];var s=t(c).key;return s?(i.pos[s]||o(),i.pos[s]):null},posToParents:function(c){var s=e.root;return c.reduce(function(m,f){var h,p=(h=t(s).children)===null||h===void 0?void 0:h[f];return m.push(p),s=p,m},[])},posToPath:function(c){if(c){var s=c.reduce(function(m,f){return m?"".concat(m,".").concat(n.children,".").concat(f):"".concat(n.children,".").concat(f)},"");return s}},getNodeAtPos:function(c){if(c===null)return null;var s=c.reduce(function(m,f){var h;return(h=t(m).children)===null||h===void 0?void 0:h[f]},e.root);return s},append:function(c){for(var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"push",m=arguments.length,f=new Array(m>2?m-2:0),h=2;h<m;h++)f[h-2]=arguments[h];var p=this.getNodeAtPos(c);p&&(0,O.batch)(function(){if(!t(p).children||s==="replace")t(p).children=f;else if(s==="push"){var y;(y=t(p).children)===null||y===void 0||y.push.apply(y,f)}else{var x;(x=t(p).children)===null||x===void 0||x.unshift.apply(x,f)}d()})},copy:function(c,s){var m=this.getNodeAtPos(c),f=s!=null?s:a(m),h=c.slice(0,c.length-1),p=this.getNodeAtPos(h);!p||!m||(0,O.batch)(function(){var y,x=c[c.length-1]+1;(y=t(p).children)===null||y===void 0||y.splice(x,0,f),d()})},remove:function(c){var s=c.slice(0,c.length-1),m=c[c.length-1];if(m!=null){var f=this.getNodeAtPos(s);f&&(0,O.batch)(function(){var h;(h=t(f).children)===null||h===void 0||h.splice(m,1),d()})}},move:function(c,s){var m=this;if(JSON.stringify(c)!==JSON.stringify(s)){var f=c.length===s.length&&c.slice(0,c.length-1).join("_")===s.slice(0,s.length-1).join("_");(0,O.batch)(function(){if(f){var h,p,y=m.getNodeAtPos(c.slice(0,c.length-1)),x=c[c.length-1],$=s[s.length-1],S=(h=t(y).children)===null||h===void 0?void 0:h.splice(x,1)[0];(p=t(y).children)===null||p===void 0||p.splice($,0,S)}else{var A,k,T,P,w=m.getNodeAtPos(c.slice(0,c.length-1)),F=(A=t(w).children)===null||A===void 0||(k=A.splice)===null||k===void 0?void 0:k.call(A,c[c.length-1],1)[0];if(console.log("move before pick",F),!F)return;var U=m.getNodeAtPos(s.slice(0,s.length-1));(T=t(U).children)===null||T===void 0||(P=T.splice)===null||P===void 0||P.call(T,s[s.length-1],0,F)}d()})}}};return u},sr={title:"label",key:"value",children:"children"},Fe=(0,C.createContext)(null),Oe=(0,C.createContext)(null),oe=function(){var e=(0,C.useContext)(Fe);return e},q=function(){var e=oe();return e==null?void 0:e.$helper},Q=function(e){var n=oe(),r=(0,C.useContext)(Oe);if(e){var t=Array.isArray(e)?n==null?void 0:n.$helper.take(n==null?void 0:n.$helper.getNodeAtPos(e)).key:e;return n==null?void 0:n.$refs.get(t)}return r},cr=function(e){var n=e.children,r=e.getRoot,t=(0,C.useRef)({getRoot:r}),a=(0,C.useMemo)(function(){var i=new Map,o=R()(R()({},sr),e.fieldNames),d=we({root:t.current.getRoot()},o),u={get $root(){var g=t.current.getRoot();return g},get $helper(){return d},get $fieldNames(){return o},get $refs(){return i}};return u},[]);return(0,v.jsx)(j.ExpressionScope,{value:a,children:(0,v.jsx)(Fe.Provider,{value:a,children:n})})},vr=function(e){var n=oe(),r=e.getPos,t=e.getNode,a=e.children,i=(0,C.useRef)({getPos:r,getNode:t,disposer:function(){}}),o=(0,C.useMemo)(function(){if(!n)return null;var d=n.$refs,u=n.$helper,g={get $root(){return n.$root},get $pos(){return i.current.getPos(n.$root)},get $path(){return u.posToPath(this.$pos)},get $extra(){var s;return(s=e.getExtra)===null||s===void 0?void 0:s.call(e,this.$root)},get $record(){var s=typeof i.current.getNode=="function"?i.current.getNode(n.$root):u.getNodeAtPos(this.$pos),m=s===this.$root;return m?s:V()(s)==="object"?(0,Pe.lazyMerge)(s,{get $lookup(){return g.$lookup},get $index(){return g.$index},get $pos(){return g.$pos}}):s},get $lookup(){var s,m,f=((s=this.$pos)===null||s===void 0?void 0:s.slice(0,this.$pos.length-1))||[],h=u.getNodeAtPos(f),p=h?(m=n.$refs.get(u.take(h).key))===null||m===void 0?void 0:m.$record:void 0;return p!=null?p:this.$root},get $records(){var s;return(s=u.take(this.$lookup).children)!==null&&s!==void 0?s:[]},get $parents(){var s=Array.isArray(this.$pos)?B()(this.$pos):[],m=[];return s.reduce(function(f,h){var p;m.push(f);var y=(p=u.take(f).children)===null||p===void 0?void 0:p[h];return y},this.$root),m},get $index(){return this.$pos?this.$pos[this.$pos.length-1]:-1}},c=u.take(g.$record).key;return d.set(c,g),g},[]);return(0,v.jsx)(Oe.Provider,{value:o,children:(0,v.jsx)(j.ExpressionScope,{value:o,children:a})})},fr=["pos"],hr=["pos"],gr=["pos","factory","method"],mr=["pos","clone"],Ze=(0,C.createContext)(null),pr=(0,C.createContext)(null),_=function(){return(0,C.useContext)(Ze)},yr=function(e){return Array.isArray(e)?e:typeof e=="string"?e.split("-").map(Number).filter(function(n){return!Number.isNaN(n)}):[]},xr=function(e){var n=Q();return e?yr(e):n==null?void 0:n.$pos},N=function(e){var n=e.fieldNames,r=e.getRoot,t=e.children,a=(0,j.useField)(),i=(0,j.useFieldSchema)(),o=(0,C.useMemo)(function(){return{field:a,schema:i,props:e}},[a,e,i]);return(0,v.jsx)(Ze.Provider,{value:o,children:(0,v.jsx)(cr,{fieldNames:n,getRoot:r,children:t})})},Cr=function(e){var n=e.pos,r=e.children,t=e.getNode,a=e.getExtra;return(0,v.jsx)(vr,{getPos:n,getNode:t,getExtra:a,children:(0,v.jsx)(pr.Provider,{value:e,children:r})})},Rr=function(e){var n,r=Q(e.pos);return(r==null?void 0:r.$record)===(r==null?void 0:r.$root)?null:(0,v.jsxs)("span",R()(R()({},e),{},{children:["#",r==null||(n=r.$pos)===null||n===void 0?void 0:n.join("-")," "]}))},$r=function(e){var n,r,t=e.pos,a=z()(e,fr),i=_(),o=Q(t),d=(0,j.useField)(),u=q();if((o==null?void 0:o.$record)===(o==null?void 0:o.$root)||!i||i.field.pattern!=="editable")return null;var g=e.to==="up"&&(o==null?void 0:o.$index)===0||e.to==="down"&&(o==null?void 0:o.$index)===((n=o==null||(r=o.$records)===null||r===void 0?void 0:r.length)!==null&&n!==void 0?n:-1)-1;return g?null:(0,v.jsx)(E.Z,R()(R()({type:"link",size:"small",icon:(0,v.jsx)(tr.Z,{rotate:e.to==="up"?0:180})},a),{},{onClick:function(s){var m,f;if(s.stopPropagation(),!(d!=null&&d.disabled)&&o){var h=o.$pos,p=B()(h),y=h[h.length-1];p[p.length-1]=e.to==="down"?y+1:Math.max(y-1,0);var x=(m=(f=i.props).onMove)===null||m===void 0?void 0:m.call(f,h,p,o==null?void 0:o.$root);typeof(x==null?void 0:x.then)=="function"?x.then(function(){u==null||u.move(h,p)}):u==null||u.move(h,p)}},children:d.props.title||d.title}))},br=function(e){var n=e.pos,r=z()(e,hr),t=_(),a=Q(n),i=(0,j.useField)(),o=q();return!t||t.field.pattern!=="editable"||(a==null?void 0:a.$record)===(a==null?void 0:a.$root)?null:(0,v.jsx)(Se.Z,{title:i.content||"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6570\u636E\u5417?",okText:"\u662F\u7684",cancelText:"\u6211\u518D\u60F3\u60F3",onConfirm:function(u){var g,c,s;if(u==null||(g=u.stopPropagation)===null||g===void 0||g.call(u),!(i!=null&&i.disabled)&&a){var m=a.$pos,f=(c=(s=t.props).onRemove)===null||c===void 0?void 0:c.call(s,m,a.$record,a.$lookup,a==null?void 0:a.$root);typeof(f==null?void 0:f.then)=="function"?f.then(function(){o==null||o.remove(m)}):o==null||o.remove(m)}},children:(0,v.jsx)(E.Z,R()(R()({onClick:function(u){return u.stopPropagation()},type:"link",size:"small",icon:(0,v.jsx)(or.Z,{})},r),{},{children:i.props.title||i.title}))})},Sr=function(e){var n=e.pos,r=e.factory,t=e.method,a=z()(e,gr),i=_(),o=Q(n),d=(0,j.useField)(),u=q();return!i||i.field.pattern!=="editable"?null:(0,v.jsx)(E.Z,R()(R()({type:"dashed",size:"small",icon:(0,v.jsx)(lr.Z,{})},a),{},{onClick:function(c){var s,m;if(c.stopPropagation(),!(d!=null&&d.disabled)&&o){var f=o.$pos,h=(s=i.props)===null||s===void 0||(m=s.onAdd)===null||m===void 0?void 0:m.call(s,f,o.$record,o.$lookup,o.$root);typeof(h==null?void 0:h.then)=="function"?h.then(function(p){setTimeout(function(){u==null||u.append(f,t,p!=null?p:r==null?void 0:r(o.$record))})}):u==null||u.append(f,t,(r==null?void 0:r(o.$record))||{})}},children:d.props.title||d.title}))},jr=function(e){var n=e.pos,r=e.clone,t=z()(e,mr),a=_(),i=Q(n),o=(0,j.useField)(),d=q();return!a||a.field.pattern!=="editable"||(i==null?void 0:i.$record)===(i==null?void 0:i.$root)?null:(0,v.jsx)(E.Z,R()(R()({type:"link",size:"small",icon:(0,v.jsx)(ir.Z,{})},t),{},{onClick:function(g){var c,s;if(g.stopPropagation(),!(o!=null&&o.disabled)&&i){var m=i.$pos,f=(c=a.props)===null||c===void 0||(s=c.onCopy)===null||s===void 0?void 0:s.call(c,m,i.$record,i.$lookup,i.$root);if(typeof(f==null?void 0:f.then)=="function")f.then(function(p){var y=p!=null?p:r==null?void 0:r(i.$record);d==null||d.copy(m,y)});else{var h=r==null?void 0:r(i.$record);d==null||d.copy(m,h)}}},children:o.props.title||o.title}))};N.Node=Cr,N.Move=$r,N.Pos=Rr,N.Remove=br,N.Append=Sr,N.Copy=jr,N.useNode=Q,N.useTree=_,N.usePos=xr,N.useRoot=oe,N.useHelper=q,N.mixin=function(l){return l.Node=N.Node,l.Move=N.Move,l.Pos=N.Pos,l.Remove=N.Remove,l.Append=N.Append,l.Copy=N.Copy,l.useNode=N.useNode,l.useTree=N.useTree,l.usePos=N.usePos,l.useRoot=N.useRoot,l.useHelper=N.useHelper,l};var L=N,Ar=["loadAll","loadData","checkedKeys","fieldNames","children"],Pr=["onAdd","value","fieldNames","onCopy","onMove","onRemove","layout"],kr={title:"label",key:"value",children:"children"},Ee=function(){var e=(0,C.useRef)(null);return(0,C.useEffect)(function(){for(var n,r=(n=e.current)===null||n===void 0?void 0:n.parentElement,t=null;r&&!t;)t=/ant-tree-treenode/.test(r.getAttribute("class")||"")?r:null,r=r.parentElement;t&&t.setAttribute("style","display: none")},[]),(0,v.jsx)("span",{ref:e,children:"hack"})},Tr=function(e){var n=L.useTree(),r=L.useHelper(),t=L.useNode(),a=(r==null?void 0:r.take(t==null?void 0:t.$record).key)!==e.dataKey;return a?(0,v.jsx)(Ee,{}):(0,v.jsx)("div",{onClick:function(o){var d;(o==null||(d=o.target)===null||d===void 0?void 0:d.tagName)==="INPUT"&&o.stopPropagation()},children:(0,v.jsx)(j.RecursionField,{name:t==null?void 0:t.$path,schema:n==null?void 0:n.schema.items})})},Nr=(0,j.observer)(function(l){var e,n,r=l.loadAll,t=l.loadData,a=l.checkedKeys,i=l.fieldNames,o=l.children,d=z()(l,Ar),u=L.useHelper(),g=(0,j.useField)(),c=(0,ee.Z)({loadData:t,loadAll:r,onDrop:l.onDrop}),s=(0,C.useCallback)(function(f){if(!c.current.loadAll&&c.current.loadData&&u){var h=u.getPos(f),p=u.posToParents(h),y=p[p.length-1];return y.loading=!0,c.current.loadData(p).then(function(x){u.append.apply(u,[h,"replace"].concat(B()(x)))}).finally(function(){y.loading=!1})}},[u,c]),m=(0,C.useCallback)(function(f){var h,p,y=f.dragNode,x=f.node,$=y.pos.split("-").map(Number);$.shift();var S=x.pos.split("-").map(Number);S.shift();var A=(h=(p=c.current).onDrop)===null||h===void 0?void 0:h.call(p,$,S);typeof(A==null?void 0:A.then)=="function"?A.then(function(){u==null||u.move($,S)}):u==null||u.move($,S)},[u,c]);return(0,v.jsxs)(C.Fragment,{children:[(0,v.jsx)(xe,{}),(0,v.jsx)(rr.Z,R()(R()({showLine:!0,blockNode:!0},d),{},{className:"".concat(l.className," fireformily-tree"),titleRender:function(h){if(!u)return null;var p=u.getPos(h);return p?(0,v.jsx)(L.Node,{pos:function(){return u.getPos(h)},getExtra:function(){var x,$,S,A,k=u.take(h).key,T=g.value,P=T,w=P.selectedKeys,F=w===void 0?[]:w,U=P.checkedKeys,J=U===void 0?[]:U,I=P.halfCheckedKeys,ie=I===void 0?[]:I,ze=P.expandedKeys,ae=ze===void 0?[]:ze;return{checked:J==null||(x=J.includes)===null||x===void 0?void 0:x.call(J,k),halfChecked:ie==null||($=ie.includes)===null||$===void 0?void 0:$.call(ie,k),selecteds:F==null||(S=F.includes)===null||S===void 0?void 0:S.call(F,k),expanded:ae==null||(A=ae.includes)===null||A===void 0?void 0:A.call(ae,k)}},children:(0,v.jsx)(Tr,{dataKey:u.take(h).key})},u.take(h).key):(0,v.jsx)(Ee,{})},expandedKeys:(e=g.value.expandedKeys)!==null&&e!==void 0?e:[],onExpand:function(h){g.setState(function(p){p.value.expandedKeys=h})},selectedKeys:(n=g.value.selectedKeys)!==null&&n!==void 0?n:[],onSelect:function(h){g.setState(function(p){p.value.selectedKeys=h})},checkedKeys:g.value.checkedKeys,onCheck:function(h,p){if(g.value){var y=Array.isArray(h)?h:h.checked,x=Array.isArray(h)?p.halfCheckedKeys:h.halfChecked;g.setState(function($){$.value.checkedKeys=y,$.value.halfCheckedKeys=x!=null?x:[]})}},fieldNames:i,treeData:u==null?void 0:u.dataSource,onDrop:m,loadData:t&&!r?s:void 0}))]})}),De=function(e){var n=e.onAdd,r=e.value,t=e.fieldNames,a=e.onCopy,i=e.onMove,o=e.onRemove,d=e.layout,u=z()(e,Pr),g=(0,j.useField)(),c=(0,j.useFieldSchema)(),s=(0,C.useMemo)(function(){return R()(R()({},kr),t)},[t]),m=(0,ee.Z)({loader:e.loadAll||e.loadData});return(0,C.useEffect)(function(){m.current.loader&&(g.selfModified||m.current.loader([]).then(function(f){console.log("reloaddd"),g.setState(function(h){h.value.children=f})}))},[]),(0,v.jsx)(C.Fragment,{children:(0,v.jsxs)(L,{getRoot:function(){return g.value},fieldNames:s,onAdd:n,onRemove:o,onCopy:a,onMove:i,children:[(0,v.jsx)(j.RecursionField,{schema:c,onlyRenderSelf:!0}),(0,v.jsxs)(Z.Z,R()(R()({size:"small"},d),{},{children:[(0,v.jsxs)(Z.Z,{direction:"vertical",size:"small",children:[(0,v.jsx)(L.Node,{getNode:function(){return g.value},pos:function(){return[]},children:(0,v.jsx)(j.RecursionField,{schema:c.items,onlyRenderProperties:!0,name:""})}),(0,v.jsx)(Nr,R()(R()({},u),{},{fieldNames:s}))]}),(0,v.jsx)(j.RecursionField,{schema:c,name:"",onlyRenderProperties:!0})]}))]})})};L.mixin(De);var Le=function(e){return ue[e%ue.length]},wr=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n={emap:e.reduce(function(r,t){return r[t.value]=t.label,r[t.label]=t.value,r},{}),colors:e.reduce(function(r,t,a){var i=t.color||Le(a);return r[t.value]=i,r[t.label]=i,r},{}),options:e.map(function(r,t){return R()(R()({},r),{},{key:r.value,color:r.color||Le(t)})})};return n},Fr=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"label",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"value";return e.map(function(t){return{key:t[r],label:t[n],value:t[r],color:t.color}})},Or=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"label",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"value";return wr(e.map(function(t){return{key:t[r],label:t[n],value:t[r],color:t.color}}))},W=(0,O.observable)({}),Zr=W,le={},Ie={},Er=function(e,n){le[e]=function(){return n(Fr).then(function(r){var t=Or(r);return W[e]=t,W[e]})}},Dr=function(e){(0,G.cW)("*",function(n){var r,t=(r=n.data)===null||r===void 0?void 0:r.dict;if(t){var a=n.data.dictNoCache;if(!W[t]&&!le[t])throw new Error("\u8BCD\u5178 ".concat(t," \u7684\u52A0\u8F7D\u5668\u4E0D\u5B58\u5728!"),t);if(a!==!0&&W[t])n.setState(function(o){o.dataSource=W[t].options,o.componentProps&&(o.componentProps.options=o.dataSource)});else if(t&&le[t]){n.setState(function(o){o.loading=!0});var i=Ie[t]||le[t]();Ie[t]=i.then(function(o){return n.setState(function(d){d.dataSource=o.options,d.componentProps&&(d.componentProps.options=d.dataSource),d.loading=!1}),o}).catch(function(o){throw n.setState(function(d){d.loading=!1}),o})}}}),(0,G.lC)("*",function(n){var r,t,a=(r=n.data)===null||r===void 0?void 0:r.dict;if(a){var i=function(u,g){var c=Array.isArray(u)?u[0]:u,s=Array.isArray(g)?g[0]:g;return c===s},o=n.readPretty||n.readOnly;o?i(n.component,se)||(n.data.__origin_component=n.component,n.setComponent(se)):(t=n.data)!==null&&t!==void 0&&t.__origin_component&&!i(n.data.__origin_component,n.component)&&n.setComponent(n.data.__origin_component)}})},Lr=function(e){var n=typeof e=="function"?e():e;return(0,O.isSupportObservable)(n)?(0,O.observable)(n):(console.log("WARNING!!, not support obserable"),n)},Ir=function(e){var n=(0,C.useMemo)(function(){return Lr(e!=null?e:{})},[]);return n}}}]);
