"use strict";(self.webpackChunkfireformily=self.webpackChunkfireformily||[]).push([[419],{53419:function(Kr,ge,j){j.r(ge),j.d(ge,{Dict:function(){return se},ImageView:function(){return We},Linkage:function(){return nn},Loading:function(){return Ce},LongText:function(){return an},PopActions:function(){return Y},QueryForm:function(){return $n},QueryList:function(){return jn},QueryTable:function(){return B},Suggestion:function(){return rr},TreeBase:function(){return L},TreeNodes:function(){return De},colors:function(){return ue},dict:function(){return Er},dictEffects:function(){return Lr},eqeq:function(){return He},getTreeHelper:function(){return we},isColorStatus:function(){return de},registerDictLoader:function(){return Dr},takeTake:function(){return pe},useExpressionScope:function(){return re},useLive:function(){return zr}});var C=j(67294),Ke=j(97857),x=j.n(Ke),me={success:"green",processing:"blue",error:"red",warning:"gold",default:"#fafafa"},ue=x()({length:11,0:"magenta",1:"green",2:"cyan",3:"geekblue",4:"purple",5:"red",6:"orange",7:"lime",8:"blue",9:"volcano",10:"gold",magenta:"magenta",green:"green",cyan:"cyan",geekblue:"geekblue",purple:"purple",red:"red",orange:"orange",lime:"lime",blue:"blue",volcano:"volcano",gold:"gold"},me),de=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return!!me[e]},Me=j(52677),V=j.n(Me),pe=function(e){return function(n){return{get key(){return n&&n[e.key]},set key(r){V()(n)==="object"&&(n[e.key]=r)},get title(){return n&&n[e.title]},set title(r){V()(n)==="object"&&(n[e.title]=r)},get children(){return n&&n[e.children]},set children(r){V()(n)==="object"&&(n[e.children]=r)}}}},Be=Object.prototype.hasOwnProperty;function ye(i,e){return i===e?i!==0||e!==0||1/i===1/e:i!==i&&e!==e}function He(i,e){if(ye(i,e))return!0;if(V()(i)!=="object"||i===null||V()(e)!=="object"||e===null)return!1;var n=Object.keys(i),r=Object.keys(e);if(n.length!==r.length)return!1;for(var t=0;t<n.length;t++)if(!Be.call(e,n[t])||!ye(i[n[t]],e[n[t]]))return!1;return!0}var Z=j(26713),Qe=j(63922),Ue=j(20550),c=j(85893),se=function(e){var n=e.strict,r=e.type,t=e.value,a=e.options,l=(0,C.useMemo)(function(){if(!Array.isArray(a))return[];var o=Array.isArray(t)?t.map(function(s){return a.find(function(v){return n?v.value===s:v.value==s})}):[a.find(function(s){return n?s.value===t:s.value==t})];return o.filter(Boolean)},[a,n,t]);return(0,c.jsx)(Z.Z,{size:"small",children:l.map(function(o){return r==="badge"?(0,c.jsx)(Qe.Z,{status:de(o==null?void 0:o.color)?o==null?void 0:o.color:void 0,color:de(o==null?void 0:o.color)||o==null?void 0:o.color,text:o==null?void 0:o.label},o==null?void 0:o.key):r==="tag"?(0,c.jsx)(Ue.Z,{color:o==null?void 0:o.color,children:o==null?void 0:o.label},o==null?void 0:o.key):o==null?void 0:o.label})})},xe=j(63917),Ve={width:"60px",height:"60px",objectFit:"contain"},We=function(e){var n=e.value,r=e.style,t=(0,C.useMemo)(function(){var l=Array.isArray(n)?n:[n];return l.filter(Boolean)},[n]),a=(0,C.useMemo)(function(){return x()(x()({},Ve),r)},[r]);return(0,c.jsx)(C.Fragment,{children:(0,c.jsx)(xe.Z.PreviewGroup,{children:t.map(function(l){return(0,c.jsx)(xe.Z,{style:a,src:l,preview:!0},l)})})})},Je=j(19632),H=j.n(Je),Ge=j(13769),z=j.n(Ge),A=j(27420),O=j(85667),ee=j(3930),Xe=j(45239),Ye=["value","loadAll","labelInValue","disabled","multiple","onChange","loadData"],qe={width:"100%"},_e=function(e,n){return e&&Array.isArray(n)?n.length>0?n==null?void 0:n.reduceRight(function(r,t){return r?(t.children=r,t.__init=!0,[t]):(t.isLeaf=!0,[t])},null):[]:[]},en=function(e){var n=e.loadData,r=e.loadAll,t=e.value,a=e.labelInValue,l=(0,ee.Z)(r||n),o=(0,C.useMemo)(function(){return(0,O.observable)({inited:!1,loading:!1,options:_e(a,t),load:function(m){var f,h,p=m[m.length-1];p&&(p.loading=!0,o.loading=!0,(f=l.current)===null||f===void 0||(h=f.call(l,m).then(function(y){y?p.children=y.map(function(R){return x()({isLeaf:!1},R)}):p.isLeaf=!0}))===null||h===void 0||h.finally(function(){p.loading=!1,o.loading=!1}))}})},[]);if(!o.inited&&!o.loading){var s,v,g;o.loading=!0,o.inited=!0;var u=Array.isArray(t)?a?t:t.map(function(d){return{value:d}}):[];(s=l.current)===null||s===void 0||(v=s.call(l,u))===null||v===void 0||(g=v.then(function(d){d&&(o.options=d.map(function(m){return x()({isLeaf:!1},m)}))}))===null||g===void 0||g.finally(function(){o.loading=!1})}return o},nn=function(e){var n=e.value,r=e.loadAll,t=e.labelInValue,a=e.disabled,l=e.multiple,o=e.onChange,s=e.loadData,v=z()(e,Ye),g=en(e),u=(0,C.useCallback)(function(m,f){return t?o==null?void 0:o(f):o==null?void 0:o(m)},[t,o]),d=function m(f){return Array.isArray(f)?f.map(function(h){return Array.isArray(h)?m(h):h.label?h.value:h}):[]};return(0,c.jsx)(A.Observer,{children:function(){return(0,c.jsx)(Xe.Z,x()(x()({disabled:a,multiple:l,changeOnSelect:!0},v),{},{loading:g.loading,value:d(n),style:e.style||qe,options:H()(g.options),loadData:r?void 0:g.load,onChange:u}))}})},rn=j(5574),K=j.n(rn),tn=j(19491),on={position:"absolute",transition:"all ease 0.2s"},Ce=function(e){var n=(0,C.useState)(!0),r=K()(n,2),t=r[0],a=r[1];return(0,C.useLayoutEffect)(function(){setTimeout(function(){a(!1)},67)},[]),(0,c.jsx)(tn.Z,{style:x()(x()({},on),{},{display:t?"":"none"}),paragraph:!0,loading:!0})},Re=j(49420),ln=Re.Z.Paragraph,an=function(e){return(0,c.jsx)(ln,x()(x()({copyable:!0,ellipsis:!0},e),{},{style:{marginBottom:0},children:e.value}))},un=j(63463),E=j(71577),dn=function(){},ne=function(e){var n,r,t,a,l=e.field,o=e.loading,s=e.open,v=e.scope,g=(v==null?void 0:v.$index)!==void 0,u=o?dn:s;return l.display!=="visible"?null:(0,c.jsx)(E.Z,{onClick:u,size:g?"small":(r=l.componentProps)===null||r===void 0?void 0:r.size,type:g?"link":(a=l.componentProps)===null||a===void 0?void 0:a.type,children:l==null?void 0:l.title})},G=j(99619),sn=j(44620),re=function(){var e=(0,A.useField)(),n=(0,A.useExpressionScope)();return e.record?x()({$record:e.record,$lookup:e.records,$records:e.records,$index:e.index},n):n},cn=["pageSize","current"],$e=function(){},je=(0,C.createContext)(null),vn=C.memo(function(i){var e,n=(0,A.useForm)(),r=(0,C.useRef)({}),t=(0,sn.Z)(),a=K()(t,2),l=a[0],o=a[1],s=(0,C.useRef)(!1),v=re(),g=(0,C.useRef)(!1),u=(0,C.useRef)({service:i.service}),d=(0,C.useCallback)(function(y){var R=u.current.service;if(r.current=y,i.syncUrl){var $=y||{pagination:{}},S=$.pagination,b=S.pageSize,P=S.current,T=$.params;o(function(k){var N=x()({},k);return Object.keys(N).forEach(function(F){N[F]=void 0}),x()(x()(x()({},N),T),{},{pageSize:b,current:P})})}return p.current._loading=!0,R(x()(x()({},y),{},{scope:v})).then(function(k){var N=k.list,F=k.total,U=p.current._address.table,J=n.query(U).take();return U?(J.setState(function(I){(0,O.batch)(function(){I.value=N,I.data=I.data||{},I.data.pagination=I.data.pagination||{},I.data.pagination.total=F})}),{list:N,total:F}):{list:[],total:0}}).finally(function(){p.current._loading=!1})},[n,i.syncUrl,v,o]),m=(0,C.useCallback)(function(){var y=p.current._address.query,R=n.query(y).take(),$=p.current._address.table,S=n.query($).take();return d(x()({params:R==null?void 0:R.value},S==null?void 0:S.data))},[d,n]),f=(0,C.useCallback)(function(){var y=r.current;return d(y)},[d]),h=(0,C.useCallback)(function(){var y,R,$=p==null||(y=p.current)===null||y===void 0||(R=y._address)===null||R===void 0?void 0:R.table;if($){var S;(S=n.query($).take())===null||S===void 0||S.setState(function(b){(0,O.batch)(function(){b.data=b.data||{},b.data.pagination=b.data.pagination||{},b.data.pagination.current=1})})}return m()},[m,n]),p=(0,C.useRef)((0,O.observable)(x()(x()({},i),{},{service:i.service?d:void 0,syncUrl:i.syncUrl,pageSize:i.pageSize,_refresh:i.service?f:void 0,_reset:i.service?h:void 0,_trigger:i.service?m:void 0,_address:{query:"",table:""},_scope:v,_cofnig:{_size:(e=i.size)!==null&&e!==void 0?e:"default",_columns:[],_showColumns:[],_selectedRows:[],_selectedRowKeys:[],_selectClear:$e,_selectReverse:$e}})));return(0,C.useEffect)(function(){if(i.syncUrl&&!s.current){var y=p.current._address,R=l||{},$=R.pageSize,S=R.current,b=z()(R,cn);if($&&y!==null&&y!==void 0&&y.table){var P;(P=n.query(y.table).take())===null||P===void 0||P.setState(function(k){(0,O.batch)(function(){k.data=k.data||{},k.data.pagination=k.data.pagination||{},k.data.pagination.pageSize=Number(l.pageSize),k.data.pagination.current=Number(l.current)})})}if(b&&Object.keys(b).length>0&&y!==null&&y!==void 0&&y.query){var T;(T=n.query(y.query).take())===null||T===void 0||T.setState(function(k){k.value=x()(x()({},k.value),b)})}y!=null&&y.table&&setTimeout(function(){s.current=!0},0)}},[n,i.syncUrl,l]),(0,C.useEffect)(function(){if(u.current.service){var y=(0,O.autorun)(function(){var R,$=(R=p.current._address)===null||R===void 0?void 0:R.table;g.current===!1&&$&&p.current.autoload!==!1&&setTimeout(function(){m(),g.current=!0})});return function(){y()}}},[m]),(0,C.useEffect)(function(){var y=p.current;y.autoload!==i.autoload&&(y.autoload=i.autoload),y.filterRemote!==i.filterRemote&&(y.filterRemote=i.filterRemote),y.sortRemote!==i.sortRemote&&(y.sortRemote=i.sortRemote),y.syncUrl!==i.syncUrl&&(y.syncUrl=i.syncUrl)},[i.autoload,i.filterRemote,i.sortRemote,i.syncUrl]),(0,c.jsx)(je.Provider,{value:p.current,children:(0,c.jsx)(A.ExpressionScope,{value:{get $query(){var y,R=(y=p.current._address)===null||y===void 0?void 0:y.query;return R?n.query(R).take().value:null},get $list(){var y,R=(y=p.current._address)===null||y===void 0?void 0:y.table;return R?n.query(R).take().value:null}},children:i.children})})}),M=function(){var e=(0,C.useContext)(je);return e},fn=function(){return new Promise(function(e){setTimeout(function(){e("")},0)})},hn=function(e){return(0,O.isObservable)(e)?e:Array.isArray(e)?H()(e):x()({},e)},X=function(){return Promise.resolve({})},gn=function(e){return Promise.resolve(x()({},e))},te=function(){var e,n=(0,A.useField)(),r=re(),t=M(),a=n==null||(e=n.componentProps)===null||e===void 0?void 0:e.actions,l=(0,C.useRef)({open:!1,reset:!1,submit:!1}),o=(0,A.useFieldSchema)(),s=(0,ee.Z)(a||{}),v=(0,C.useState)(!1),g=K()(v,2),u=g[0],d=g[1],m=(0,C.useState)(!1),f=K()(m,2),h=f[0],p=f[1],y=(0,C.useCallback)(function(){if(!n.disabled&&!h&&!l.current.open){l.current.open=!0;var T=s.current.load||gn;return p(!0),T(r).then(function(k){n.setState(function(N){N.value=hn(k)}),d(!0)}).finally(function(){l.current.open=!1,p(!1)})}},[n,h,s,r]),R=(0,C.useCallback)(function(){if(!n.disabled&&!(h||!u)&&!l.current.reset){l.current.reset=!0;var T=(0,G.JF)(n)?X:function(){return n.reset()},k=s.current.cancel||X;return T().then(function(){return k(r)}).then(function(){d(!1)}).finally(function(){l.current.reset=!1,p(!1)})}},[n,h,s,r,u]),$=(0,C.useCallback)(function(){if(!n.disabled&&!(h||!u)&&!l.current.submit){l.current.submit=!0;var T=(0,G.JF)(n)?X:function(){return n.submit()},k=(0,G.JF)(n)?X:function(){return n.reset()},N=s.current.submit||X;return T().then(function(F){return N(F,r)}).then(function(){return d(!1),fn().then(k)}).finally(function(){var F;p(!1),l.current.submit=!1,t==null||(F=t._refresh)===null||F===void 0||F.call(t)})}},[t,n,h,s,r,u]),S=(0,C.useMemo)(function(){return n.content?n.content:null},[n.content]),b=(0,C.useMemo)(function(){return o?(0,c.jsx)(C.Fragment,{children:(0,c.jsx)(A.RecursionField,{schema:o})}):null},[o]),P=(0,C.useMemo)(function(){return(0,c.jsxs)(Z.Z,{style:{display:"flex",justifyContent:"flex-end",marginBottom:"16px"},children:[(0,c.jsx)(E.Z,{loading:h,onClick:R,children:"\u53D6\u6D88"}),(0,c.jsx)(E.Z,{loading:h,onClick:$,type:"primary",children:"\u786E\u5B9A"})]})},[h,R,$]);return{submit:$,field:n,reset:R,open:y,visible:u,loading:h,body:b,header:S,footer:P,scope:r}},mn=function(e){var n=te(),r=n.body,t=n.field,a=n.footer,l=n.header,o=n.loading,s=n.scope,v=n.open,g=n.reset,u=n.visible;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(un.Z,x()(x()({width:"68.88%",closable:!0,keyboard:!0},e),{},{title:e.title||t.title,onClose:function(m){var f;g(),e==null||(f=e.onClose)===null||f===void 0||f.call(e,m)},open:u,afterOpenChange:function(m){var f;m||g(),e==null||(f=e.afterOpenChange)===null||f===void 0||f.call(e,m)},footer:a,children:[l,r]})),(0,c.jsx)(ne,{open:v,field:t,loading:o,scope:s})]})},pn=j(85402),be=function(e){var n=te(),r=n.visible,t=n.body,a=n.field,l=n.scope,o=n.footer,s=n.header,v=n.loading,g=n.open,u=n.reset;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(pn.Z,x()(x()({maskClosable:!1,keyboard:!1,closable:!1,width:"68.88%"},e),{},{afterClose:function(){var m;e==null||(m=e.afterClose)===null||m===void 0||m.call(e),u()},open:r,title:e.title||a.title,footer:o,children:[s,t]})),(0,c.jsx)(ne,{open:g,field:a,loading:v,scope:l})]})},Se=j(65360),yn=function(e){var n=te(),r=n.body,t=n.field,a=n.header,l=n.loading,o=n.scope,s=n.open,v=n.reset,g=n.submit,u=n.visible;return(0,c.jsx)(Se.Z,x()(x()({},e),{},{title:(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("h4",{children:t.title||a}),t.title?null:a,r]}),cancelButtonProps:{loading:l},okButtonProps:{loading:l},onCancel:v,onConfirm:g,open:u,onOpenChange:function(m){var f;m||v(),e==null||(f=e.onOpenChange)===null||f===void 0||f.call(e,m)},children:(0,c.jsx)(ne,{open:s,field:t,loading:l,scope:o})}))},xn=j(55241),Cn=function(e){var n=te(),r=n.body,t=n.field,a=n.scope,l=n.footer,o=n.header,s=n.loading,v=n.open,g=n.reset,u=n.visible;return console.log("--popovver",{visible:u}),(0,c.jsx)(xn.Z,x()(x()({},e),{},{trigger:"click",title:e.title||t.title,content:(0,c.jsxs)(c.Fragment,{children:[o,r,l]}),open:u,onOpenChange:function(m){var f;e==null||(f=e.onOpenChange)===null||f===void 0||f.call(e,m),m||g()},children:(0,c.jsx)(ne,{open:v,field:t,loading:s,scope:a})}))},Y=be;Y.Drawer=mn,Y.Modal=be,Y.Popconfirm=yn,Y.Popover=Cn;var D=j(55668),Rn=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.maxRows||1,r=(0,C.useMemo)(function(){return D.T5.createFormGrid({maxColumns:e.maxColumns||4,maxWidth:e.maxWidth||320,maxRows:n,shouldVisible:function(s,v){return s.index===r.childSize-1||v.maxRows===1/0?!0:s.shadowRow<n+1}})},[e.maxColumns,e.maxWidth,n]),t=r.fullnessLastColumn?r.shadowRows-1:r.shadowRows,a=t<=n?void 0:r.maxRows===1/0,l=function(){r.maxRows===1/0?r.maxRows=n:r.maxRows=1/0};return{grid:r,expanded:a,toggle:l}},$n=(0,A.observer)(function(i){var e,n=i.resetText,r=i.submitText,t=(0,A.useField)(),a=(0,A.useForm)(),l=Rn(i.grid),o=l.grid,s=l.expanded,v=l.toggle,g=M(),u=g||{},d=u._loading,m=u._refresh,f=u._reset,h=u._trigger,p=function(){if(!d)if(g){var S;a.reset((S=g._address)===null||S===void 0?void 0:S.query,{forceClear:!0,validate:!1}).then(function(){f==null||f()})}else setTimeout(function(){f==null||f()})},y=function(){if(!d)return h==null?void 0:h()};(0,C.useEffect)(function(){g&&(g._address.query=t.address.toString())},[g,t==null||(e=t.address)===null||e===void 0?void 0:e.toString()]);var R=function(){return(0,c.jsxs)(D.d5,{align:"right",style:{width:"100%",marginBottom:"22px",display:"flex",justifyContent:"flex-end"},children:[s!==void 0?(0,c.jsx)(E.Z,{type:"link",onClick:function(b){b.preventDefault(),v()},children:s?"\u6536\u8D77":"\u5C55\u5F00"}):null,(0,c.jsx)(E.Z,{onClick:p,children:n||"\u91CD\u7F6E"}),(0,c.jsx)(E.Z,{onClick:y,type:"primary",children:r||"\u67E5\u8BE2"})]})};return i.children?(0,c.jsxs)(D.T5,x()(x()({},o),{},{grid:o,children:[i.children,(0,c.jsx)(D.T5.GridColumn,{gridSpan:-1,style:{display:"flex",justifyContent:"space-between"},children:R()})]})):null}),jn=function(e){return(0,c.jsx)(vn,x()(x()({},e),{},{children:e.children}))},bn=j(31194),Sn=j(86296),An=function i(e){var n=e.items||e,r=n.reduceProperties(function(t,a){var l;return t||(a["x-component"]==="QueryTable"?null:((l=a["x-component"])===null||l===void 0?void 0:l.indexOf("SortHandle"))>-1?a:a.properties||a.items?i(a):t)});return r},ce=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Column"))>-1},Ae=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Operations"))>-1},Pn=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Actions"))>-1},Pe=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Addition"))>-1},kn=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Expand"))>-1},Tn=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Selection"))>-1},Nn=function(){var e=(0,A.useFieldSchema)();return e.reduceProperties(function(n,r,t){return Pe(r)?(0,c.jsx)(A.RecursionField,{schema:r,name:t}):n},null)},wn=j(5085),Fn=j.n(wn),ke=j(3567),ve=j(13013),fe=D.wR,On=function(e,n){if(!e)return[];var r=[],t=(0,ke.isArr)(e)?e:[e];return t.reduce(function(a,l){var o=n(l);return o?a.concat(o):a},r)},Zn=function(e,n,r,t){var a=Object.keys(n.properties||{}).length,l=e.maxItems||2,o=a>l?n.mapProperties(function(s,v,g){return g<l?null:{key:g,label:(0,c.jsx)(A.RecursionField,{schema:s,name:"".concat(r,".").concat(v)})}}).filter(Boolean):void 0;return(0,c.jsx)(fe.Item,{index:r,record:function(){var v;return t==null||(v=t.value)===null||v===void 0?void 0:v[r]},children:(0,c.jsxs)(Z.Z,{size:"small",children:[n.mapProperties(function(s,v,g){return g>=l?null:(0,c.jsx)(A.RecursionField,{schema:s,name:"".concat(r,".").concat(v)},"".concat(r,".").concat(v))}),a>l?(0,c.jsx)(ve.Z,{menu:{items:o},children:(0,c.jsx)("a",{children:(0,c.jsx)(Fn(),{})})}):null]})})},En=function(e){var n=M(),r=(0,A.useFieldSchema)(),t=function g(u){if(ce(u)||Ae(u)||Pe(u)){var d,m,f;if(!((d=u["x-component-props"])!==null&&d!==void 0&&d.dataIndex)&&!u.name)return[];var h=((m=u["x-component-props"])===null||m===void 0?void 0:m.dataIndex)||u.name,p=e.query(e.address.concat(h)).take(),y=(p==null||(f=p.component)===null||f===void 0?void 0:f[1])||u["x-component-props"]||{},R=(p==null?void 0:p.display)||u["x-display"];return[{name:h,display:R,field:p,schema:u,columnProps:y}]}else return u.properties?u.reduceProperties(function($,S){return $.concat(g(S))},[]):[]};if(!r)throw new Error("can not found schema object");var a=On(r.items,t),l=r.reduceProperties(function(g,u){return Pn(u)?u:g},null),o=a.reduce(function(g,u,d){var m,f=u.name,h=u.columnProps,p=u.schema,y=u.display;return n&&n._cofnig&&(n==null?void 0:n._cofnig._showColumns.length)>0&&(n==null||(m=n._cofnig._showColumns)===null||m===void 0?void 0:m.findIndex(function(R){return R===f}))===-1||y==="hidden"?g:Ae(p)?g.concat(x()(x()({fixed:!0},h),{},{key:d,dataIndex:f,render:function($,S){var b,P=e==null||(b=e.value)===null||b===void 0?void 0:b.indexOf(S);return Zn(h,p,P,e)}})):ce(p)?g.concat(x()(x()({},h),{},{filters:Array.isArray(h.filters)?h.filters:void 0,key:f,dataIndex:f,render:function($,S){var b,P=e==null||(b=e.value)===null||b===void 0?void 0:b.indexOf(S),T=(0,c.jsx)(fe.Item,{index:P,record:function(){var N;return e==null||(N=e.value)===null||N===void 0?void 0:N[P]},children:(0,c.jsx)(A.RecursionField,{schema:p,name:P,onlyRenderProperties:!0})});return T}})):g},[]);if(l){var s=x()(x()({},l["x-component-props"]),{},{key:"_act_",title:l.title,dataIndex:"\u64CD\u4F5C",render:function(u,d){var m,f=e==null||(m=e.value)===null||m===void 0?void 0:m.indexOf(d),h=(0,c.jsx)(fe.Item,{index:f,record:function(){var y;return e==null||(y=e.value)===null||y===void 0?void 0:y[f]},children:(0,c.jsx)(A.RecursionField,{schema:l,name:f,onlyRenderProperties:!0})});return h}});o.push(s)}var v=function(){return a.map(function(u,d){return ce(u.schema)?(0,c.jsx)(A.RecursionField,{schema:u.schema,name:u.name,onlyRenderSelf:!0},d):null})};return[o,v]},Dn=function i(e){var n;return((n=e.parent)===null||n===void 0?void 0:n["x-component"])==="QueryList"?e.parent:e.parent?i(e.parent):null},Ln=function i(e){if(e){var n=e.reduceProperties(function(r,t){if(r)return r;var a=t["x-component"]==="QueryTable.Selection";return a?!0:t.properties?i(t):!1},!1);return n}else return!1},In=function(e,n){var r=(0,A.useField)(),t=M(),a=(0,A.useFieldSchema)(),l=Ln(Dn(a)),o=(0,C.useRef)(e);(0,C.useEffect)(function(){o.current=e},[e]);var s=(0,C.useCallback)(function(){var v,g;if(t&&!(!l&&!n)){var u=t._cofnig,d=(0,O.observable)(x()(x()({type:"checkbox"},n),{},{selectedRows:(v=u._selectedRows)!==null&&v!==void 0?v:[],selectedRowKeys:(g=u._selectedRowKeys)!==null&&g!==void 0?g:[],clear:function(){u._selectedRowKeys=[],u._selectedRows=[]},reverse:function(){var f=r.value,h=f.filter(function(y){return!u._selectedRows.find(function(R){return R===y})}),p=h.map(function(y){var R=typeof o.current=="function"?o.current(y):y[o.current];return R});u._selectedRowKeys=p,u._selectedRows=h},onChange:function(f,h){u._selectedRowKeys=f,u._selectedRows=h}}));return u._selectReverse=d.reverse,u._selectClear=d.clear,d}},[t,r.value,l,n]);return s()},Te=j(27049),zn=function(){var e=M(),n=(0,A.useFieldSchema)(),r=n.reduceProperties(function(t,a,l){return Tn(a)&&t.push((0,c.jsx)(A.RecordScope,{getRecord:function(){var s,v,g,u;return{selectedRowKeys:(s=e==null||(v=e._cofnig)===null||v===void 0?void 0:v._selectedRowKeys)!==null&&s!==void 0?s:[],selectedRows:(g=e==null||(u=e._cofnig)===null||u===void 0?void 0:u._selectedRows)!==null&&g!==void 0?g:[]}},getIndex:function(){return-1},children:(0,c.jsx)(Z.Z,{split:(0,c.jsx)(Te.Z,{type:"vertical"}),children:a.mapProperties(function(o,s){return(0,c.jsx)(A.RecursionField,{schema:o,name:s},s)})})},l)),t},[]);return r.length>0?r:null},Kn=j(8683),Ne=j(95742),Mn=(0,Ne.W8)(function(i){return(0,c.jsx)("tr",x()({},i))}),Bn=(0,Ne.JN)(function(i){return(0,c.jsx)("tbody",x()({},i))}),Hn=function(e){return(0,c.jsx)(Mn,x()({index:e["data-row-sort-index"]||0},e))},Qn=function(e,n){var r=document.body.querySelector(".".concat(n,"-sort-helper"));if(r){var t=e.querySelectorAll("td");requestAnimationFrame(function(){r.querySelectorAll("td").forEach(function(a,l){t[l]&&(a.style.width=getComputedStyle(t[l]).width)})})}},Un=function(e){var n=(0,Kn.usePrefixCls)("formily-array-table"),r=(0,A.useField)(),t=(0,A.useFieldSchema)(),a=re(),l=(0,C.useMemo)(function(){return An(t)},[t]),o=M(),s=(0,C.useCallback)(function(g){return(0,c.jsx)(Bn,x()({useDragHandle:!0,lockAxis:"y",helperClass:"".concat(n,"-sort-helper"),helperContainer:function(){var d;return(d=e.current)===null||d===void 0?void 0:d.querySelector("tbody")},onSortStart:function(d){var m=d.node;Qn(m,n)},onSortEnd:function(d){var m,f=d.oldIndex,h=d.newIndex,p=(m=r.componentProps)===null||m===void 0?void 0:m.onSort;if(typeof p=="function"){var y=p(f,h,(0,O.toJS)(r.value),a);y instanceof Promise?(r.setLoading(!0),r.move(f,h),y.then(function(R){if(R){var $;o==null||($=o._refresh)===null||$===void 0||$.call(o)}r.setLoading(!1)}).catch(function(){r.move(h,f),r.setLoading(!1)})):r.move(f,h)}else r.move(f,h)}},g))},[o,r,e,n,a]),v={wrapper:l?s:void 0,row:l?Hn:void 0};return v},Vn=D.wR,Wn=function(e){var n=(0,A.useField)(),r=(0,A.useFieldSchema)(),t=r.reduceProperties(function(l,o,s){return kn(o)?o:l},null),a=(0,C.useMemo)(function(){if(t)return x()(x()({},e),{},{expandedRowRender:function(o,s,v,g){return(0,c.jsx)(Vn.Item,{index:s,record:function(){var d;return n==null||(d=n.value)===null||d===void 0?void 0:d[s]},children:(0,c.jsx)(A.RecursionField,{schema:t,name:s,onlyRenderProperties:!0})},g?"expand-".concat(new Date):"hidden-".concat(s))}})},[n==null?void 0:n.value,t,e]);return a},Jn=j(7339),Gn=j(24887),Xn=j(15026),Yn=j(32808),qn=j(14670),_n=(0,A.observer)(function(i){var e=(0,A.useField)(),n=M();if(!n)return null;var r=n==null?void 0:n._cofnig,t=[{label:"\u9ED8\u8BA4",key:"default"},{label:"\u4E2D\u7B49",key:"middle"},{label:"\u7D27\u51D1",key:"small"}],a=zn(),l=r._columns.map(function(o){var s=r._showColumns.findIndex(function(u){return u===o.key}),v=s>-1,g=function(d){d.stopPropagation(),d.preventDefault(),v?r._showColumns.splice(s,1):r._showColumns.push(o.key)};return{label:(0,c.jsxs)(Z.Z,{onClick:g,children:[(0,c.jsx)(Yn.Z,{checked:v}),o.label]}),key:o.key}});return(0,c.jsxs)(Z.Z,{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[(0,c.jsxs)(Z.Z,{size:"small",children:[(0,c.jsx)(Re.Z.Title,{level:5,children:e.title||i.title}),r._selectedRowKeys.length?(0,c.jsx)(qn.Z,{style:{padding:"3px 4px"},type:"info",message:(0,c.jsxs)(Z.Z,{size:"small",split:(0,c.jsx)(Te.Z,{type:"vertical"}),children:[(0,c.jsxs)(E.Z,{type:"text",size:"small",children:["\u9009\u4E2D ",r._selectedRowKeys.length," \u9879"]}),(0,c.jsx)(E.Z,{size:"small",onClick:function(){var s;(s=r._selectClear)===null||s===void 0||s.call(r)},type:"link",children:"\u53D6\u6D88\u9009\u62E9"}),(0,c.jsx)(E.Z,{size:"small",onClick:function(){var s;(s=r._selectReverse)===null||s===void 0||s.call(r)},type:"link",children:"\u53CD\u5411\u9009\u62E9"}),a]})}):null]}),(0,c.jsxs)(Z.Z,{size:"small",children:[(0,c.jsx)(Z.Z,{children:i.children}),(0,c.jsxs)(Z.Z,{size:"large",children:[(0,c.jsx)(Jn.Z,{onClick:function(){var s;n==null||(s=n._refresh)===null||s===void 0||s.call(n)},loop:n==null?void 0:n._loading}),(0,c.jsx)(ve.Z,{menu:{onClick:function(s){r._size=s.key},defaultValue:r._size,items:t},children:(0,c.jsx)(Gn.Z,{})},"size"),(0,c.jsx)(ve.Z,{menu:{items:l},children:(0,c.jsx)(Xn.Z,{})},"columns")]})]})]})}),he,Mr=function(e,n){return"\u7B2C ".concat(n[-1],"-").concat(n[1]," \u6761, \u5171 ").concat(e," \u6761\u6570\u636E")},B=(0,A.observer)(function(i){var e,n,r=(0,C.useRef)(null),t=(0,bn.F)("formily-array-table"),a=M(),l=(0,A.useField)(),o=Array.isArray(l.value)?l.value.slice():[],s=function($){return o.indexOf($)},v=Un(r),g=En(l),u=K()(g,2),d=u[0],m=u[1],f=Nn(),h=Wn(i.expandable),p=In(i.rowKey||s,i.rowSelection);(0,C.useEffect)(function(){a&&(a._address.table=l.address.toString())},[a,l==null||(e=l.address)===null||e===void 0?void 0:e.toString()]),(0,C.useEffect)(function(){a!=null&&a.service&&l&&!l.data&&(l.data={},l.data.pagination={current:1,pageSize:a.pageSize||10})},[a,l,i.pagination]),(0,C.useEffect)(function(){if(a){var R=a._cofnig;d.forEach(function($){R._columns.findIndex(function(S){return S.key===$.dataIndex})===-1&&(R._columns.push({label:$.title,key:$.dataIndex}),R._showColumns.push($.dataIndex))})}},[d,a]);var y=function(){var $,S=l==null||($=l.data)===null||$===void 0?void 0:$.pagination,b=i.pagination||{},P=S?S.pageSize>S.total?!1:x()(x()(x()({},b),S),{},{showTotal:function(k,N){return"\u7B2C ".concat(N[0],"-").concat(N[1]," \u6761, \u5171 ").concat(k," \u6761\u6570\u636E")}}):!1;return P};return(0,c.jsx)("div",{ref:r,className:t,children:(0,c.jsxs)(D.wR,{children:[(0,c.jsx)(Sn.Z,x()(x()({rowKey:s},i),{},{size:a==null||(n=a._cofnig)===null||n===void 0?void 0:n._size,expandable:h,rowSelection:p,onRow:function($,S){var b,P=(i==null||(b=i.onRow)===null||b===void 0?void 0:b.call(i,$,S))||{};return P["data-row-sort-index"]=S,P},columns:d,loading:i.loading||(a==null?void 0:a._loading),components:{body:v},dataSource:o,pagination:y(),onChange:function($,S,b,P){if(l.setData({pagination:$,filters:S,sorter:b,extra:P}),P.action==="paginate"){var T;a==null||(T=a._trigger)===null||T===void 0||T.call(a)}else if(P.action==="sort"&&a!==null&&a!==void 0&&a.sortRemote){var k;a==null||(k=a._trigger)===null||k===void 0||k.call(a)}else if(P.action==="filter"&&a!==null&&a!==void 0&&a.filterRemote){var N;a==null||(N=a._trigger)===null||N===void 0||N.call(a)}}})),m(),f]})})});D.wR===null||D.wR===void 0||(he=D.wR.mixin)===null||he===void 0||he.call(D.wR,B),B.Operations=function(){return(0,c.jsx)(C.Fragment,{})},B.Actions=function(){return(0,c.jsx)(C.Fragment,{})},B.Column=function(){return(0,c.jsx)(C.Fragment,{})},B.Expand=function(){return(0,c.jsx)(C.Fragment,{})},B.Selection=function(){return(0,c.jsx)(C.Fragment,{})},B.Titlebar=_n;var er=j(34041),nr=function(e,n){var r=n;return e&&(r=Array.isArray(n)?n:[]),r},rr=function(e){var n=(0,C.useState)([]),r=K()(n,2),t=r[0],a=r[1],l=(0,C.useState)(nr(e.multiple,e.value)),o=K()(l,2),s=o[0],v=o[1],g=(0,C.useState)(!1),u=K()(g,2),d=u[0],m=u[1],f=(0,C.useRef)(e.suggest);(0,C.useEffect)(function(){e.suggest&&(f.current=e.suggest)},[e.suggest]);var h=(0,C.useRef)(null),p=(0,C.useRef)(0),y=(0,C.useCallback)(function(S){var b=++p.current;h.current&&clearTimeout(h.current),h.current=setTimeout(function(){var P,T;m(!0),f.current||m(!1),(P=f.current)===null||P===void 0||(T=P.call(f,S))===null||T===void 0||T.then(function(k){b<p.current||a(k)}).finally(function(){m(!1)})},200)},[]),R=function(b){f.current&&(b?y(x()(x()({},e.params),{},{kw:b})):a([]))},$=function(b){var P;v(b),(P=e.onChange)===null||P===void 0||P.call(e,b)};return(0,c.jsx)(er.Z,{showSearch:!0,loading:d,value:s,labelInValue:e.labelInValue,mode:e.multiple?"multiple":void 0,placeholder:e.placeholder,style:e.style,disabled:e.disabled,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:R,onChange:$,options:t})},tr=j(45211),or=j(98261),lr=j(82061),ir=j(51042),ar=j(85175),ur=j(53416),dr=function(e,n){return JSON.parse(JSON.stringify(e,function(r,t){return r===n?"__CLONE_".concat((0,ur.x0)()):t}))},sr=function i(e,n){var r,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,l=a||{};return(r=n(e).children)===null||r===void 0||r.forEach(function(o,s){var v=[].concat(H()(t),[s]);l[n(o).key]={parentKey:n(e).key,index:s,pos:v},n(o).children&&i(o,n,v,l)}),l},we=function(e,n,r){var t=pe(n),a=r!=null?r:function(g){return dr(g,n.key)},l={pos:{},mapper:{}},o=function(){console.log("computed start");var u=performance.now();l.mapper=sr(e.root,t),l.pos=Object.keys(l.mapper).reduce(function(m,f){var h=l.mapper[f].pos;return m[f]=h,m},l.pos);var d=performance.now();console.log("computed end",d-u)},s=function(){o(),t(e.root).children=H()(t(e.root).children)};o();var v={get dataSource(){var g=t(e.root).children;return g},take:function(u){return t(u)},getPos:function(u){if(u===e.root)return[];var d=t(u).key;return d?(l.pos[d]||o(),l.pos[d]):null},posToParents:function(u){var d=e.root;return u.reduce(function(m,f){var h,p=(h=t(d).children)===null||h===void 0?void 0:h[f];return m.push(p),d=p,m},[])},posToPath:function(u){if(u){var d=u.reduce(function(m,f){return m?"".concat(m,".").concat(n.children,".").concat(f):"".concat(n.children,".").concat(f)},"");return d}},getNodeAtPos:function(u){if(u===null)return null;var d=u.reduce(function(m,f){var h;return(h=t(m).children)===null||h===void 0?void 0:h[f]},e.root);return d},append:function(u){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"push",m=arguments.length,f=new Array(m>2?m-2:0),h=2;h<m;h++)f[h-2]=arguments[h];var p=this.getNodeAtPos(u);p&&(0,O.batch)(function(){if(!t(p).children||d==="replace")t(p).children=f;else if(d==="push"){var y;(y=t(p).children)===null||y===void 0||y.push.apply(y,f)}else{var R;(R=t(p).children)===null||R===void 0||R.unshift.apply(R,f)}s()})},copy:function(u,d){var m=this.getNodeAtPos(u),f=d!=null?d:a(m),h=u.slice(0,u.length-1),p=this.getNodeAtPos(h);!p||!m||(0,O.batch)(function(){var y,R=u[u.length-1]+1;(y=t(p).children)===null||y===void 0||y.splice(R,0,f),s()})},remove:function(u){var d=u.slice(0,u.length-1),m=u[u.length-1];if(m!=null){var f=this.getNodeAtPos(d);f&&(0,O.batch)(function(){var h;(h=t(f).children)===null||h===void 0||h.splice(m,1),s()})}},move:function(u,d){var m=this;if(JSON.stringify(u)!==JSON.stringify(d)){var f=u.length===d.length&&u.slice(0,u.length-1).join("_")===d.slice(0,d.length-1).join("_");(0,O.batch)(function(){if(f){var h,p,y=m.getNodeAtPos(u.slice(0,u.length-1)),R=u[u.length-1],$=d[d.length-1],S=(h=t(y).children)===null||h===void 0?void 0:h.splice(R,1)[0];(p=t(y).children)===null||p===void 0||p.splice($,0,S)}else{var b,P,T,k,N=m.getNodeAtPos(u.slice(0,u.length-1)),F=(b=t(N).children)===null||b===void 0||(P=b.splice)===null||P===void 0?void 0:P.call(b,u[u.length-1],1)[0];if(console.log("move before pick",F),!F)return;var U=m.getNodeAtPos(d.slice(0,d.length-1));(T=t(U).children)===null||T===void 0||(k=T.splice)===null||k===void 0||k.call(T,d[d.length-1],0,F)}s()})}}};return v},cr={title:"label",key:"value",children:"children"},Fe=(0,C.createContext)(null),Oe=(0,C.createContext)(null),oe=function(){var e=(0,C.useContext)(Fe);return e},q=function(){var e=oe();return e==null?void 0:e.$helper},Q=function(e){var n=oe(),r=(0,C.useContext)(Oe);if(e){var t=Array.isArray(e)?n==null?void 0:n.$helper.take(n==null?void 0:n.$helper.getNodeAtPos(e)).key:e;return n==null?void 0:n.$refs.get(t)}return r},vr=function(e){var n=e.children,r=e.getRoot,t=(0,C.useRef)({getRoot:r}),a=(0,C.useMemo)(function(){var l=new Map,o=x()(x()({},cr),e.fieldNames),s=we({root:t.current.getRoot()},o),v={get $root(){var g=t.current.getRoot();return g},get $helper(){return s},get $fieldNames(){return o},get $refs(){return l}};return v},[]);return(0,c.jsx)(A.ExpressionScope,{value:a,children:(0,c.jsx)(Fe.Provider,{value:a,children:n})})},fr=function(e){var n=oe(),r=e.getPos,t=e.getNode,a=e.children,l=(0,C.useRef)({getPos:r,getNode:t,disposer:function(){}}),o=(0,C.useMemo)(function(){if(!n)return null;var s=n.$refs,v=n.$helper,g={get $root(){return n.$root},get $pos(){return l.current.getPos(n.$root)},get $path(){return v.posToPath(this.$pos)},get $extra(){var d;return(d=e.getExtra)===null||d===void 0?void 0:d.call(e,this.$root)},get $record(){var d=typeof l.current.getNode=="function"?l.current.getNode(n.$root):v.getNodeAtPos(this.$pos),m=d===this.$root;return m?d:V()(d)==="object"?(0,ke.lazyMerge)(d,{get $lookup(){return g.$lookup},get $index(){return g.$index},get $pos(){return g.$pos}}):d},get $lookup(){var d,m,f=((d=this.$pos)===null||d===void 0?void 0:d.slice(0,this.$pos.length-1))||[],h=v.getNodeAtPos(f),p=h?(m=n.$refs.get(v.take(h).key))===null||m===void 0?void 0:m.$record:void 0;return p!=null?p:this.$root},get $records(){var d;return(d=v.take(this.$lookup).children)!==null&&d!==void 0?d:[]},get $parents(){var d=Array.isArray(this.$pos)?H()(this.$pos):[],m=[];return d.reduce(function(f,h){var p;m.push(f);var y=(p=v.take(f).children)===null||p===void 0?void 0:p[h];return y},this.$root),m},get $index(){return this.$pos?this.$pos[this.$pos.length-1]:-1}},u=v.take(g.$record).key;return s.set(u,g),g},[]);return(0,c.jsx)(Oe.Provider,{value:o,children:(0,c.jsx)(A.ExpressionScope,{value:o,children:a})})},hr=["pos"],gr=["pos"],mr=["pos","factory","method"],pr=["pos","clone"],Ze=(0,C.createContext)(null),yr=(0,C.createContext)(null),_=function(){return(0,C.useContext)(Ze)},xr=function(e){return Array.isArray(e)?e:typeof e=="string"?e.split("-").map(Number).filter(function(n){return!Number.isNaN(n)}):[]},Cr=function(e){var n=Q();return e?xr(e):n==null?void 0:n.$pos},w=function(e){var n=e.fieldNames,r=e.getRoot,t=e.children,a=(0,A.useField)(),l=(0,A.useFieldSchema)(),o=(0,C.useMemo)(function(){return{field:a,schema:l,props:e}},[a,e,l]);return(0,c.jsx)(Ze.Provider,{value:o,children:(0,c.jsx)(vr,{fieldNames:n,getRoot:r,children:t})})},Rr=function(e){var n=e.pos,r=e.children,t=e.getNode,a=e.getExtra;return(0,c.jsx)(fr,{getPos:n,getNode:t,getExtra:a,children:(0,c.jsx)(yr.Provider,{value:e,children:r})})},$r=function(e){var n,r=Q(e.pos);return(r==null?void 0:r.$record)===(r==null?void 0:r.$root)?null:(0,c.jsxs)("span",x()(x()({},e),{},{children:["#",r==null||(n=r.$pos)===null||n===void 0?void 0:n.join("-")," "]}))},jr=function(e){var n,r,t=e.pos,a=z()(e,hr),l=_(),o=Q(t),s=(0,A.useField)(),v=q();if((o==null?void 0:o.$record)===(o==null?void 0:o.$root)||!l||l.field.pattern!=="editable")return null;var g=e.to==="up"&&(o==null?void 0:o.$index)===0||e.to==="down"&&(o==null?void 0:o.$index)===((n=o==null||(r=o.$records)===null||r===void 0?void 0:r.length)!==null&&n!==void 0?n:-1)-1;return g?null:(0,c.jsx)(E.Z,x()(x()({type:"link",size:"small",icon:(0,c.jsx)(or.Z,{rotate:e.to==="up"?0:180})},a),{},{onClick:function(d){var m,f;if(d.stopPropagation(),!(s!=null&&s.disabled)&&o){var h=o.$pos,p=H()(h),y=h[h.length-1];p[p.length-1]=e.to==="down"?y+1:Math.max(y-1,0);var R=(m=(f=l.props).onMove)===null||m===void 0?void 0:m.call(f,h,p,o==null?void 0:o.$root);typeof(R==null?void 0:R.then)=="function"?R.then(function(){v==null||v.move(h,p)}):v==null||v.move(h,p)}},children:s.props.title||s.title}))},br=function(e){var n=e.pos,r=z()(e,gr),t=_(),a=Q(n),l=(0,A.useField)(),o=q();return!t||t.field.pattern!=="editable"||(a==null?void 0:a.$record)===(a==null?void 0:a.$root)?null:(0,c.jsx)(Se.Z,{title:l.content||"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6570\u636E\u5417?",okText:"\u662F\u7684",cancelText:"\u6211\u518D\u60F3\u60F3",onConfirm:function(v){var g,u,d;if(v==null||(g=v.stopPropagation)===null||g===void 0||g.call(v),!(l!=null&&l.disabled)&&a){var m=a.$pos,f=(u=(d=t.props).onRemove)===null||u===void 0?void 0:u.call(d,m,a.$record,a.$lookup,a==null?void 0:a.$root);typeof(f==null?void 0:f.then)=="function"?f.then(function(){o==null||o.remove(m)}):o==null||o.remove(m)}},children:(0,c.jsx)(E.Z,x()(x()({onClick:function(v){return v.stopPropagation()},type:"link",size:"small",icon:(0,c.jsx)(lr.Z,{})},r),{},{children:l.props.title||l.title}))})},Sr=function(e){var n=e.pos,r=e.factory,t=e.method,a=z()(e,mr),l=_(),o=Q(n),s=(0,A.useField)(),v=q();return!l||l.field.pattern!=="editable"?null:(0,c.jsx)(E.Z,x()(x()({type:"dashed",size:"small",icon:(0,c.jsx)(ir.Z,{})},a),{},{onClick:function(u){var d,m;if(u.stopPropagation(),!(s!=null&&s.disabled)&&o){var f=o.$pos,h=(d=l.props)===null||d===void 0||(m=d.onAdd)===null||m===void 0?void 0:m.call(d,f,o.$record,o.$lookup,o.$root);typeof(h==null?void 0:h.then)=="function"?h.then(function(p){setTimeout(function(){v==null||v.append(f,t,p!=null?p:r==null?void 0:r(o.$record))})}):v==null||v.append(f,t,(r==null?void 0:r(o.$record))||{})}},children:s.props.title||s.title}))},Ar=function(e){var n=e.pos,r=e.clone,t=z()(e,pr),a=_(),l=Q(n),o=(0,A.useField)(),s=q();return!a||a.field.pattern!=="editable"||(l==null?void 0:l.$record)===(l==null?void 0:l.$root)?null:(0,c.jsx)(E.Z,x()(x()({type:"link",size:"small",icon:(0,c.jsx)(ar.Z,{})},t),{},{onClick:function(g){var u,d;if(g.stopPropagation(),!(o!=null&&o.disabled)&&l){var m=l.$pos,f=(u=a.props)===null||u===void 0||(d=u.onCopy)===null||d===void 0?void 0:d.call(u,m,l.$record,l.$lookup,l.$root);if(typeof(f==null?void 0:f.then)=="function")f.then(function(p){var y=p!=null?p:r==null?void 0:r(l.$record);s==null||s.copy(m,y)});else{var h=r==null?void 0:r(l.$record);s==null||s.copy(m,h)}}},children:o.props.title||o.title}))};w.Node=Rr,w.Move=jr,w.Pos=$r,w.Remove=br,w.Append=Sr,w.Copy=Ar,w.useNode=Q,w.useTree=_,w.usePos=Cr,w.useRoot=oe,w.useHelper=q,w.mixin=function(i){return i.Node=w.Node,i.Move=w.Move,i.Pos=w.Pos,i.Remove=w.Remove,i.Append=w.Append,i.Copy=w.Copy,i.useNode=w.useNode,i.useTree=w.useTree,i.usePos=w.usePos,i.useRoot=w.useRoot,i.useHelper=w.useHelper,i};var L=w,Pr=["loadAll","loadData","checkedKeys","fieldNames","children"],kr=["onAdd","value","fieldNames","onCopy","onMove","onRemove","layout"],Tr={title:"label",key:"value",children:"children"},Ee=function(){var e=(0,C.useRef)(null);return(0,C.useEffect)(function(){for(var n,r=(n=e.current)===null||n===void 0?void 0:n.parentElement,t=null;r&&!t;)t=/ant-tree-treenode/.test(r.getAttribute("class")||"")?r:null,r=r.parentElement;t&&t.setAttribute("style","display: none")},[]),(0,c.jsx)("span",{ref:e,children:"hack"})},Nr=function(e){var n=L.useTree(),r=L.useHelper(),t=L.useNode(),a=(r==null?void 0:r.take(t==null?void 0:t.$record).key)!==e.dataKey;return a?(0,c.jsx)(Ee,{}):(0,c.jsx)("div",{onClick:function(o){var s;(o==null||(s=o.target)===null||s===void 0?void 0:s.tagName)==="INPUT"&&o.stopPropagation()},children:(0,c.jsx)(A.RecursionField,{name:t==null?void 0:t.$path,schema:n==null?void 0:n.schema.items})})},wr=(0,A.observer)(function(i){var e,n,r=i.loadAll,t=i.loadData,a=i.checkedKeys,l=i.fieldNames,o=i.children,s=z()(i,Pr),v=L.useHelper(),g=(0,A.useField)(),u=(0,ee.Z)({loadData:t,loadAll:r,onDrop:i.onDrop}),d=(0,C.useCallback)(function(f){if(!u.current.loadAll&&u.current.loadData&&v){var h=v.getPos(f),p=v.posToParents(h),y=p[p.length-1];return y.loading=!0,u.current.loadData(p).then(function(R){v.append.apply(v,[h,"replace"].concat(H()(R)))}).finally(function(){y.loading=!1})}},[v,u]),m=(0,C.useCallback)(function(f){var h,p,y=f.dragNode,R=f.node,$=y.pos.split("-").map(Number);$.shift();var S=R.pos.split("-").map(Number);S.shift();var b=(h=(p=u.current).onDrop)===null||h===void 0?void 0:h.call(p,$,S);typeof(b==null?void 0:b.then)=="function"?b.then(function(){v==null||v.move($,S)}):v==null||v.move($,S)},[v,u]);return(0,c.jsxs)(C.Fragment,{children:[(0,c.jsx)(Ce,{}),(0,c.jsx)(tr.Z,x()(x()({showLine:!0,blockNode:!0},s),{},{className:"".concat(i.className," fireformily-tree"),titleRender:function(h){if(!v)return null;var p=v.getPos(h);return p?(0,c.jsx)(L.Node,{pos:function(){return v.getPos(h)},getExtra:function(){var R,$,S,b,P=v.take(h).key,T=g.value,k=T,N=k.selectedKeys,F=N===void 0?[]:N,U=k.checkedKeys,J=U===void 0?[]:U,I=k.halfCheckedKeys,ie=I===void 0?[]:I,ze=k.expandedKeys,ae=ze===void 0?[]:ze;return{checked:J==null||(R=J.includes)===null||R===void 0?void 0:R.call(J,P),halfChecked:ie==null||($=ie.includes)===null||$===void 0?void 0:$.call(ie,P),selecteds:F==null||(S=F.includes)===null||S===void 0?void 0:S.call(F,P),expanded:ae==null||(b=ae.includes)===null||b===void 0?void 0:b.call(ae,P)}},children:(0,c.jsx)(Nr,{dataKey:v.take(h).key})},v.take(h).key):(0,c.jsx)(Ee,{})},expandedKeys:(e=g.value.expandedKeys)!==null&&e!==void 0?e:[],onExpand:function(h){g.setState(function(p){p.value.expandedKeys=h})},selectedKeys:(n=g.value.selectedKeys)!==null&&n!==void 0?n:[],onSelect:function(h){g.setState(function(p){p.value.selectedKeys=h})},checkedKeys:g.value.checkedKeys,onCheck:function(h,p){if(g.value){var y=Array.isArray(h)?h:h.checked,R=Array.isArray(h)?p.halfCheckedKeys:h.halfChecked;g.setState(function($){$.value.checkedKeys=y,$.value.halfCheckedKeys=R!=null?R:[]})}},fieldNames:l,treeData:v==null?void 0:v.dataSource,onDrop:m,loadData:t&&!r?d:void 0}))]})}),De=function(e){var n=e.onAdd,r=e.value,t=e.fieldNames,a=e.onCopy,l=e.onMove,o=e.onRemove,s=e.layout,v=z()(e,kr),g=(0,A.useField)(),u=(0,A.useFieldSchema)(),d=(0,C.useMemo)(function(){return x()(x()({},Tr),t)},[t]),m=(0,ee.Z)({loader:e.loadAll||e.loadData});return(0,C.useEffect)(function(){m.current.loader&&(g.selfModified||m.current.loader([]).then(function(f){console.log("reloaddd"),g.setState(function(h){h.value.children=f})}))},[]),(0,c.jsx)(C.Fragment,{children:(0,c.jsxs)(L,{getRoot:function(){return g.value},fieldNames:d,onAdd:n,onRemove:o,onCopy:a,onMove:l,children:[(0,c.jsx)(A.RecursionField,{schema:u,onlyRenderSelf:!0}),(0,c.jsxs)(Z.Z,x()(x()({size:"small"},s),{},{children:[(0,c.jsxs)(Z.Z,{direction:"vertical",size:"small",children:[(0,c.jsx)(L.Node,{getNode:function(){return g.value},pos:function(){return[]},children:(0,c.jsx)(A.RecursionField,{schema:u.items,onlyRenderProperties:!0,name:""})}),(0,c.jsx)(wr,x()(x()({},v),{},{fieldNames:d}))]}),(0,c.jsx)(A.RecursionField,{schema:u,name:"",onlyRenderProperties:!0})]}))]})})};L.mixin(De);var Le=function(e){return ue[e%ue.length]},Fr=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n={emap:e.reduce(function(r,t){return r[t.value]=t.label,r[t.label]=t.value,r},{}),colors:e.reduce(function(r,t,a){var l=t.color||Le(a);return r[t.value]=l,r[t.label]=l,r},{}),options:e.map(function(r,t){return x()(x()({},r),{},{key:r.value,color:r.color||Le(t)})})};return n},Or=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"label",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"value";return e.map(function(t){return{key:t[r],label:t[n],value:t[r],color:t.color}})},Zr=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"label",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"value";return Fr(e.map(function(t){return{key:t[r],label:t[n],value:t[r],color:t.color}}))},W=(0,O.observable)({}),Er=W,le={},Ie={},Dr=function(e,n){le[e]=function(){return n(Or).then(function(r){var t=Zr(r);return W[e]=t,W[e]})}},Lr=function(e){(0,G.cW)("*",function(n){var r,t=(r=n.data)===null||r===void 0?void 0:r.dict;if(t){var a=n.data.dictNoCache;if(!W[t]&&!le[t])throw new Error("\u8BCD\u5178 ".concat(t," \u7684\u52A0\u8F7D\u5668\u4E0D\u5B58\u5728!"),t);if(a!==!0&&W[t])n.setState(function(o){o.dataSource=W[t].options,o.componentProps&&(o.componentProps.options=o.dataSource)});else if(t&&le[t]){n.setState(function(o){o.loading=!0});var l=Ie[t]||le[t]();Ie[t]=l.then(function(o){return n.setState(function(s){s.dataSource=o.options,s.componentProps&&(s.componentProps.options=s.dataSource),s.loading=!1}),o}).catch(function(o){throw n.setState(function(s){s.loading=!1}),o})}}}),(0,G.lC)("*",function(n){var r,t,a=(r=n.data)===null||r===void 0?void 0:r.dict;if(a){var l=function(v,g){var u=Array.isArray(v)?v[0]:v,d=Array.isArray(g)?g[0]:g;return u===d},o=n.readPretty||n.readOnly;o?l(n.component,se)||(n.data.__origin_component=n.component,n.setComponent(se)):(t=n.data)!==null&&t!==void 0&&t.__origin_component&&!l(n.data.__origin_component,n.component)&&n.setComponent(n.data.__origin_component)}})},Ir=function(e){var n=typeof e=="function"?e():e;return(0,O.isSupportObservable)(n)?(0,O.observable)(n):(console.log("WARNING!!, not support obserable"),n)},zr=function(e){var n=(0,C.useMemo)(function(){return Ir(e!=null?e:{})},[]);return n}}}]);
