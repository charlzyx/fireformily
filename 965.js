(self["webpackChunkfireformily"]=self["webpackChunkfireformily"]||[]).push([[965],{40020:function(e,r,t){"use strict";t.r(r),t.d(r,{Dict:function(){return $e},ImageView:function(){return De},Linkage:function(){return Be},LongText:function(){return Ne},PopActions:function(){return F},QueryForm:function(){return K},QueryList:function(){return T},QueryTable:function(){return Re},Suggestion:function(){return Ae},TreeBase:function(){return pr},TreeNodes:function(){return Sr},colors:function(){return Ce},dict:function(){return Ar},dictEffects:function(){return Tr},isColorStatus:function(){return we},registerDictLoader:function(){return Kr},safeStringify:function(){return Se},useLive:function(){return Ir}});var l=t(13378),n=t(2812),o=t(67294),a=t(48429),i=()=>{},s=e=>{var r,t,l=e.field,n=e.loading,s=e.open,u=e.scope,d=void 0!==(null===u||void 0===u?void 0:u.$index),c=n?i:s;return o.createElement(a.Z,{onClick:c,size:d?"small":null===(r=l.componentProps)||void 0===r?void 0:r.size,type:d?"link":null===(t=l.componentProps)||void 0===t?void 0:t.type},null===l||void 0===l?void 0:l.title)},u=t(44742),d=t(52663),c=t(49229),v=t(18042),p=t(45733),m=t(96730),f=t(3911),g=t(55354),h=["pageSize","current"],y=()=>{},b=(0,o.createContext)(null),j=o.memo((e=>{var r,t=(0,v.useForm)(),l=(0,o.useRef)({}),n=(0,g.Z)(),a=(0,u.default)(n,2),i=a[0],s=a[1],c=(0,o.useRef)(!1),p=(0,v.useExpressionScope)(),j=(0,o.useRef)(!1),E=(0,o.useRef)({service:e.service}),k=(0,o.useCallback)((r=>{var n=E.current.service;if(l.current=r,e.syncUrl){var o=r||{pagination:{}},a=o.pagination,i=a.pageSize,u=a.current,c=o.params;s((e=>{var r=(0,d.Z)({},e);return Object.keys(r).forEach((e=>{r[e]=void 0})),(0,d.Z)((0,d.Z)((0,d.Z)({},r),c),{},{pageSize:i,current:u})}))}return C.current._loading=!0,n((0,d.Z)((0,d.Z)({},r),{},{scope:p})).then((e=>{var r=e.list,l=e.total,n=C.current._address.table,o=t.query(n).take();return n?(o.setState((e=>{(0,m.batch)((()=>{e.value=r,e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.total=l}))})),{list:r,total:l}):{list:[],total:0}})).finally((()=>{C.current._loading=!1}))}),[t,e.syncUrl,p,s]),x=(0,o.useCallback)((()=>{var e=C.current._address.query,r=t.query(e).take(),l=C.current._address.table,n=t.query(l).take();return k((0,d.Z)({params:null===r||void 0===r?void 0:r.value},null===n||void 0===n?void 0:n.data))}),[k,t]),R=(0,o.useCallback)((()=>{var e=l.current;return k(e)}),[k]),Z=(0,o.useCallback)((()=>{var e,r,l,n=null===C||void 0===C||null===(e=C.current)||void 0===e||null===(r=e._address)||void 0===r?void 0:r.table;n&&(null===(l=t.query(n).take())||void 0===l||l.setState((e=>{(0,m.batch)((()=>{e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.current=1}))})));return x()}),[x,t]),C=(0,o.useRef)((0,m.observable)((0,d.Z)((0,d.Z)({},e),{},{service:e.service?k:void 0,syncUrl:e.syncUrl,pageSize:e.pageSize,_refresh:e.service?R:void 0,_reset:e.service?Z:void 0,_trigger:e.service?x:void 0,_address:{query:"",table:""},_scope:p,_cofnig:{_size:null!==(r=e.size)&&void 0!==r?r:"default",_columns:[],_showColumns:[],_selectedRows:[],_selectedRowKeys:[],_selectClear:y,_selectReverse:y}})));return(0,o.useEffect)((()=>{if(e.syncUrl&&!c.current){var r,l,n=C.current._address,o=i||{},a=o.pageSize,s=(o.current,(0,f.Z)(o,h));if(a&&null!==n&&void 0!==n&&n.table)null===(r=t.query(n.table).take())||void 0===r||r.setState((e=>{(0,m.batch)((()=>{e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.pageSize=Number(i.pageSize),e.data.pagination.current=Number(i.current)}))}));if(s&&Object.keys(s).length>0&&null!==n&&void 0!==n&&n.query)null===(l=t.query(n.query).take())||void 0===l||l.setState((e=>{e.value=(0,d.Z)((0,d.Z)({},e.value),s)}));null!==n&&void 0!==n&&n.table&&setTimeout((()=>{c.current=!0}),0)}}),[t,e.syncUrl,i]),(0,o.useEffect)((()=>{if(E.current.service){var e=(0,m.autorun)((()=>{var e,r=null===(e=C.current._address)||void 0===e?void 0:e.table;!1===j.current&&r&&!1!==C.current.autoload&&setTimeout((()=>{x(),j.current=!0}))}));return()=>{e()}}}),[x]),(0,o.useEffect)((()=>{var r=C.current;r.autoload!==e.autoload&&(r.autoload=e.autoload),r.filterRemote!==e.filterRemote&&(r.filterRemote=e.filterRemote),r.sortRemote!==e.sortRemote&&(r.sortRemote=e.sortRemote),r.syncUrl!==e.syncUrl&&(r.syncUrl=e.syncUrl)}),[e.autoload,e.filterRemote,e.sortRemote,e.syncUrl]),o.createElement(b.Provider,{value:C.current},o.createElement(v.ExpressionScope,{value:{get $query(){var e,r=null===(e=C.current._address)||void 0===e?void 0:e.query;return r?t.query(r).take().value:null},get $list(){var e,r=null===(e=C.current._address)||void 0===e?void 0:e.table;return r?t.query(r).take().value:null}}},e.children))})),E=()=>{var e=(0,o.useContext)(b);return e},k=()=>new Promise((e=>{setTimeout((()=>{e("")}),0)})),x=e=>(0,m.isObservable)(e)?e:Array.isArray(e)?[...e]:(0,d.Z)({},e),R=()=>Promise.resolve({}),Z=()=>{var e,r=(0,v.useExpressionScope)(),t=(0,v.useField)(),l=E(),n=null===t||void 0===t||null===(e=t.componentProps)||void 0===e?void 0:e.actions,i=(0,o.useRef)({open:!1,reset:!1,submit:!1}),s=(0,v.useFieldSchema)(),d=(0,o.useRef)(n||{});(0,o.useEffect)((()=>{d.current.load=null===n||void 0===n?void 0:n.load,d.current.cancel=null===n||void 0===n?void 0:n.cancel,d.current.submit=null===n||void 0===n?void 0:n.submit}),[n]);var m=(0,o.useState)(!1),f=(0,u.default)(m,2),g=f[0],h=f[1],y=(0,o.useState)(!1),b=(0,u.default)(y,2),j=b[0],Z=b[1],C=(0,o.useCallback)((()=>{if(!t.disabled&&!j&&!i.current.open){i.current.open=!0;var e=d.current.load||R;return Z(!0),e(r).then((e=>{t.setState((r=>{r.value=x(e)})),h(!0)})).finally((()=>{i.current.open=!1,Z(!1)}))}}),[t,j,r]),w=(0,o.useCallback)((()=>{if(!t.disabled&&!j&&g&&!i.current.reset){i.current.reset=!0;var e=(0,c.JF)(t)?R:()=>t.reset(),l=d.current.cancel||R;return e().then((()=>l(r))).then((()=>{h(!1)})).finally((()=>{i.current.reset=!1,Z(!1)}))}}),[t,j,r,g]),S=(0,o.useCallback)((()=>{if(!t.disabled&&!j&&g&&!i.current.submit){i.current.submit=!0;var e=(0,c.JF)(t)?R:()=>t.submit(),n=(0,c.JF)(t)?R:()=>t.reset(),o=d.current.submit||R;return e().then((e=>o(e,r))).then((()=>(h(!1),k().then(n)))).finally((()=>{var e;Z(!1),i.current.submit=!1,null===l||void 0===l||null===(e=l._refresh)||void 0===e||e.call(l)}))}}),[l,t,j,r,g]),_=(0,o.useMemo)((()=>t.content?t.content:null),[t.content]),P=(0,o.useMemo)((()=>s?o.createElement(o.Fragment,null,o.createElement(v.RecursionField,{schema:s})):null),[s]),$=(0,o.useMemo)((()=>o.createElement(p.Z,{style:{display:"flex",justifyContent:"flex-end",marginBottom:"16px"}},o.createElement(a.Z,{loading:j,onClick:w},"\u53d6\u6d88"),o.createElement(a.Z,{loading:j,onClick:S,type:"primary"},"\u786e\u5b9a"))),[j,w,S]);return{submit:S,field:t,reset:w,open:C,visible:g,loading:j,body:P,header:_,footer:$,scope:r}},C=e=>{var r=Z(),t=r.body,a=r.field,i=r.footer,u=r.header,d=r.loading,c=r.scope,v=r.open,p=r.reset,m=r.visible;return o.createElement(o.Fragment,null,o.createElement(n.Z,(0,l.Z)({width:"68.88%",closable:!0,keyboard:!0},e,{title:e.title||a.title,onClose:r=>{var t;p(),null===e||void 0===e||null===(t=e.onClose)||void 0===t||t.call(e,r)},open:m,afterOpenChange:r=>{var t;r||p(),null===e||void 0===e||null===(t=e.afterOpenChange)||void 0===t||t.call(e,r)},footer:i}),u,t),o.createElement(s,{open:v,field:a,loading:d,scope:c}))},w=t(86444),S=e=>{var r=Z(),t=r.visible,n=r.body,a=r.field,i=r.scope,u=r.footer,d=r.header,c=r.loading,v=r.open,p=r.reset;return o.createElement(o.Fragment,null,o.createElement(w.Z,(0,l.Z)({maskClosable:!1,keyboard:!1,closable:!1,width:"68.88%"},e,{afterClose:()=>{var r;null===e||void 0===e||null===(r=e.afterClose)||void 0===r||r.call(e),p()},open:t,title:e.title||a.title,footer:u}),d,n),o.createElement(s,{open:v,field:a,loading:c,scope:i}))},_=t(7523),P=e=>{var r=Z(),t=r.body,n=r.field,a=r.header,i=r.loading,u=r.scope,d=r.open,c=r.reset,v=r.submit,p=r.visible;return o.createElement(_.Z,(0,l.Z)({},e,{title:o.createElement(o.Fragment,null,o.createElement("h4",null,n.title||a),n.title?null:a,t),cancelButtonProps:{loading:i},okButtonProps:{loading:i},onCancel:c,onConfirm:v,open:p,onOpenChange:r=>{var t;r||c(),null===e||void 0===e||null===(t=e.onOpenChange)||void 0===t||t.call(e,r)}}),o.createElement(s,{open:d,field:n,loading:i,scope:u}))},$=t(56466),z=e=>{var r=Z(),t=r.body,n=r.field,a=r.scope,i=r.footer,u=r.header,d=r.loading,c=r.open,v=r.reset,p=r.visible;return console.log("--popovver",{visible:p}),o.createElement($.Z,(0,l.Z)({},e,{trigger:"click",title:e.title||n.title,content:o.createElement(o.Fragment,null,u,t,i),open:p,onOpenChange:r=>{var t;null===e||void 0===e||null===(t=e.onOpenChange)||void 0===t||t.call(e,r),r||v()}}),o.createElement(s,{open:c,field:n,loading:d,scope:a}))},F=S;F.Drawer=C,F.Modal=S,F.Popconfirm=P,F.Popover=z;var A,O=t(36158),N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.maxRows||1,t=(0,o.useMemo)((()=>O.T5.createFormGrid({maxColumns:e.maxColumns||4,maxWidth:e.maxWidth||320,maxRows:r,shouldVisible:(e,l)=>e.index===t.childSize-1||(l.maxRows===1/0||e.shadowRow<r+1)})),[e.maxColumns,e.maxWidth,r]),l=t.fullnessLastColumn?t.shadowRows-1:t.shadowRows,n=l<=r?void 0:t.maxRows===1/0,a=()=>{t.maxRows===1/0?t.maxRows=r:t.maxRows=1/0};return{grid:t,expanded:n,toggle:a}},K=(0,v.observer)((e=>{var r,t=e.resetText,n=e.submitText,i=(0,v.useField)(),s=(0,v.useForm)(),u=N(e.grid),d=u.grid,c=u.expanded,p=u.toggle,m=E(),f=m||{},g=f._loading,h=(f._refresh,f._reset),y=f._trigger,b=()=>{var e;g||(m?s.reset(null===(e=m._address)||void 0===e?void 0:e.query,{forceClear:!0,validate:!1}).then((()=>{null===h||void 0===h||h()})):setTimeout((()=>{null===h||void 0===h||h()})))},j=()=>{if(!g)return null===y||void 0===y?void 0:y()};(0,o.useEffect)((()=>{m&&(m._address.query=i.address.toString())}),[m,null===i||void 0===i||null===(r=i.address)||void 0===r?void 0:r.toString()]);var k=()=>o.createElement(O.d5,{align:"right",style:{width:"100%",marginBottom:"22px",display:"flex",justifyContent:"flex-end"}},void 0!==c?o.createElement(a.Z,{type:"link",onClick:e=>{e.preventDefault(),p()}},c?"\u6536\u8d77":"\u5c55\u5f00"):null,o.createElement(a.Z,{onClick:b},t||"\u91cd\u7f6e"),o.createElement(a.Z,{onClick:j,type:"primary"},n||"\u67e5\u8be2"));return e.children?o.createElement(O.T5,(0,l.Z)({},d,{grid:d}),e.children,o.createElement(O.T5.GridColumn,{gridSpan:-1,style:{display:"flex",justifyContent:"space-between"}},k())):null})),T=e=>o.createElement(j,e,e.children),D=t(39941),I=t(33634),q=e=>{var r=e.items||e,t=r.reduceProperties(((e,r)=>{var t;return e||("QueryTable"===r["x-component"]?null:(null===(t=r["x-component"])||void 0===t?void 0:t.indexOf("SortHandle"))>-1?r:r.properties||r.items?q(r):e)}));return t},M=e=>{var r;return(null===(r=e["x-component"])||void 0===r?void 0:r.indexOf("Column"))>-1},J=e=>{var r;return(null===(r=e["x-component"])||void 0===r?void 0:r.indexOf("Operations"))>-1},L=e=>{var r;return(null===(r=e["x-component"])||void 0===r?void 0:r.indexOf("Addition"))>-1},B=e=>{var r;return(null===(r=e["x-component"])||void 0===r?void 0:r.indexOf("Expand"))>-1},U=e=>{var r;return(null===(r=e["x-component"])||void 0===r?void 0:r.indexOf("Selection"))>-1},V=()=>{var e=(0,v.useFieldSchema)();return e.reduceProperties(((e,r,t)=>L(r)?o.createElement(v.RecursionField,{schema:r,name:t}):e),null)},W=t(5085),Q=t.n(W),G=t(62878),H=t(91522),X=t(2291),Y=O.wR,ee=(e,r)=>{if(!e)return[];var t=[],l=(0,G.isArr)(e)?e:[e];return l.reduce(((e,t)=>{var l=r(t);return l?e.concat(l):e}),t)},re=(e,r,t,l)=>{var n=Object.keys(r.properties||{}).length,a=e.maxItems||2,i=n>a?o.createElement(H.Z,{mode:"vertical",items:r.mapProperties(((e,r,l)=>l<a?null:{key:l,label:o.createElement(v.RecursionField,{schema:e,name:"".concat(t,".").concat(r)})})).filter(Boolean)}):void 0;return o.createElement(Y.Item,{index:t,record:()=>{var e;return null===l||void 0===l||null===(e=l.value)||void 0===e?void 0:e[t]}},o.createElement(p.Z,{size:"small"},r.mapProperties(((e,r,l)=>l>=a?null:o.createElement(v.RecursionField,{key:"".concat(t,".").concat(r),schema:e,name:"".concat(t,".").concat(r)}))),n>a?o.createElement(X.Z,{overlay:i},o.createElement("a",null,o.createElement(Q(),null))):null))},te=e=>{var r=E(),t=(0,v.useFieldSchema)(),l=r=>{if(M(r)||J(r)||L(r)){var t,n,o;if((null===(t=r["x-component-props"])||void 0===t||!t["dataIndex"])&&!r["name"])return[];var a=(null===(n=r["x-component-props"])||void 0===n?void 0:n["dataIndex"])||r["name"],i=e.query(e.address.concat(a)).take(),s=(null===i||void 0===i||null===(o=i.component)||void 0===o?void 0:o[1])||r["x-component-props"]||{},u=(null===i||void 0===i?void 0:i.display)||r["x-display"];return[{name:a,display:u,field:i,schema:r,columnProps:s}]}return r.properties?r.reduceProperties(((e,r)=>e.concat(l(r))),[]):[]};if(!t)throw new Error("can not found schema object");var n=ee(t.items,l),a=n.reduce(((t,l,n)=>{var a,i=l.name,s=l.columnProps,u=l.schema,c=l.display;return r&&r._cofnig&&(null===r||void 0===r?void 0:r._cofnig._showColumns.length)>0&&-1===(null===r||void 0===r||null===(a=r._cofnig._showColumns)||void 0===a?void 0:a.findIndex((e=>e===i)))||"hidden"===c?t:J(u)?t.concat((0,d.Z)((0,d.Z)({fixed:!0},s),{},{key:n,dataIndex:i,render:(r,t)=>{var l,n=null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.indexOf(t);return re(s,u,n,e)}})):M(u)?t.concat((0,d.Z)((0,d.Z)({},s),{},{filters:Array.isArray(s.filters)?s.filters:void 0,key:i,dataIndex:i,render:(r,t)=>{var l,n=null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l.indexOf(t),a=o.createElement(Y.Item,{index:n,record:()=>{var r;return null===e||void 0===e||null===(r=e.value)||void 0===r?void 0:r[n]}},o.createElement(v.RecursionField,{schema:u,name:n,onlyRenderProperties:!0}));return a}})):t}),[]),i=()=>n.map(((e,r)=>M(e.schema)?o.createElement(v.RecursionField,{key:r,schema:e.schema,name:e.name,onlyRenderSelf:!0}):null));return[a,i]},le=e=>{var r;return"QueryList"===(null===(r=e.parent)||void 0===r?void 0:r["x-component"])?e.parent:e.parent?le(e.parent):null},ne=e=>{if(e){var r=e.reduceProperties(((e,r)=>{if(e)return e;var t="QueryTable.Selection"===r["x-component"];return!!t||!!r.properties&&ne(r)}),!1);return r}return!1},oe=(e,r)=>{var t=(0,v.useField)(),l=E(),n=(0,v.useFieldSchema)(),a=ne(le(n)),i=(0,o.useRef)(e);(0,o.useEffect)((()=>{i.current=e}),[e]);var s=(0,o.useCallback)((()=>{var e,n;if(l&&(a||r)){var o=l._cofnig,s=(0,m.observable)((0,d.Z)((0,d.Z)({type:"checkbox"},r),{},{selectedRows:null!==(e=o._selectedRows)&&void 0!==e?e:[],selectedRowKeys:null!==(n=o._selectedRowKeys)&&void 0!==n?n:[],clear:()=>{o._selectedRowKeys=[],o._selectedRows=[]},reverse:()=>{var e=t.value,r=e.filter((e=>!o._selectedRows.find((r=>r===e)))),l=r.map((e=>{var r="function"==typeof i.current?i.current(e):e[i.current];return r}));o._selectedRowKeys=l,o._selectedRows=r},onChange:(e,r)=>{o._selectedRowKeys=e,o._selectedRows=r}}));return o._selectReverse=s.reverse,o._selectClear=s.clear,s}}),[l,t.value,a,r]);return s()},ae=t(49194),ie=()=>{var e=E(),r=(0,v.useFieldSchema)(),t=r.reduceProperties(((r,t,l)=>(U(t)&&r.push(o.createElement(v.RecordScope,{key:l,getRecord:()=>{var r,t,l,n;return{selectedRowKeys:null!==(r=null===e||void 0===e||null===(t=e._cofnig)||void 0===t?void 0:t._selectedRowKeys)&&void 0!==r?r:[],selectedRows:null!==(l=null===e||void 0===e||null===(n=e._cofnig)||void 0===n?void 0:n._selectedRows)&&void 0!==l?l:[]}},getIndex:()=>-1},o.createElement(p.Z,{split:o.createElement(ae.Z,{type:"vertical"})},t.mapProperties(((e,r)=>o.createElement(v.RecursionField,{key:r,schema:e,name:r})))))),r)),[]);return t.length>0?t:null},se=t(98072),ue=t(24750),de=(0,ue.W8)((e=>o.createElement("tr",e))),ce=(0,ue.JN)((e=>o.createElement("tbody",e))),ve=e=>o.createElement(de,(0,l.Z)({index:e["data-row-sort-index"]||0},e)),pe=(e,r)=>{var t=document.body.querySelector(".".concat(r,"-sort-helper"));if(t){var l=e.querySelectorAll("td");requestAnimationFrame((()=>{t.querySelectorAll("td").forEach(((e,r)=>{l[r]&&(e.style.width=getComputedStyle(l[r]).width)}))}))}},me=e=>{var r=(0,se.usePrefixCls)("formily-array-table"),t=(0,v.useField)(),n=(0,v.useFieldSchema)(),a=(0,v.useExpressionScope)(),i=(0,o.useMemo)((()=>q(n)),[n]),s=E(),u=(0,o.useCallback)((n=>o.createElement(ce,(0,l.Z)({useDragHandle:!0,lockAxis:"y",helperClass:"".concat(r,"-sort-helper"),helperContainer:()=>{var r;return null===(r=e.current)||void 0===r?void 0:r.querySelector("tbody")},onSortStart:e=>{var t=e.node;pe(t,r)},onSortEnd:e=>{var r,l=e.oldIndex,n=e.newIndex,o=null===(r=t.componentProps)||void 0===r?void 0:r.onSort;if("function"===typeof o){var i=o(l,n,(0,m.toJS)(t.value),a);i instanceof Promise?(t.setLoading(!0),t.move(l,n),i.then((e=>{var r;e&&(null===s||void 0===s||null===(r=s._refresh)||void 0===r||r.call(s));t.setLoading(!1)})).catch((()=>{t.move(n,l),t.setLoading(!1)}))):t.move(l,n)}else t.move(l,n)}},n))),[s,t,e,r]),d={wrapper:i?u:void 0,row:i?ve:void 0};return d},fe=O.wR,ge=e=>{var r=(0,v.useField)(),t=(0,v.useFieldSchema)(),l=t.reduceProperties(((e,r,t)=>B(r)?r:e),null),n=(0,o.useMemo)((()=>{if(l)return(0,d.Z)((0,d.Z)({},e),{},{expandedRowRender:(e,t,n,a)=>o.createElement(fe.Item,{key:a?"expand-".concat(new Date):"hidden-".concat(t),index:t,record:()=>{var e;return null===r||void 0===r||null===(e=r.value)||void 0===e?void 0:e[t]}},o.createElement(v.RecursionField,{schema:l,name:t,onlyRenderProperties:!0}))})}),[null===r||void 0===r?void 0:r.value,l,e]);return n},he=t(59879),ye=t(17828),be=t(24616),je=t(42091),Ee=t(45904),ke=t(43732),xe=(0,v.observer)((e=>{var r=(0,v.useField)(),t=E();if(!t)return null;var l=null===t||void 0===t?void 0:t._cofnig,n=o.createElement(H.Z,{selectable:!0,onSelect:e=>{l._size=e.key},defaultValue:l._size,items:[{label:"\u9ed8\u8ba4",key:"default"},{label:"\u4e2d\u7b49",key:"middle"},{label:"\u7d27\u51d1",key:"small"}]}),i=ie(),s=o.createElement(H.Z,{selectable:!0,multiple:!0,items:l._columns.map((e=>{var r=l._showColumns.findIndex((r=>r===e.key)),t=r>-1,n=n=>{n.stopPropagation(),n.preventDefault(),t?l._showColumns.splice(r,1):l._showColumns.push(e.key)};return{label:o.createElement(p.Z,{onClick:n},o.createElement(je.Z,{checked:t}),e.label),key:e.key}}))});return o.createElement(p.Z,{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"}},o.createElement(p.Z,{size:"small"},o.createElement(Ee.Z.Title,{level:5},r.title||e.title),l._selectedRowKeys.length?o.createElement(ke.Z,{style:{padding:"3px 4px"},type:"info",message:o.createElement(p.Z,{size:"small",split:o.createElement(ae.Z,{type:"vertical"})},o.createElement(a.Z,{type:"text",size:"small"},"\u9009\u4e2d ",l._selectedRowKeys.length," \u9879"),o.createElement(a.Z,{size:"small",onClick:()=>{var e;null===(e=l._selectClear)||void 0===e||e.call(l)},type:"link"},"\u53d6\u6d88\u9009\u62e9"),o.createElement(a.Z,{size:"small",onClick:()=>{var e;null===(e=l._selectReverse)||void 0===e||e.call(l)},type:"link"},"\u53cd\u5411\u9009\u62e9"),i)}):null),o.createElement(p.Z,{size:"small"},o.createElement(p.Z,null,e.children),o.createElement(p.Z,{size:"large"},o.createElement(he.Z,{onClick:()=>{var e;null===t||void 0===t||null===(e=t._refresh)||void 0===e||e.call(t)},loop:null===t||void 0===t?void 0:t._loading}),o.createElement(X.Z,{key:"size",overlay:n},o.createElement(ye.Z,null)),o.createElement(X.Z,{key:"columns",overlay:s},o.createElement(be.Z,null)))))})),Re=(0,v.observer)((e=>{var r,t,n=(0,o.useRef)(null),a=(0,D.F)("formily-array-table"),i=E(),s=(0,v.useField)(),c=Array.isArray(s.value)?s.value.slice():[],p=e=>c.indexOf(e),m=me(n),f=te(s),g=(0,u.default)(f,2),h=g[0],y=g[1],b=V(),j=ge(e.expandable),k=oe(e.rowKey||p,e.rowSelection);(0,o.useEffect)((()=>{i&&(i._address.table=s.address.toString())}),[i,null===s||void 0===s||null===(r=s.address)||void 0===r?void 0:r.toString()]),(0,o.useEffect)((()=>{null!==i&&void 0!==i&&i.service&&s&&!s.data&&(s.data={},s.data.pagination={current:1,pageSize:i.pageSize||10})}),[i,s,e.pagination]),(0,o.useEffect)((()=>{if(i){var e=i._cofnig;h.forEach((r=>{-1===e._columns.findIndex((e=>e.key===r.dataIndex))&&(e._columns.push({label:r.title,key:r.dataIndex}),e._showColumns.push(r.dataIndex))}))}}),[h,i]);var x=()=>{var r,t=null===s||void 0===s||null===(r=s.data)||void 0===r?void 0:r.pagination,l=e.pagination||{},n=!!t&&(!(t.pageSize>t.total)&&(0,d.Z)((0,d.Z)((0,d.Z)({},l),t),{},{showTotal:(e,r)=>"\u7b2c ".concat(r[0],"-").concat(r[1]," \u6761, \u5171 ").concat(e," \u6761\u6570\u636e")}));return n};return o.createElement("div",{ref:n,className:a},o.createElement(O.wR,null,o.createElement(I.Z,(0,l.Z)({rowKey:p},e,{size:null===i||void 0===i||null===(t=i._cofnig)||void 0===t?void 0:t._size,expandable:j,rowSelection:k,onRow:(r,t)=>{var l,n=(null===e||void 0===e||null===(l=e.onRow)||void 0===l?void 0:l.call(e,r,t))||{};return n["data-row-sort-index"]=t,n},columns:h,loading:e.loading||(null===i||void 0===i?void 0:i._loading),components:{body:m},dataSource:c,pagination:x(),onChange:(e,r,t,l)=>{var n;if(s.setData({pagination:e,filters:r,sorter:t,extra:l}),"paginate"===l.action)null===i||void 0===i||null===(n=i._trigger)||void 0===n||n.call(i);else if("sort"===l.action&&null!==i&&void 0!==i&&i.sortRemote){var o;null===i||void 0===i||null===(o=i._trigger)||void 0===o||o.call(i)}else if("filter"===l.action&&null!==i&&void 0!==i&&i.filterRemote){var a;null===i||void 0===i||null===(a=i._trigger)||void 0===a||a.call(i)}}})),y(),b))}));null===O.wR||void 0===O.wR||null===(A=O.wR.mixin)||void 0===A||A.call(O.wR,Re),Re.Operations=()=>o.createElement(o.Fragment,null),Re.Column=()=>o.createElement(o.Fragment,null),Re.Expand=()=>o.createElement(o.Fragment,null),Re.Selection=()=>o.createElement(o.Fragment,null),Re.Titlebar=xe;var Ze={success:"green",processing:"blue",error:"red",warning:"gold",default:"#fafafa"},Ce=(0,d.Z)({length:11,0:"magenta",1:"green",2:"cyan",3:"geekblue",4:"purple",5:"red",6:"orange",7:"lime",8:"blue",9:"volcano",10:"gold",magenta:"magenta",green:"green",cyan:"cyan",geekblue:"geekblue",purple:"purple",red:"red",orange:"orange",lime:"lime",blue:"blue",volcano:"volcano",gold:"gold"},Ze),we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Boolean(Ze[e])},Se=e=>{var r=new WeakMap,t=e=>{if(Array.isArray(e))return e.map(t);if("function"===typeof e)return"f ".concat(e.displayName||e.name,"(){ }");if("object"===typeof e){if(r.get(e))return"#CircularReference";if(!e)return e;if("$$typeof"in e&&"_owner"in e)return r.set(e,!0),"#ReactNode";if(e.toJS)return r.set(e,!0),e.toJS();if(e.toJSON)return r.set(e,!0),e.toJSON();r.set(e,!0);var l={};for(var n in e)l[n]=t(e[n]);return r.set(e,!1),l}return e};return JSON.stringify(t(e),null,2)},_e=t(33227),Pe=t(74356),$e=e=>{var r=e.strict,t=e.type,l=e.value,n=e.options,a=(0,o.useMemo)((()=>{if(!Array.isArray(n))return[];var e=Array.isArray(l)?l.map((e=>n.find((t=>r?t.value===e:t.value==e)))):[n.find((e=>r?e.value===l:e.value==l))];return e.filter(Boolean)}),[n,r,l]);return o.createElement(p.Z,{size:"small"},a.map((e=>"badge"===t?o.createElement(_e.Z,{key:null===e||void 0===e?void 0:e.key,status:we(null===e||void 0===e?void 0:e.color)?null===e||void 0===e?void 0:e.color:void 0,color:we(null===e||void 0===e?void 0:e.color)||null===e||void 0===e?void 0:e.color,text:null===e||void 0===e?void 0:e.label}):"tag"===t?o.createElement(Pe.Z,{key:null===e||void 0===e?void 0:e.key,color:null===e||void 0===e?void 0:e.color},null===e||void 0===e?void 0:e.label):null===e||void 0===e?void 0:e.label)))},ze=t(90407),Fe=(e,r)=>{var t=r;return e&&(t=Array.isArray(r)?r:[]),t},Ae=e=>{var r=(0,o.useState)([]),t=(0,u.default)(r,2),l=t[0],n=t[1],a=(0,o.useState)(Fe(e.multiple,e.value)),i=(0,u.default)(a,2),s=i[0],c=i[1],v=(0,o.useState)(!1),p=(0,u.default)(v,2),m=p[0],f=p[1],g=(0,o.useRef)(e.suggest);(0,o.useEffect)((()=>{e.suggest&&(g.current=e.suggest)}),[e.suggest]);var h=(0,o.useRef)(null),y=(0,o.useRef)(0),b=(0,o.useCallback)((e=>{var r=++y.current;h.current&&clearTimeout(h.current),h.current=setTimeout((()=>{var t,l;f(!0),g.current||f(!1),null===(t=g.current)||void 0===t||null===(l=t.call(g,e))||void 0===l||l.then((e=>{r<y.current||n(e)})).finally((()=>{f(!1)}))}),200)}),[]),j=r=>{g.current&&(r?b((0,d.Z)((0,d.Z)({},e.params),{},{kw:r})):n([]))},E=r=>{var t;c(r),null===(t=e.onChange)||void 0===t||t.call(e,r)};return o.createElement(ze.Z,{showSearch:!0,loading:m,value:s,labelInValue:e.labelInValue,mode:e.multiple?"multiple":void 0,placeholder:e.placeholder,style:e.style,disabled:e.disabled,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:j,onChange:E,options:l})},Oe=Ee.Z.Paragraph,Ne=e=>o.createElement(Oe,(0,l.Z)({copyable:!0,ellipsis:!0},e),e.value),Ke=t(69131),Te={width:"60px",height:"60px",objectFit:"contain"},De=e=>{var r=e.value,t=e.style,l=(0,o.useMemo)((()=>{var e=Array.isArray(r)?r:[r];return e.filter(Boolean)}),[r]),n=(0,o.useMemo)((()=>(0,d.Z)((0,d.Z)({},Te),t)),[t]);return o.createElement(o.Fragment,null,o.createElement(Ke.Z.PreviewGroup,null,l.map((e=>o.createElement(Ke.Z,{style:n,key:e,src:e,preview:!0})))))},Ie=t(79594),qe=["value","loadAll","labelInValue","disabled","multiple","onChange","loadData"],Me={width:"100%"},Je=(e,r)=>e&&Array.isArray(r)&&r.length>0?null===r||void 0===r?void 0:r.reduceRight(((e,r)=>e?(r.children=e,r.__init=!0,[r]):(r.isLeaf=!0,[r])),null):[],Le=e=>{var r=e.loadData,t=e.loadAll,l=e.value,n=e.labelInValue,a=(0,o.useRef)(t||r);(0,o.useEffect)((()=>{a.current=t||r}),[t,r]);var i=(0,o.useMemo)((()=>(0,m.observable)({inited:!1,loading:!1,options:Je(n,l),load:e=>{var r,t,l=e[e.length-1];l&&(l.loading=!0,i.loading=!0,null===(r=a.current)||void 0===r||null===(t=r.call(a,e).then((e=>{e?l.children=e.map((e=>(0,d.Z)({isLeaf:!1},e))):l.isLeaf=!0})))||void 0===t||t.finally((()=>{l.loading=!1,i.loading=!1})))}})),[]);if(!i.inited&&!i.loading){var s,u,c;i.loading=!0,i.inited=!0;var v=Array.isArray(l)?n?l:l.map((e=>({value:e}))):[];null===(s=a.current)||void 0===s||null===(u=s.call(a,v))||void 0===u||null===(c=u.then((e=>{e&&(i.options=e.map((e=>(0,d.Z)({isLeaf:!1},e))))})))||void 0===c||c.finally((()=>{i.loading=!1}))}return i},Be=e=>{var r=e.value,t=e.loadAll,n=e.labelInValue,a=e.disabled,i=e.multiple,s=e.onChange,u=(e.loadData,(0,f.Z)(e,qe)),d=Le(e),c=(0,o.useCallback)(((e,r)=>n?null===s||void 0===s?void 0:s(r):null===s||void 0===s?void 0:s(e)),[n,s]),p=e=>Array.isArray(e)?e.map((e=>Array.isArray(e)?p(e):e.label?e.value:e)):[];return o.createElement(v.Observer,null,(()=>o.createElement(Ie.Z,(0,l.Z)({disabled:a,multiple:i,changeOnSelect:!0},u,{loading:d.loading,value:p(r),style:e.style||Me,options:[...d.options],loadData:t?void 0:d.load,onChange:c}))))},Ue=t(54943),Ve=t(56630),We=t(73171),Qe=t(99165),Ge=t(49101),He=e=>null===e||void 0===e?void 0:e.key,Xe={formatPos:e=>e?"string"===typeof e?e.split("-").map(Number):e:[],posToPath:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce(((e,r)=>e?"".concat(e,".children.").concat(r):"children.".concat(r)),"")},getNodeByPos:(e,r)=>{if(e&&r){var t=e.reduce(((e,r)=>{var t,l=null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t[r];return l}),r);return t}}},Ye={remove:(e,r)=>{if(r&&e){var t=Xe.formatPos(e);console.log("before remove",JSON.stringify(r,null,2)),t.reduce(((e,l,n)=>{var o,a=n===t.length-1;a&&(null===(o=e.children)||void 0===o||o.splice(l,1),console.log("after remove",JSON.stringify(r,null,2)));return e.children[l]}),r)}},copy:(e,r,t)=>{if(r&&e){var l=Xe.formatPos(e);l.reduce(((e,r,n)=>{var o=n===l.length-1;if(o){var a,i,s=null===(a=e.children)||void 0===a?void 0:a[r],u=t(s);null===(i=e.children)||void 0===i||i.splice(r+1,0,u)}return e.children[r]}),r)}},add:(e,r,t)=>{if(r&&e){var l=Xe.formatPos(e);l.reduce(((e,r,n)=>{var o=n===l.length-1;if(o){var a,i=null===(a=e.children)||void 0===a?void 0:a[r];return i?(i.children||(i.loading=!0,i.children=[],i.loading=!1),i.children.push(t),i):e}return e.children[r]}),r)}},move:(e,r,t)=>{if(JSON.stringify(e)!==JSON.stringify(r)){var l={parent:null,idx:-1};e.reduce(((r,t,n)=>{var o=n===e.length-1;return o&&(l.parent=r,l.idx=t),r.children[t]}),t);var n={parent:null,idx:-1};r.reduce(((e,t,l)=>{var o=l===r.length-1;return o&&(n.parent=e,n.idx=t),e.children[t]}),t),(0,m.batch)((()=>{var e,r,t,o,a=null===(e=l.parent)||void 0===e?void 0:e.children[l.idx];null===(r=l.parent)||void 0===r||null===(t=r.children)||void 0===t||t.splice(l.idx,1),null===(o=n.parent)||void 0===o||o.children.splice(n.idx,0,a)}))}}},er=e=>{var r=(0,v.useField)(),t=e.nodeKey,l=e.children,n=e.getRoot,a=(0,o.useRef)({nodeKey:t,getRoot:n});(0,o.useEffect)((()=>{a.current.nodeKey=e.nodeKey}),[e.nodeKey]),(0,o.useEffect)((()=>{a.current.getRoot=e.getRoot}),[e.getRoot]);var i=(0,o.useMemo)((()=>{var e=new Map,l={get $root(){return"function"===typeof a.current.getRoot?a.current.getRoot():r.value},get $getKey(){return e=>"function"===typeof t?t(e):null===e||void 0===e?void 0:e[t]},get $refs(){return e}};return l}),[]);return o.createElement(v.ExpressionScope,{value:i},l)},rr=e=>{var r=(0,v.useExpressionScope)(),t=e.getPos,l=e.getNode,n=e.children,a=(0,o.useRef)({getPos:t,getNode:l});(0,o.useEffect)((()=>{a.current.getPos=e.getPos}),[e.getPos]),(0,o.useEffect)((()=>{a.current.getNode=e.getNode}),[e.getNode]);var i=(null===r||void 0===r?void 0:r.$getKey)||He,s=(0,o.useMemo)((()=>{if(null===r||void 0===r||!r.$root)return{};var e=r.$refs,t={get $getKey(){return r.$getKey},get $refs(){return r.$refs},get $root(){return r.$root},get $pos(){var e,t,l=null===(e=a.current)||void 0===e||null===(t=e.getPos)||void 0===t?void 0:t.call(e,r.$root),n=l?"string"===typeof l?l.split("-").map(Number):l:[];return n},get $path(){return Xe.posToPath(this.$pos)},get $record(){var e,l="function"===typeof(null===(e=a.current)||void 0===e?void 0:e.getNode)?a.current.getNode(r.$root):Xe.getNodeByPos(this.$pos,this.$root),n=l===this.$root;return n?l:"object"===typeof l?(0,G.lazyMerge)(l,{get $lookup(){return t.$lookup},get $index(){return t.$index},get $pos(){return t.$pos}}):l},get $lookup(){var e,r,t=(null===(e=this.$pos)||void 0===e?void 0:e.slice(0,this.$pos.length-1))||[],l=Xe.getNodeByPos(t,this.$root),n=l?null===(r=this.$refs.get(this.$getKey(l)))||void 0===r?void 0:r.$record:void 0;return null!==n&&void 0!==n?n:this.$root},get $records(){var e,r;return null!==(e=null===(r=this.$lookup)||void 0===r?void 0:r.children)&&void 0!==e?e:[]},get $parents(){var e=Array.isArray(this.$pos)?[...this.$pos]:[],r=[];return e.reduce(((e,t)=>{var l;return r.push(e),null===(l=e.children)||void 0===l?void 0:l[t]}),this.$root),r},get $index(){return this.$pos?this.$pos[this.$pos.length-1]:-1}};return e.set(i(t.$record),t),t}),[]);return o.createElement(v.ExpressionScope,{value:s},"function"===typeof n?n(s):n)},tr=["children"],lr=["clone"],nr=["factory"],or=(e,r)=>{if(e&&r){var t="function"===typeof r?r(e):r,l=Xe.formatPos(t);return l.reduce(((e,r)=>{var t;return null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t[r]}),e)}},ar=(0,o.createContext)(null),ir=(0,o.createContext)(null),sr=()=>{var e=(0,o.useContext)(ar);return e},ur=e=>{var r=(0,o.useContext)(ir),t=dr(),l=r?"function"===typeof r.pos?r.pos(t):r.pos:e;return Xe.formatPos(l)},dr=()=>{var e,r=sr();return null===r||void 0===r||null===(e=r.field)||void 0===e?void 0:e.value},cr=e=>{var r,t=dr(),l=(0,o.useContext)(ir);return or(t,null!==(r=null===l||void 0===l?void 0:l.pos)&&void 0!==r?r:e)},vr=e=>{var r,t=(0,v.useExpressionScope)(),l=t.$refs,n=t.$getKey,o=t.$root,a=t.$pos,i=Xe.formatPos(e),s=[...e?i:a].reduce(((e,r)=>{var t;return null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t[r]}),o),u=null===l||void 0===l||null===(r=l.get)||void 0===r?void 0:r.call(l,n(s));return u},pr=e=>{var r=(0,v.useField)(),t=(0,v.useFieldSchema)();return o.createElement(er,{nodeKey:e.nodeKey},o.createElement(ar.Provider,{value:{field:r,schema:t,props:e}},e.children))},mr=e=>{var r=e.children,t=(0,f.Z)(e,tr),l=t.pos,n="function"===typeof l?l:()=>l;return o.createElement(ir.Provider,{value:t},o.createElement(rr,{getPos:n},(e=>{var t=e.$root===e.$record;return t?null:"function"===typeof r?r(e):r})))},fr=(0,v.observer)((e=>{var r,t,l,n=sr(),i=vr(e.pos),s=(0,v.useField)();if(!n)return null;if("editable"!==n.field.pattern)return null;var u=r=>{var t,l;if(r.stopPropagation(),(null===s||void 0===s||!s.disabled)&&i){var o=i.$pos,a=[...i.$pos],u=o[o.length-1];a[a.length-1]="down"===e.to?u+1:Math.max(u-1,0);var d=null===(t=(l=n.props).onMove)||void 0===t?void 0:t.call(l,o,a,i.$root);"function"===typeof(null===d||void 0===d?void 0:d.then)?d.then((()=>{Ye.move(o,a,i.$root)})):Ye.move(o,a,i.$root)}},d="up"===e.to&&0===(null===i||void 0===i?void 0:i.$index)||"down"===e.to&&(null===i||void 0===i?void 0:i.$index)===(null!==(r=null===i||void 0===i||null===(t=i.$lookup)||void 0===t||null===(l=t.children)||void 0===l?void 0:l.length)&&void 0!==r?r:-1)-1;return d?null:o.createElement(a.Z,{type:"link",size:"small",icon:o.createElement(Ve.Z,{rotate:"up"===e.to?0:180}),onClick:u},s.props.title||s.title)})),gr=e=>{var r=ur(e.pos),t=sr(),n=(0,v.useField)();if(!t)return null;if("editable"!==t.field.pattern)return null;var i=t.field.value;return o.createElement(a.Z,(0,l.Z)({type:"link",size:"small",icon:o.createElement(We.Z,null)},e,{onClick:l=>{var o,a;if(l.stopPropagation(),null===n||void 0===n||!n.disabled){var s=null===(o=(a=t.props).onRemove)||void 0===o?void 0:o.call(a,r,or(i,r),i);"function"===typeof(null===s||void 0===s?void 0:s.then)?s.then((()=>{Ye.remove(r,i)})):Ye.remove(r,i),l.stopPropagation(),e.onClick&&e.onClick(l)}}}),n.props.title||n.title)},hr=e=>{var r=ur();return o.createElement("span",e,"#",null===r||void 0===r?void 0:r.join("."))},yr=e=>{e.clone;var r=(0,f.Z)(e,lr),t=ur(e.pos),n=sr(),i=(0,v.useField)();if(!n)return null;if("editable"!==n.field.pattern)return null;var s=n.field.value;return o.createElement(a.Z,(0,l.Z)({type:"link",size:"small"},r,{icon:o.createElement(Qe.Z,null),onClick:r=>{var l,o;r.stopPropagation(),null!==i&&void 0!==i&&i.disabled||(Ye.copy(t,s,e.clone),null===(l=n.props)||void 0===l||null===(o=l.onCopy)||void 0===o||o.call(l,t,or(s,t),s),r.stopPropagation(),e.onClick&&e.onClick(r))}}),i.props.title||i.title)},br=e=>{var r=e.factory,t=(0,f.Z)(e,nr),n=sr(),i=vr(e.pos),s=(0,v.useField)();if(!n||!i)return null;if("editable"!==n.field.pattern)return null;var u=n.field.value;return o.createElement(a.Z,(0,l.Z)({type:"link",size:"small"},t,{icon:o.createElement(Ge.Z,null),onClick:t=>{var l,o;if(null===s||void 0===s||!s.disabled){t.stopPropagation(),e.onClick&&e.onClick(t);var a=null===(l=n.props)||void 0===l||null===(o=l.onAdd)||void 0===o?void 0:o.call(l,i.$pos,or(u,i.$pos),u);if("function"===typeof(null===a||void 0===a?void 0:a.then))a.then((()=>{setTimeout((()=>{var e=r(or(u,i.$pos));Ye.add(i.$pos,u,e)}),100)}));else{var d=r(or(u,i.$pos));Ye.add(i.$pos,u,d)}}}}),s.props.title||s.title)};pr.Node=mr,pr.Addition=br,pr.Copy=yr,pr.Move=fr,pr.Remove=gr,pr.Pos=hr,pr.useTree=sr,pr.usePos=ur,pr.useRecord=cr,pr.useNodeScope=vr,pr.opreations=Ye,pr.mixin=e=>(e.Copy=pr.Copy,e.Addition=pr.Addition,e.Move=pr.Move,e.Remove=pr.Remove,e.Pos=pr.Pos,e.useTree=pr.useTree,e.usePos=pr.usePos,e.useRecord=pr.useRecord,e.useNodeScope=pr.useNodeScope,e.opreations=pr.opreations,e);var jr=["onChange","children","loadData","value"],Er=()=>Promise.resolve([]),kr=(e,r)=>e.value===r.value,xr={title:"label",key:"value"},Rr={add:!0,delete:!0,set:!0},Zr=(e,r)=>{var t=Rr[e];if(t){var l="loading"===r[r.length-1],n="children"===r[r.length-1];if(n)return!0;if(l){var o="children"===r[r.length-3];if(!o)return;var a=/length|\d+/.test(r[r.length-2]);return a}var i="children"===r[r.length-2];if(i){var s=/length|\d+/.test(r[r.length-1]);return s}}},Cr=(e,r,t,l)=>{if(t(e,r))return[0];var n=l||[];if(!Array.isArray(e.children))return n;for(var o=0;o<e.children.length;o++){var a=e.children[o];if(void 0!==a){if(t(a,r))return n.unshift(o),n;var i=Cr(a,r,t,n);if(i.length>0)return n.unshift(o),n}}return n},wr=(e,r)=>{var t=Cr(e,r,kr),l=[];return t.reduce(((e,r)=>{var t=e.children[r];return l.push(t),t}),e),l},Sr=(0,v.observer)((e=>{e.onChange,e.children,e.loadData,e.value;var r,t,n=(0,f.Z)(e,jr),a=(0,v.useField)(),i=(0,v.useFieldSchema)(),s=(0,o.useState)(null!==(r=null===(t=a.value)||void 0===t?void 0:t.children)&&void 0!==r?r:[]),d=(0,u.default)(s,2),c=d[0],p=d[1],g=(0,o.useMemo)((()=>(0,m.observable)({expandedKeys:[],autoExpandParent:!1})),[]),h=(0,o.useRef)({onChange:e.onChange,loadData:e.loadData});(0,o.useEffect)((()=>{h.current.loadData=e.loadData,h.current.onChange=e.onChange}),[e.loadData,e.onChange]);var y=(0,o.useCallback)((e=>{var r,t=wr(a.value,e),l=t[t.length-1];l.loading=!0;var n=null!==(r=h.current.loadData)&&void 0!==r?r:Er;return n(t).then((e=>{l.children=e,l.loading=!1})).finally((()=>{l.loading=!1}))}),[a.value]);(0,o.useEffect)((()=>{var e,r,t,l;null===(e=(r=h.current).loadData)||void 0===e||null===(t=e.call(r,[]))||void 0===t||null===(l=t.then)||void 0===l||l.call(t,(e=>{a.setValue({label:"ROOT",value:"ROOT",children:e}),p((0,m.toJS)(a.value.children));var r=null,t=(0,m.observe)(a.value,(e=>{var t=Zr(e.type,e.path);t&&(r&&clearTimeout(r),r=setTimeout((()=>{p((0,m.toJS)(a.value.children))})))}));return t}))}),[]);var b=e=>{var r=e.dragNode,t=e.node,l=r.pos.split("-").map(Number);l.shift();var n=t.pos.split("-").map(Number);n.shift(),pr.opreations.move(l,n,a.value),console.log("onDrop",{before:l,after:n})},j=e=>{var r=e.reduce(((e,r)=>{var t;return null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t[r]}),a.value);if(-1===g.expandedKeys.findIndex((e=>e==r.value))&&(g.expandedKeys.push(r.value),!r.children))return y({value:r.value})};return o.createElement(o.Fragment,null,o.createElement(v.RecursionField,{schema:i,onlyRenderSelf:!0}),o.createElement(pr,{nodeKey:xr.key,onAdd:j},o.createElement(Ue.Z,(0,l.Z)({selectable:!1,showLine:!0},n,{expandedKeys:[...g.expandedKeys],autoExpandParent:g.autoExpandParent,onExpand:e=>{g.expandedKeys=e,g.autoExpandParent=!1},titleRender:e=>o.createElement(pr.Node,{pos:r=>{var t=Cr(r,e,kr);return t}},(e=>{var r=e.$path;return e.$record?o.createElement(v.RecursionField,{schema:i.items,name:r,onlyRenderProperties:!0}):null})),draggable:!0,onDrop:b,blockNode:!0,fieldNames:xr,treeData:c,loadData:y})),o.createElement(v.RecursionField,{schema:i,onlyRenderProperties:!0})))})),_r=e=>Ce[e%Ce.length],Pr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r={emap:e.reduce(((e,r)=>(e[r.value]=r.label,e[r.label]=r.value,e)),{}),colors:e.reduce(((e,r,t)=>{var l=r.color||_r(t);return e[r.value]=l,e[r.label]=l,e}),{}),options:e.map(((e,r)=>(0,d.Z)((0,d.Z)({},e),{},{key:e.value,color:e.color||_r(r)})))};return r},$r=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";return e.map((e=>({key:e[t],label:e[r],value:e[t],color:e.color})))},zr=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";return Pr(e.map((e=>({key:e[t],label:e[r],value:e[t],color:e.color}))))},Fr=(0,m.observable)({}),Ar=Fr,Or={},Nr={},Kr=(e,r)=>{Or[e]=()=>r($r).then((r=>{var t=zr(r);return Fr[e]=t,Fr[e]}))},Tr=e=>{(0,c.cW)("*",(e=>{var r,t=null===(r=e.data)||void 0===r?void 0:r.dict;if(t){var l=e.data.dictNoCache;if(!Fr[t]&&!Or[t])throw new Error("\u8bcd\u5178 ".concat(t," \u7684\u52a0\u8f7d\u5668\u4e0d\u5b58\u5728!"),t);if(!0!==l&&Fr[t])e.setState((e=>{e.dataSource=Fr[t].options,e.componentProps&&(e.componentProps.options=e.dataSource)}));else if(t&&Or[t]){e.setState((e=>{e.loading=!0}));var n=Nr[t]||Or[t]();Nr[t]=n.then((r=>(e.setState((e=>{e.dataSource=r.options,e.componentProps&&(e.componentProps.options=e.dataSource),e.loading=!1})),r))).catch((r=>{throw e.setState((e=>{e.loading=!1})),r}))}}})),(0,c.lC)("*",(e=>{var r,t,l=null===(r=e.data)||void 0===r?void 0:r.dict;if(l){var n=(e,r)=>{var t=Array.isArray(e)?e[0]:e,l=Array.isArray(r)?r[0]:r;return t===l},o=e.readPretty||e.readOnly;o?n(e.component,$e)||(e.data.__origin_component=e.component,e.setComponent($e)):null!==(t=e.data)&&void 0!==t&&t.__origin_component&&!n(e.data.__origin_component,e.component)&&e.setComponent(e.data.__origin_component)}}))},Dr=e=>{var r="function"===typeof e?e():e;return(0,m.isSupportObservable)(r)?(0,m.observable)(r):(console.log("WARNING!!, not support obserable"),r)},Ir=e=>{var r=(0,o.useMemo)((()=>Dr(null!==e&&void 0!==e?e:{})),[]);return r}},46700:function(e,r,t){var l={"./af":60757,"./af.js":60757,"./ar":22490,"./ar-dz":15633,"./ar-dz.js":15633,"./ar-kw":12602,"./ar-kw.js":12602,"./ar-ly":34074,"./ar-ly.js":34074,"./ar-ma":98317,"./ar-ma.js":98317,"./ar-sa":29752,"./ar-sa.js":29752,"./ar-tn":66061,"./ar-tn.js":66061,"./ar.js":22490,"./az":92136,"./az.js":92136,"./be":57080,"./be.js":57080,"./bg":48473,"./bg.js":48473,"./bm":38856,"./bm.js":38856,"./bn":17146,"./bn-bd":5223,"./bn-bd.js":5223,"./bn.js":17146,"./bo":30594,"./bo.js":30594,"./br":48831,"./br.js":48831,"./bs":67530,"./bs.js":67530,"./ca":82766,"./ca.js":82766,"./cs":3830,"./cs.js":3830,"./cv":74487,"./cv.js":74487,"./cy":60146,"./cy.js":60146,"./da":66186,"./da.js":66186,"./de":86621,"./de-at":72833,"./de-at.js":72833,"./de-ch":78113,"./de-ch.js":78113,"./de.js":86621,"./dv":32345,"./dv.js":32345,"./el":69981,"./el.js":69981,"./en-au":16498,"./en-au.js":16498,"./en-ca":94555,"./en-ca.js":94555,"./en-gb":93204,"./en-gb.js":93204,"./en-ie":89988,"./en-ie.js":89988,"./en-il":3777,"./en-il.js":3777,"./en-in":23231,"./en-in.js":23231,"./en-nz":30533,"./en-nz.js":30533,"./en-sg":73034,"./en-sg.js":73034,"./eo":21496,"./eo.js":21496,"./es":65678,"./es-do":76879,"./es-do.js":76879,"./es-mx":55440,"./es-mx.js":55440,"./es-us":66963,"./es-us.js":66963,"./es.js":65678,"./et":41003,"./et.js":41003,"./eu":90013,"./eu.js":90013,"./fa":29692,"./fa.js":29692,"./fi":68102,"./fi.js":68102,"./fil":22918,"./fil.js":22918,"./fo":87496,"./fo.js":87496,"./fr":67474,"./fr-ca":1853,"./fr-ca.js":1853,"./fr-ch":44675,"./fr-ch.js":44675,"./fr.js":67474,"./fy":97061,"./fy.js":97061,"./ga":96867,"./ga.js":96867,"./gd":18364,"./gd.js":18364,"./gl":96383,"./gl.js":96383,"./gom-deva":64220,"./gom-deva.js":64220,"./gom-latn":87202,"./gom-latn.js":87202,"./gu":25249,"./gu.js":25249,"./he":96022,"./he.js":96022,"./hi":65395,"./hi.js":65395,"./hr":29361,"./hr.js":29361,"./hu":93797,"./hu.js":93797,"./hy-am":85874,"./hy-am.js":85874,"./id":77084,"./id.js":77084,"./is":12592,"./is.js":12592,"./it":54296,"./it-ch":35272,"./it-ch.js":35272,"./it.js":54296,"./ja":17620,"./ja.js":17620,"./jv":46898,"./jv.js":46898,"./ka":62752,"./ka.js":62752,"./kk":5632,"./kk.js":5632,"./km":16667,"./km.js":16667,"./kn":88963,"./kn.js":88963,"./ko":35953,"./ko.js":35953,"./ku":72004,"./ku.js":72004,"./ky":71803,"./ky.js":71803,"./lb":12835,"./lb.js":12835,"./lo":98185,"./lo.js":98185,"./lt":40538,"./lt.js":40538,"./lv":74582,"./lv.js":74582,"./me":23663,"./me.js":23663,"./mi":35840,"./mi.js":35840,"./mk":88701,"./mk.js":88701,"./ml":2209,"./ml.js":2209,"./mn":38391,"./mn.js":38391,"./mr":14481,"./mr.js":14481,"./ms":20135,"./ms-my":29977,"./ms-my.js":29977,"./ms.js":20135,"./mt":81029,"./mt.js":81029,"./my":27402,"./my.js":27402,"./nb":18929,"./nb.js":18929,"./ne":29030,"./ne.js":29030,"./nl":18208,"./nl-be":92510,"./nl-be.js":92510,"./nl.js":18208,"./nn":46456,"./nn.js":46456,"./oc-lnc":98952,"./oc-lnc.js":98952,"./pa-in":9734,"./pa-in.js":9734,"./pl":67042,"./pl.js":67042,"./pt":97351,"./pt-br":63673,"./pt-br.js":63673,"./pt.js":97351,"./ro":62080,"./ro.js":62080,"./ru":78025,"./ru.js":78025,"./sd":51922,"./sd.js":51922,"./se":82651,"./se.js":82651,"./si":16258,"./si.js":16258,"./sk":23337,"./sk.js":23337,"./sl":8683,"./sl.js":8683,"./sq":10119,"./sq.js":10119,"./sr":72660,"./sr-cyrl":9322,"./sr-cyrl.js":9322,"./sr.js":72660,"./ss":33350,"./ss.js":33350,"./sv":19607,"./sv.js":19607,"./sw":16552,"./sw.js":16552,"./ta":25391,"./ta.js":25391,"./te":78149,"./te.js":78149,"./tet":27113,"./tet.js":27113,"./tg":4503,"./tg.js":4503,"./th":33665,"./th.js":33665,"./tk":68356,"./tk.js":68356,"./tl-ph":62917,"./tl-ph.js":62917,"./tlh":42669,"./tlh.js":42669,"./tr":34573,"./tr.js":34573,"./tzl":16022,"./tzl.js":16022,"./tzm":881,"./tzm-latn":30897,"./tzm-latn.js":30897,"./tzm.js":881,"./ug-cn":45472,"./ug-cn.js":45472,"./uk":1300,"./uk.js":1300,"./ur":96961,"./ur.js":96961,"./uz":51699,"./uz-latn":87476,"./uz-latn.js":87476,"./uz.js":51699,"./vi":91544,"./vi.js":91544,"./x-pseudo":22086,"./x-pseudo.js":22086,"./yo":85911,"./yo.js":85911,"./zh-cn":38098,"./zh-cn.js":38098,"./zh-hk":53720,"./zh-hk.js":53720,"./zh-mo":10794,"./zh-mo.js":10794,"./zh-tw":36087,"./zh-tw.js":36087};function n(e){var r=o(e);return t(r)}function o(e){if(!t.o(l,e)){var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}return l[e]}n.keys=function(){return Object.keys(l)},n.resolve=o,e.exports=n,n.id=46700}}]);