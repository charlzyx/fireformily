(self["webpackChunkfireformily"]=self["webpackChunkfireformily"]||[]).push([[965],{40020:function(e,l,r){"use strict";r.r(l),r.d(l,{Dict:function(){return Pe},ImageView:function(){return Te},Linkage:function(){return Ue},LongText:function(){return Ke},PopActions:function(){return z},QueryForm:function(){return O},QueryList:function(){return D},QueryTable:function(){return Ze},Suggestion:function(){return Fe},TreeBase:function(){return Zl},TreeNodes:function(){return zl},colors:function(){return Ce},dict:function(){return Tl},dictEffects:function(){return Ll},isColorStatus:function(){return we},registerDictLoader:function(){return Il},safeStringify:function(){return _e},useLive:function(){return Ul}});var t=r(13378),o=r(2812),n=r(67294),a=r(48429),i=()=>{},s=e=>{var l,r,t=e.field,o=e.loading,s=e.open,d=e.scope,u=void 0!==(null===d||void 0===d?void 0:d.$index),c=o?i:s;return n.createElement(a.Z,{onClick:c,size:u?"small":null===(l=t.componentProps)||void 0===l?void 0:l.size,type:u?"link":null===(r=t.componentProps)||void 0===r?void 0:r.type},null===t||void 0===t?void 0:t.title)},d=r(44742),u=r(52663),c=r(49229),v=r(18042),m=r(45733),p=r(96730),f=r(3911),h=r(55354),g=["pageSize","current"],y=()=>{},b=(0,n.createContext)(null),j=n.memo((e=>{var l,r=(0,v.useForm)(),t=(0,n.useRef)({}),o=(0,h.Z)(),a=(0,d.default)(o,2),i=a[0],s=a[1],c=(0,n.useRef)(!1),m=(0,v.useExpressionScope)(),j=(0,n.useRef)(!1),E=(0,n.useRef)({service:e.service}),k=(0,n.useCallback)((l=>{var o=E.current.service;if(t.current=l,e.syncUrl){var n=l||{pagination:{}},a=n.pagination,i=a.pageSize,d=a.current,c=n.params;s((e=>{var l=(0,u.Z)({},e);return Object.keys(l).forEach((e=>{l[e]=void 0})),(0,u.Z)((0,u.Z)((0,u.Z)({},l),c),{},{pageSize:i,current:d})}))}return C.current._loading=!0,o((0,u.Z)((0,u.Z)({},l),{},{scope:m})).then((e=>{var l=e.list,t=e.total,o=C.current._address.table,n=r.query(o).take();return o?(n.setState((e=>{(0,p.batch)((()=>{e.value=l,e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.total=t}))})),{list:l,total:t}):{list:[],total:0}})).finally((()=>{C.current._loading=!1}))}),[r,e.syncUrl,m,s]),x=(0,n.useCallback)((()=>{var e=C.current._address.query,l=r.query(e).take(),t=C.current._address.table,o=r.query(t).take();return k((0,u.Z)({params:null===l||void 0===l?void 0:l.value},null===o||void 0===o?void 0:o.data))}),[k,r]),Z=(0,n.useCallback)((()=>{var e=t.current;return k(e)}),[k]),R=(0,n.useCallback)((()=>{var e,l,t,o=null===C||void 0===C||null===(e=C.current)||void 0===e||null===(l=e._address)||void 0===l?void 0:l.table;o&&(null===(t=r.query(o).take())||void 0===t||t.setState((e=>{(0,p.batch)((()=>{e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.current=1}))})));return x()}),[x,r]),C=(0,n.useRef)((0,p.observable)((0,u.Z)((0,u.Z)({},e),{},{service:e.service?k:void 0,syncUrl:e.syncUrl,pageSize:e.pageSize,_refresh:e.service?Z:void 0,_reset:e.service?R:void 0,_trigger:e.service?x:void 0,_address:{query:"",table:""},_scope:m,_cofnig:{_size:null!==(l=e.size)&&void 0!==l?l:"default",_columns:[],_showColumns:[],_selectedRows:[],_selectedRowKeys:[],_selectClear:y,_selectReverse:y}})));return(0,n.useEffect)((()=>{if(e.syncUrl&&!c.current){var l,t,o=C.current._address,n=i||{},a=n.pageSize,s=(n.current,(0,f.Z)(n,g));if(a&&null!==o&&void 0!==o&&o.table)null===(l=r.query(o.table).take())||void 0===l||l.setState((e=>{(0,p.batch)((()=>{e.data=e.data||{},e.data.pagination=e.data.pagination||{},e.data.pagination.pageSize=Number(i.pageSize),e.data.pagination.current=Number(i.current)}))}));if(s&&Object.keys(s).length>0&&null!==o&&void 0!==o&&o.query)null===(t=r.query(o.query).take())||void 0===t||t.setState((e=>{e.value=(0,u.Z)((0,u.Z)({},e.value),s)}));null!==o&&void 0!==o&&o.table&&setTimeout((()=>{c.current=!0}),0)}}),[r,e.syncUrl,i]),(0,n.useEffect)((()=>{if(E.current.service){var e=(0,p.autorun)((()=>{var e,l=null===(e=C.current._address)||void 0===e?void 0:e.table;!1===j.current&&l&&!1!==C.current.autoload&&setTimeout((()=>{x(),j.current=!0}))}));return()=>{e()}}}),[x]),(0,n.useEffect)((()=>{var l=C.current;l.autoload!==e.autoload&&(l.autoload=e.autoload),l.filterRemote!==e.filterRemote&&(l.filterRemote=e.filterRemote),l.sortRemote!==e.sortRemote&&(l.sortRemote=e.sortRemote),l.syncUrl!==e.syncUrl&&(l.syncUrl=e.syncUrl)}),[e.autoload,e.filterRemote,e.sortRemote,e.syncUrl]),n.createElement(b.Provider,{value:C.current},n.createElement(v.ExpressionScope,{value:{get $query(){var e,l=null===(e=C.current._address)||void 0===e?void 0:e.query;return l?r.query(l).take().value:null},get $list(){var e,l=null===(e=C.current._address)||void 0===e?void 0:e.table;return l?r.query(l).take().value:null}}},e.children))})),E=()=>{var e=(0,n.useContext)(b);return e},k=()=>new Promise((e=>{setTimeout((()=>{e("")}),0)})),x=e=>(0,p.isObservable)(e)?e:Array.isArray(e)?[...e]:(0,u.Z)({},e),Z=()=>Promise.resolve({}),R=()=>{var e,l=(0,v.useExpressionScope)(),r=(0,v.useField)(),t=E(),o=null===r||void 0===r||null===(e=r.componentProps)||void 0===e?void 0:e.actions,i=(0,n.useRef)({open:!1,reset:!1,submit:!1}),s=(0,v.useFieldSchema)(),u=(0,n.useRef)(o||{});(0,n.useEffect)((()=>{u.current.load=null===o||void 0===o?void 0:o.load,u.current.cancel=null===o||void 0===o?void 0:o.cancel,u.current.submit=null===o||void 0===o?void 0:o.submit}),[o]);var p=(0,n.useState)(!1),f=(0,d.default)(p,2),h=f[0],g=f[1],y=(0,n.useState)(!1),b=(0,d.default)(y,2),j=b[0],R=b[1],C=(0,n.useCallback)((()=>{if(!r.disabled&&!j&&!i.current.open){i.current.open=!0;var e=u.current.load||Z;return R(!0),e(l).then((e=>{r.setState((l=>{l.value=x(e)})),g(!0)})).finally((()=>{i.current.open=!1,R(!1)}))}}),[r,j,l]),w=(0,n.useCallback)((()=>{if(!r.disabled&&!j&&h&&!i.current.reset){i.current.reset=!0;var e=(0,c.JF)(r)?Z:()=>r.reset(),t=u.current.cancel||Z;return e().then((()=>t(l))).then((()=>{g(!1)})).finally((()=>{i.current.reset=!1,R(!1)}))}}),[r,j,l,h]),_=(0,n.useCallback)((()=>{if(!r.disabled&&!j&&h&&!i.current.submit){i.current.submit=!0;var e=(0,c.JF)(r)?Z:()=>r.submit(),o=(0,c.JF)(r)?Z:()=>r.reset(),n=u.current.submit||Z;return e().then((e=>n(e,l))).then((()=>(g(!1),k().then(o)))).finally((()=>{var e;R(!1),i.current.submit=!1,null===t||void 0===t||null===(e=t._refresh)||void 0===e||e.call(t)}))}}),[t,r,j,l,h]),$=(0,n.useMemo)((()=>r.content?r.content:null),[r.content]),S=(0,n.useMemo)((()=>s?n.createElement(n.Fragment,null,n.createElement(v.RecursionField,{schema:s})):null),[s]),P=(0,n.useMemo)((()=>n.createElement(m.Z,{style:{display:"flex",justifyContent:"flex-end",marginBottom:"16px"}},n.createElement(a.Z,{loading:j,onClick:w},"\u53d6\u6d88"),n.createElement(a.Z,{loading:j,onClick:_,type:"primary"},"\u786e\u5b9a"))),[j,w,_]);return{submit:_,field:r,reset:w,open:C,visible:h,loading:j,body:S,header:$,footer:P,scope:l}},C=e=>{var l=R(),r=l.body,a=l.field,i=l.footer,d=l.header,u=l.loading,c=l.scope,v=l.open,m=l.reset,p=l.visible;return n.createElement(n.Fragment,null,n.createElement(o.Z,(0,t.Z)({width:"68.88%",closable:!0,keyboard:!0},e,{title:e.title||a.title,onClose:l=>{var r;m(),null===e||void 0===e||null===(r=e.onClose)||void 0===r||r.call(e,l)},open:p,afterOpenChange:l=>{var r;l||m(),null===e||void 0===e||null===(r=e.afterOpenChange)||void 0===r||r.call(e,l)},footer:i}),d,r),n.createElement(s,{open:v,field:a,loading:u,scope:c}))},w=r(86444),_=e=>{var l=R(),r=l.visible,o=l.body,a=l.field,i=l.scope,d=l.footer,u=l.header,c=l.loading,v=l.open,m=l.reset;return n.createElement(n.Fragment,null,n.createElement(w.Z,(0,t.Z)({maskClosable:!1,keyboard:!1,closable:!1,width:"68.88%"},e,{afterClose:()=>{var l;null===e||void 0===e||null===(l=e.afterClose)||void 0===l||l.call(e),m()},open:r,title:e.title||a.title,footer:d}),u,o),n.createElement(s,{open:v,field:a,loading:c,scope:i}))},$=r(7523),S=e=>{var l=R(),r=l.body,o=l.field,a=l.header,i=l.loading,d=l.scope,u=l.open,c=l.reset,v=l.submit,m=l.visible;return n.createElement($.Z,(0,t.Z)({},e,{title:n.createElement(n.Fragment,null,n.createElement("h4",null,o.title||a),o.title?null:a,r),cancelButtonProps:{loading:i},okButtonProps:{loading:i},onCancel:c,onConfirm:v,open:m,onOpenChange:l=>{var r;l||c(),null===e||void 0===e||null===(r=e.onOpenChange)||void 0===r||r.call(e,l)}}),n.createElement(s,{open:u,field:o,loading:i,scope:d}))},P=r(56466),N=e=>{var l=R(),r=l.body,o=l.field,a=l.scope,i=l.footer,d=l.header,u=l.loading,c=l.open,v=l.reset,m=l.visible;return console.log("--popovver",{visible:m}),n.createElement(P.Z,(0,t.Z)({},e,{trigger:"click",title:e.title||o.title,content:n.createElement(n.Fragment,null,d,r,i),open:m,onOpenChange:l=>{var r;null===e||void 0===e||null===(r=e.onOpenChange)||void 0===r||r.call(e,l),l||v()}}),n.createElement(s,{open:c,field:o,loading:u,scope:a}))},z=_;z.Drawer=C,z.Modal=_,z.Popconfirm=S,z.Popover=N;var F,A=r(36158),K=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=e.maxRows||1,r=(0,n.useMemo)((()=>A.T5.createFormGrid({maxColumns:e.maxColumns||4,maxWidth:e.maxWidth||320,maxRows:l,shouldVisible:(e,t)=>e.index===r.childSize-1||(t.maxRows===1/0||e.shadowRow<l+1)})),[e.maxColumns,e.maxWidth,l]),t=r.fullnessLastColumn?r.shadowRows-1:r.shadowRows,o=t<=l?void 0:r.maxRows===1/0,a=()=>{r.maxRows===1/0?r.maxRows=l:r.maxRows=1/0};return{grid:r,expanded:o,toggle:a}},O=(0,v.observer)((e=>{var l,r=e.resetText,o=e.submitText,i=(0,v.useField)(),s=(0,v.useForm)(),d=K(e.grid),u=d.grid,c=d.expanded,m=d.toggle,p=E(),f=p||{},h=f._loading,g=(f._refresh,f._reset),y=f._trigger,b=()=>{var e;h||(p?s.reset(null===(e=p._address)||void 0===e?void 0:e.query,{forceClear:!0,validate:!1}).then((()=>{null===g||void 0===g||g()})):setTimeout((()=>{null===g||void 0===g||g()})))},j=()=>{if(!h)return null===y||void 0===y?void 0:y()};(0,n.useEffect)((()=>{p&&(p._address.query=i.address.toString())}),[p,null===i||void 0===i||null===(l=i.address)||void 0===l?void 0:l.toString()]);var k=()=>n.createElement(A.d5,{align:"right",style:{width:"100%",marginBottom:"22px",display:"flex",justifyContent:"flex-end"}},void 0!==c?n.createElement(a.Z,{type:"link",onClick:e=>{e.preventDefault(),m()}},c?"\u6536\u8d77":"\u5c55\u5f00"):null,n.createElement(a.Z,{onClick:b},r||"\u91cd\u7f6e"),n.createElement(a.Z,{onClick:j,type:"primary"},o||"\u67e5\u8be2"));return e.children?n.createElement(A.T5,(0,t.Z)({},u,{grid:u}),e.children,n.createElement(A.T5.GridColumn,{gridSpan:-1,style:{display:"flex",justifyContent:"space-between"}},k())):null})),D=e=>n.createElement(j,e,e.children),T=r(39941),M=r(33634),q=e=>{var l=e.items||e,r=l.reduceProperties(((e,l)=>{var r;return e||("QueryTable"===l["x-component"]?null:(null===(r=l["x-component"])||void 0===r?void 0:r.indexOf("SortHandle"))>-1?l:l.properties||l.items?q(l):e)}));return r},I=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Column"))>-1},L=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Operations"))>-1},B=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Addition"))>-1},U=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Expand"))>-1},J=e=>{var l;return(null===(l=e["x-component"])||void 0===l?void 0:l.indexOf("Selection"))>-1},V=()=>{var e=(0,v.useFieldSchema)();return e.reduceProperties(((e,l,r)=>B(l)?n.createElement(v.RecursionField,{schema:l,name:r}):e),null)},W=r(5085),Q=r.n(W),G=r(62878),H=r(91522),X=r(2291),Y=A.wR,ee=(e,l)=>{if(!e)return[];var r=[],t=(0,G.isArr)(e)?e:[e];return t.reduce(((e,r)=>{var t=l(r);return t?e.concat(t):e}),r)},le=(e,l,r,t)=>{var o=Object.keys(l.properties||{}).length,a=e.maxItems||2,i=o>a?n.createElement(H.Z,{mode:"vertical",items:l.mapProperties(((e,l,t)=>t<a?null:{key:t,label:n.createElement(v.RecursionField,{schema:e,name:"".concat(r,".").concat(l)})})).filter(Boolean)}):void 0;return n.createElement(Y.Item,{index:r,record:()=>{var e;return null===t||void 0===t||null===(e=t.value)||void 0===e?void 0:e[r]}},n.createElement(m.Z,{size:"small"},l.mapProperties(((e,l,t)=>t>=a?null:n.createElement(v.RecursionField,{key:"".concat(r,".").concat(l),schema:e,name:"".concat(r,".").concat(l)}))),o>a?n.createElement(X.Z,{overlay:i},n.createElement("a",null,n.createElement(Q(),null))):null))},re=e=>{var l=E(),r=(0,v.useFieldSchema)(),t=l=>{if(I(l)||L(l)||B(l)){var r,o,n;if((null===(r=l["x-component-props"])||void 0===r||!r["dataIndex"])&&!l["name"])return[];var a=(null===(o=l["x-component-props"])||void 0===o?void 0:o["dataIndex"])||l["name"],i=e.query(e.address.concat(a)).take(),s=(null===i||void 0===i||null===(n=i.component)||void 0===n?void 0:n[1])||l["x-component-props"]||{},d=(null===i||void 0===i?void 0:i.display)||l["x-display"];return[{name:a,display:d,field:i,schema:l,columnProps:s}]}return l.properties?l.reduceProperties(((e,l)=>e.concat(t(l))),[]):[]};if(!r)throw new Error("can not found schema object");var o=ee(r.items,t),a=o.reduce(((r,t,o)=>{var a,i=t.name,s=t.columnProps,d=t.schema,c=t.display;return l&&l._cofnig&&(null===l||void 0===l?void 0:l._cofnig._showColumns.length)>0&&-1===(null===l||void 0===l||null===(a=l._cofnig._showColumns)||void 0===a?void 0:a.findIndex((e=>e===i)))||"hidden"===c?r:L(d)?r.concat((0,u.Z)((0,u.Z)({fixed:!0},s),{},{key:o,dataIndex:i,render:(l,r)=>{var t,o=null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.indexOf(r);return le(s,d,o,e)}})):I(d)?r.concat((0,u.Z)((0,u.Z)({},s),{},{filters:Array.isArray(s.filters)?s.filters:void 0,key:i,dataIndex:i,render:(l,r)=>{var t,o=null===e||void 0===e||null===(t=e.value)||void 0===t?void 0:t.indexOf(r),a=n.createElement(Y.Item,{index:o,record:()=>{var l;return null===e||void 0===e||null===(l=e.value)||void 0===l?void 0:l[o]}},n.createElement(v.RecursionField,{schema:d,name:o,onlyRenderProperties:!0}));return a}})):r}),[]),i=()=>o.map(((e,l)=>I(e.schema)?n.createElement(v.RecursionField,{key:l,schema:e.schema,name:e.name,onlyRenderSelf:!0}):null));return[a,i]},te=e=>{var l;return"QueryList"===(null===(l=e.parent)||void 0===l?void 0:l["x-component"])?e.parent:e.parent?te(e.parent):null},oe=e=>{if(e){var l=e.reduceProperties(((e,l)=>{if(e)return e;var r="QueryTable.Selection"===l["x-component"];return!!r||!!l.properties&&oe(l)}),!1);return l}return!1},ne=(e,l)=>{var r=(0,v.useField)(),t=E(),o=(0,v.useFieldSchema)(),a=oe(te(o)),i=(0,n.useRef)(e);(0,n.useEffect)((()=>{i.current=e}),[e]);var s=(0,n.useCallback)((()=>{var e,o;if(t&&(a||l)){var n=t._cofnig,s=(0,p.observable)((0,u.Z)((0,u.Z)({type:"checkbox"},l),{},{selectedRows:null!==(e=n._selectedRows)&&void 0!==e?e:[],selectedRowKeys:null!==(o=n._selectedRowKeys)&&void 0!==o?o:[],clear:()=>{n._selectedRowKeys=[],n._selectedRows=[]},reverse:()=>{var e=r.value,l=e.filter((e=>!n._selectedRows.find((l=>l===e)))),t=l.map((e=>{var l="function"==typeof i.current?i.current(e):e[i.current];return l}));n._selectedRowKeys=t,n._selectedRows=l},onChange:(e,l)=>{n._selectedRowKeys=e,n._selectedRows=l}}));return n._selectReverse=s.reverse,n._selectClear=s.clear,s}}),[t,r.value,a,l]);return s()},ae=r(49194),ie=()=>{var e=E(),l=(0,v.useFieldSchema)(),r=l.reduceProperties(((l,r,t)=>(J(r)&&l.push(n.createElement(v.RecordScope,{key:t,getRecord:()=>{var l,r,t,o;return{selectedRowKeys:null!==(l=null===e||void 0===e||null===(r=e._cofnig)||void 0===r?void 0:r._selectedRowKeys)&&void 0!==l?l:[],selectedRows:null!==(t=null===e||void 0===e||null===(o=e._cofnig)||void 0===o?void 0:o._selectedRows)&&void 0!==t?t:[]}},getIndex:()=>-1},n.createElement(m.Z,{split:n.createElement(ae.Z,{type:"vertical"})},r.mapProperties(((e,l)=>n.createElement(v.RecursionField,{key:l,schema:e,name:l})))))),l)),[]);return r.length>0?r:null},se=r(98072),de=r(24750),ue=(0,de.W8)((e=>n.createElement("tr",e))),ce=(0,de.JN)((e=>n.createElement("tbody",e))),ve=e=>n.createElement(ue,(0,t.Z)({index:e["data-row-sort-index"]||0},e)),me=(e,l)=>{var r=document.body.querySelector(".".concat(l,"-sort-helper"));if(r){var t=e.querySelectorAll("td");requestAnimationFrame((()=>{r.querySelectorAll("td").forEach(((e,l)=>{t[l]&&(e.style.width=getComputedStyle(t[l]).width)}))}))}},pe=e=>{var l=(0,se.usePrefixCls)("formily-array-table"),r=(0,v.useField)(),o=(0,v.useFieldSchema)(),a=(0,v.useExpressionScope)(),i=(0,n.useMemo)((()=>q(o)),[o]),s=E(),d=(0,n.useCallback)((o=>n.createElement(ce,(0,t.Z)({useDragHandle:!0,lockAxis:"y",helperClass:"".concat(l,"-sort-helper"),helperContainer:()=>{var l;return null===(l=e.current)||void 0===l?void 0:l.querySelector("tbody")},onSortStart:e=>{var r=e.node;me(r,l)},onSortEnd:e=>{var l,t=e.oldIndex,o=e.newIndex,n=null===(l=r.componentProps)||void 0===l?void 0:l.onSort;if("function"===typeof n){var i=n(t,o,(0,p.toJS)(r.value),a);i instanceof Promise?(r.setLoading(!0),r.move(t,o),i.then((e=>{var l;e&&(null===s||void 0===s||null===(l=s._refresh)||void 0===l||l.call(s));r.setLoading(!1)})).catch((()=>{r.move(o,t),r.setLoading(!1)}))):r.move(t,o)}else r.move(t,o)}},o))),[s,r,e,l]),u={wrapper:i?d:void 0,row:i?ve:void 0};return u},fe=A.wR,he=e=>{var l=(0,v.useField)(),r=(0,v.useFieldSchema)(),t=r.reduceProperties(((e,l,r)=>U(l)?l:e),null),o=(0,n.useMemo)((()=>{if(t)return(0,u.Z)((0,u.Z)({},e),{},{expandedRowRender:(e,r,o,a)=>n.createElement(fe.Item,{key:a?"expand-".concat(new Date):"hidden-".concat(r),index:r,record:()=>{var e;return null===l||void 0===l||null===(e=l.value)||void 0===e?void 0:e[r]}},n.createElement(v.RecursionField,{schema:t,name:r,onlyRenderProperties:!0}))})}),[null===l||void 0===l?void 0:l.value,t,e]);return o},ge=r(59879),ye=r(17828),be=r(24616),je=r(42091),Ee=r(45904),ke=r(43732),xe=(0,v.observer)((e=>{var l=(0,v.useField)(),r=E();if(!r)return null;var t=null===r||void 0===r?void 0:r._cofnig,o=n.createElement(H.Z,{selectable:!0,onSelect:e=>{t._size=e.key},defaultValue:t._size,items:[{label:"\u9ed8\u8ba4",key:"default"},{label:"\u4e2d\u7b49",key:"middle"},{label:"\u7d27\u51d1",key:"small"}]}),i=ie(),s=n.createElement(H.Z,{selectable:!0,multiple:!0,items:t._columns.map((e=>{var l=t._showColumns.findIndex((l=>l===e.key)),r=l>-1,o=o=>{o.stopPropagation(),o.preventDefault(),r?t._showColumns.splice(l,1):t._showColumns.push(e.key)};return{label:n.createElement(m.Z,{onClick:o},n.createElement(je.Z,{checked:r}),e.label),key:e.key}}))});return n.createElement(m.Z,{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"}},n.createElement(m.Z,{size:"small"},n.createElement(Ee.Z.Title,{level:5},l.title||e.title),t._selectedRowKeys.length?n.createElement(ke.Z,{style:{padding:"3px 4px"},type:"info",message:n.createElement(m.Z,{size:"small",split:n.createElement(ae.Z,{type:"vertical"})},n.createElement(a.Z,{type:"text",size:"small"},"\u9009\u4e2d ",t._selectedRowKeys.length," \u9879"),n.createElement(a.Z,{size:"small",onClick:()=>{var e;null===(e=t._selectClear)||void 0===e||e.call(t)},type:"link"},"\u53d6\u6d88\u9009\u62e9"),n.createElement(a.Z,{size:"small",onClick:()=>{var e;null===(e=t._selectReverse)||void 0===e||e.call(t)},type:"link"},"\u53cd\u5411\u9009\u62e9"),i)}):null),n.createElement(m.Z,{size:"small"},n.createElement(m.Z,null,e.children),n.createElement(m.Z,{size:"large"},n.createElement(ge.Z,{onClick:()=>{var e;null===r||void 0===r||null===(e=r._refresh)||void 0===e||e.call(r)},loop:null===r||void 0===r?void 0:r._loading}),n.createElement(X.Z,{key:"size",overlay:o},n.createElement(ye.Z,null)),n.createElement(X.Z,{key:"columns",overlay:s},n.createElement(be.Z,null)))))})),Ze=(0,v.observer)((e=>{var l,r,o=(0,n.useRef)(null),a=(0,T.F)("formily-array-table"),i=E(),s=(0,v.useField)(),c=Array.isArray(s.value)?s.value.slice():[],m=e=>c.indexOf(e),p=pe(o),f=re(s),h=(0,d.default)(f,2),g=h[0],y=h[1],b=V(),j=he(e.expandable),k=ne(e.rowKey||m,e.rowSelection);(0,n.useEffect)((()=>{i&&(i._address.table=s.address.toString())}),[i,null===s||void 0===s||null===(l=s.address)||void 0===l?void 0:l.toString()]),(0,n.useEffect)((()=>{null!==i&&void 0!==i&&i.service&&s&&!s.data&&(s.data={},s.data.pagination={current:1,pageSize:i.pageSize||10})}),[i,s,e.pagination]),(0,n.useEffect)((()=>{if(i){var e=i._cofnig;g.forEach((l=>{-1===e._columns.findIndex((e=>e.key===l.dataIndex))&&(e._columns.push({label:l.title,key:l.dataIndex}),e._showColumns.push(l.dataIndex))}))}}),[g,i]);var x=()=>{var l,r=null===s||void 0===s||null===(l=s.data)||void 0===l?void 0:l.pagination,t=e.pagination||{},o=!!r&&(!(r.pageSize>r.total)&&(0,u.Z)((0,u.Z)((0,u.Z)({},t),r),{},{showTotal:(e,l)=>"\u7b2c ".concat(l[0],"-").concat(l[1]," \u6761, \u5171 ").concat(e," \u6761\u6570\u636e")}));return o};return n.createElement("div",{ref:o,className:a},n.createElement(A.wR,null,n.createElement(M.Z,(0,t.Z)({rowKey:m},e,{size:null===i||void 0===i||null===(r=i._cofnig)||void 0===r?void 0:r._size,expandable:j,rowSelection:k,onRow:(l,r)=>{var t,o=(null===e||void 0===e||null===(t=e.onRow)||void 0===t?void 0:t.call(e,l,r))||{};return o["data-row-sort-index"]=r,o},columns:g,loading:e.loading||(null===i||void 0===i?void 0:i._loading),components:{body:p},dataSource:c,pagination:x(),onChange:(e,l,r,t)=>{var o;if(s.setData({pagination:e,filters:l,sorter:r,extra:t}),"paginate"===t.action)null===i||void 0===i||null===(o=i._trigger)||void 0===o||o.call(i);else if("sort"===t.action&&null!==i&&void 0!==i&&i.sortRemote){var n;null===i||void 0===i||null===(n=i._trigger)||void 0===n||n.call(i)}else if("filter"===t.action&&null!==i&&void 0!==i&&i.filterRemote){var a;null===i||void 0===i||null===(a=i._trigger)||void 0===a||a.call(i)}}})),y(),b))}));null===A.wR||void 0===A.wR||null===(F=A.wR.mixin)||void 0===F||F.call(A.wR,Ze),Ze.Operations=()=>n.createElement(n.Fragment,null),Ze.Column=()=>n.createElement(n.Fragment,null),Ze.Expand=()=>n.createElement(n.Fragment,null),Ze.Selection=()=>n.createElement(n.Fragment,null),Ze.Titlebar=xe;var Re={success:"green",processing:"blue",error:"red",warning:"gold",default:"#fafafa"},Ce=(0,u.Z)({length:11,0:"magenta",1:"green",2:"cyan",3:"geekblue",4:"purple",5:"red",6:"orange",7:"lime",8:"blue",9:"volcano",10:"gold",magenta:"magenta",green:"green",cyan:"cyan",geekblue:"geekblue",purple:"purple",red:"red",orange:"orange",lime:"lime",blue:"blue",volcano:"volcano",gold:"gold"},Re),we=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Boolean(Re[e])},_e=e=>{var l=new WeakMap,r=e=>{if(Array.isArray(e))return e.map(r);if("function"===typeof e)return"f ".concat(e.displayName||e.name,"(){ }");if("object"===typeof e){if(l.get(e))return"#CircularReference";if(!e)return e;if("$$typeof"in e&&"_owner"in e)return l.set(e,!0),"#ReactNode";if(e.toJS)return l.set(e,!0),e.toJS();if(e.toJSON)return l.set(e,!0),e.toJSON();l.set(e,!0);var t={};for(var o in e)t[o]=r(e[o]);return l.set(e,!1),t}return e};return JSON.stringify(r(e),null,2)},$e=r(33227),Se=r(74356),Pe=e=>{var l=e.strict,r=e.type,t=e.value,o=e.options,a=(0,n.useMemo)((()=>{if(!Array.isArray(o))return[];var e=Array.isArray(t)?t.map((e=>o.find((r=>l?r.value===e:r.value==e)))):[o.find((e=>l?e.value===t:e.value==t))];return e.filter(Boolean)}),[o,l,t]);return n.createElement(m.Z,{size:"small"},a.map((e=>"badge"===r?n.createElement($e.Z,{key:null===e||void 0===e?void 0:e.key,status:we(null===e||void 0===e?void 0:e.color)?null===e||void 0===e?void 0:e.color:void 0,color:we(null===e||void 0===e?void 0:e.color)||null===e||void 0===e?void 0:e.color,text:null===e||void 0===e?void 0:e.label}):"tag"===r?n.createElement(Se.Z,{key:null===e||void 0===e?void 0:e.key,color:null===e||void 0===e?void 0:e.color},null===e||void 0===e?void 0:e.label):null===e||void 0===e?void 0:e.label)))},Ne=r(90407),ze=(e,l)=>{var r=l;return e&&(r=Array.isArray(l)?l:[]),r},Fe=e=>{var l=(0,n.useState)([]),r=(0,d.default)(l,2),t=r[0],o=r[1],a=(0,n.useState)(ze(e.multiple,e.value)),i=(0,d.default)(a,2),s=i[0],c=i[1],v=(0,n.useState)(!1),m=(0,d.default)(v,2),p=m[0],f=m[1],h=(0,n.useRef)(e.suggest);(0,n.useEffect)((()=>{e.suggest&&(h.current=e.suggest)}),[e.suggest]);var g=(0,n.useRef)(null),y=(0,n.useRef)(0),b=(0,n.useCallback)((e=>{var l=++y.current;g.current&&clearTimeout(g.current),g.current=setTimeout((()=>{var r,t;f(!0),h.current||f(!1),null===(r=h.current)||void 0===r||null===(t=r.call(h,e))||void 0===t||t.then((e=>{l<y.current||o(e)})).finally((()=>{f(!1)}))}),200)}),[]),j=l=>{h.current&&(l?b((0,u.Z)((0,u.Z)({},e.params),{},{kw:l})):o([]))},E=l=>{var r;c(l),null===(r=e.onChange)||void 0===r||r.call(e,l)};return n.createElement(Ne.Z,{showSearch:!0,loading:p,value:s,labelInValue:e.labelInValue,mode:e.multiple?"multiple":void 0,placeholder:e.placeholder,style:e.style,disabled:e.disabled,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:j,onChange:E,options:t})},Ae=Ee.Z.Paragraph,Ke=e=>n.createElement(Ae,(0,t.Z)({copyable:!0,ellipsis:!0},e),e.value),Oe=r(69131),De={width:"60px",height:"60px",objectFit:"contain"},Te=e=>{var l=e.value,r=e.style,t=(0,n.useMemo)((()=>{var e=Array.isArray(l)?l:[l];return e.filter(Boolean)}),[l]),o=(0,n.useMemo)((()=>(0,u.Z)((0,u.Z)({},De),r)),[r]);return n.createElement(n.Fragment,null,n.createElement(Oe.Z.PreviewGroup,null,t.map((e=>n.createElement(Oe.Z,{style:o,key:e,src:e,preview:!0})))))},Me=r(79594),qe=["value","loadAll","labelInValue","disabled","multiple","onChange","loadData"],Ie={width:"100%"},Le=(e,l)=>e&&Array.isArray(l)&&l.length>0?null===l||void 0===l?void 0:l.reduceRight(((e,l)=>e?(l.children=e,l.__init=!0,[l]):(l.isLeaf=!0,[l])),null):[],Be=e=>{var l=e.loadData,r=e.loadAll,t=e.value,o=e.labelInValue,a=(0,n.useRef)(r||l);(0,n.useEffect)((()=>{a.current=r||l}),[r,l]);var i=(0,n.useMemo)((()=>(0,p.observable)({inited:!1,loading:!1,options:Le(o,t),load:e=>{var l,r,t=e[e.length-1];t&&(t.loading=!0,i.loading=!0,null===(l=a.current)||void 0===l||null===(r=l.call(a,e).then((e=>{e?t.children=e.map((e=>(0,u.Z)({isLeaf:!1},e))):t.isLeaf=!0})))||void 0===r||r.finally((()=>{t.loading=!1,i.loading=!1})))}})),[]);if(!i.inited&&!i.loading){var s,d,c;i.loading=!0,i.inited=!0;var v=Array.isArray(t)?o?t:t.map((e=>({value:e}))):[];null===(s=a.current)||void 0===s||null===(d=s.call(a,v))||void 0===d||null===(c=d.then((e=>{e&&(i.options=e.map((e=>(0,u.Z)({isLeaf:!1},e))))})))||void 0===c||c.finally((()=>{i.loading=!1}))}return i},Ue=e=>{var l=e.value,r=e.loadAll,o=e.labelInValue,a=e.disabled,i=e.multiple,s=e.onChange,d=(e.loadData,(0,f.Z)(e,qe)),u=Be(e),c=(0,n.useCallback)(((e,l)=>o?null===s||void 0===s?void 0:s(l):null===s||void 0===s?void 0:s(e)),[o,s]),m=e=>Array.isArray(e)?e.map((e=>Array.isArray(e)?m(e):e.label?e.value:e)):[];return n.createElement(v.Observer,null,(()=>n.createElement(Me.Z,(0,t.Z)({disabled:a,multiple:i,changeOnSelect:!0},d,{loading:u.loading,value:m(l),style:e.style||Ie,options:[...u.options],loadData:r?void 0:u.load,onChange:c}))))},Je=r(54943),Ve=r(56630),We=r(73171),Qe=r(49101),Ge=r(99165),He={title:"label",key:"value",children:"children"},Xe=(e,l)=>(e.__dirty=!0,e),Ye=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:He,l=l=>null===l||void 0===l?void 0:l[e.children];return{formatPos:e=>e?"string"===typeof e?e.split("-").map(Number):e:[],posToPath:function(){var l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return l.reduce(((l,r)=>l?"".concat(l,".").concat(e.children,".").concat(r):"".concat(e.children,".").concat(r)),"")},getNodeByPos:(e,r)=>{if(e&&r){var t=e.reduce(((e,r)=>{var t=l(e);return null===t||void 0===t?void 0:t[r]}),r);return t}}}},el=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:He,l=Ye(e),r=l=>null===l||void 0===l?void 0:l[e.children];return{remove:(e,t)=>{if(t&&e){var o=l.formatPos(e);return(0,p.batch)((()=>{o.reduce(((e,l,t)=>{var n,a=t===o.length-1;a&&(null===(n=r(e))||void 0===n||n.splice(l,1));return r(e)[l]}),t)})),Xe(t,!0),t}},copy:(e,t,o)=>{if(o&&e){var n=l.formatPos(e);return(0,p.batch)((()=>{n.reduce(((e,l,o)=>{var a=o===n.length-1,i=r(e);return a&&(null===i||void 0===i||i.splice(l+1,0,t)),i[l]}),o)})),Xe(o,!0),o}},appendChildren:(t,o,n)=>{if(o&&t){var a=l.formatPos(t);return(0,p.batch)((()=>{a.reduce(((l,t,o)=>{var i=o===a.length-1,s=r(l);return i&&(s[t][e.children]=n),s[t]}),o)})),Xe(o,!0),o}},append:function(t,o,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"push";if(o&&t){var i=l.formatPos(t);return(0,p.batch)((()=>{i.reduce(((l,t,o)=>{var s=o===i.length-1,d=r(l);if(s){var u=null===d||void 0===d?void 0:d[t];u[e.children]||(u[e.children]=[]);var c=r(u);return console.log("myChildren",c),"push"===a?c.push(n):c.unshift(n),u}return d[t]}),o)})),console.log("markddirty"),Xe(o,!0),o}},move:(e,l,t)=>(JSON.stringify(e)===JSON.stringify(l)||((0,p.batch)((()=>{var o=e.length===l.length&&e.slice(0,e.length-1).join("_")===l.slice(0,l.length-1).join("_");if(o)e.reduce(((t,o,n)=>{var a=n===e.length-1,i=r(t);if(a){var s=e[e.length-1],d=l[l.length-1],u=d>s?d+1:d,c=i.splice(s,1)[0];i.splice(u,0,c)}return i[o]}),t);else{var n=null;if(e.reduce(((l,t,o)=>{var a=o===e.length-1,i=r(l);return a&&(n=i.splice(t,1)[0]),i[t]}),t),!n)return t;l.reduce(((e,t,o)=>{var a=o===l.length-1,i=r(e);return a&&i.splice(t,0,n),i[t]}),t)}})),Xe(t,!0)),t)}},ll=(0,n.createContext)(null),rl=(0,n.createContext)(null),tl=()=>{var e=(0,n.useContext)(ll);return e},ol=e=>{var l,r=tl(),t=(0,n.useContext)(rl);return e&&null!==(l=null===r||void 0===r?void 0:r.$refs.get(e))&&void 0!==l?l:t},nl=e=>{var l=(0,v.useField)(),r=e.children,t=e.getRoot,o=(0,n.useMemo)((()=>(0,u.Z)((0,u.Z)({},He),e.fieldNames)),[e.fieldNames]),a=(0,n.useRef)({getRoot:t}),i=(0,n.useMemo)((()=>{var e=new Map,r={get $root(){return"function"===typeof a.current.getRoot?a.current.getRoot():l.value},get fieldNames(){return o},get $refs(){return e}};return r}),[]);return n.createElement(ll.Provider,{value:i},n.createElement(v.ExpressionScope,{value:i},r))},al=e=>{var l=tl(),r=e.getPos,t=e.getNode,o=e.children,a=(0,n.useRef)({getPos:r,getNode:t});(0,n.useEffect)((()=>{a.current.getPos=e.getPos}),[e.getPos]),(0,n.useEffect)((()=>{a.current.getNode=e.getNode}),[e.getNode]);var i=(0,n.useMemo)((()=>{var r;if(!l)return{};var t=Ye(l.fieldNames),o=l.$refs,n=l.fieldNames,i={get $root(){return l.$root},get $pos(){var e=a.current.getPos(l.$root);return t.formatPos(e)},get $path(){return t.posToPath(this.$pos)},get $extra(){var l;return null===(l=e.getExtra)||void 0===l?void 0:l.call(e,this.$root)},get $record(){var e="function"===typeof a.current.getNode?a.current.getNode(l.$root):t.getNodeByPos(this.$pos,this.$root),r=e===this.$root;return r?e:"object"===typeof e?(0,G.lazyMerge)(e,{get $lookup(){return i.$lookup},get $index(){return i.$index},get $pos(){return i.$pos}}):e},get $lookup(){var e,r,o=(null===(e=this.$pos)||void 0===e?void 0:e.slice(0,this.$pos.length-1))||[],a=t.getNodeByPos(o,this.$root),i=a?null===(r=l.$refs.get(null===a||void 0===a?void 0:a[n.key]))||void 0===r?void 0:r.$record:void 0;return null!==i&&void 0!==i?i:this.$root},get $records(){var e,l;return null!==(e=null===(l=this.$lookup)||void 0===l?void 0:l[n.children])&&void 0!==e?e:[]},get $parents(){var e=Array.isArray(this.$pos)?[...this.$pos]:[],l=[];return e.reduce(((e,r)=>{l.push(e);var t=e[n.children][r];return t}),this.$root),l},get $index(){return this.$pos?this.$pos[this.$pos.length-1]:-1}};return o.set(null===(r=i.$record)||void 0===r?void 0:r[n.key],i),i}),[]);return n.createElement(rl.Provider,{value:i},n.createElement(v.ExpressionScope,{value:i},o))},il=["pos"],sl=["pos"],dl=["pos","factory","method"],ul=["pos","clone"],cl=(0,n.createContext)(null),vl=(0,n.createContext)(null),ml=()=>(0,n.useContext)(cl),pl=(e,l,r)=>{var t="function"===typeof e?null===r||void 0===r?void 0:r.formatPos(e(l)):null===r||void 0===r?void 0:r.formatPos(e);return null!==t&&void 0!==t?t:[]},fl=e=>{var l=ml(),r=tl(),t=(0,n.useContext)(vl);return t?pl(t.pos,null===r||void 0===r?void 0:r.$root,null===l||void 0===l?void 0:l.helper):null===l||void 0===l?void 0:l.helper.formatPos(e)},hl=e=>{var l,r=ml(),t=tl(),o=null===r||void 0===r?void 0:r.helper.getNodeByPos(e,null===t||void 0===t?void 0:t.$root),n=ol(null===o||void 0===o?void 0:o[(null===t||void 0===t||null===(l=t.fieldNames)||void 0===l?void 0:l.key)||""]);return n},gl=e=>{var l=e.fieldNames,r=e.getRoot,t=(0,v.useField)(),o=(0,v.useFieldSchema)(),a=(0,n.useMemo)((()=>({field:t,schema:o,props:e,opreations:el(l),helper:Ye(l)})),[t,l,e,o]);return n.createElement(nl,{fieldNames:l,getRoot:r},n.createElement(cl.Provider,{value:a},e.children))},yl=e=>{var l=e.pos,r=e.children,t=e.getNode,o=e.getExtra,a="function"===typeof l?l:()=>l;return n.createElement(vl.Provider,{value:e},n.createElement(al,{getPos:a,getNode:t,getExtra:o},r))},bl=e=>{var l=fl();return n.createElement("span",e,"#",null===l||void 0===l?void 0:l.join("-")," ")},jl=e=>{var l,r,o=e.pos,i=(0,f.Z)(e,il),s=ml(),d=hl(null===s||void 0===s?void 0:s.helper.formatPos(o)),u=(0,v.useField)();if(!s)return null;if("editable"!==s.field.pattern)return null;var c="up"===e.to&&0===(null===d||void 0===d?void 0:d.$index)||"down"===e.to&&(null===d||void 0===d?void 0:d.$index)===(null!==(l=null===d||void 0===d||null===(r=d.$records)||void 0===r?void 0:r.length)&&void 0!==l?l:-1)-1;return c?null:n.createElement(a.Z,(0,t.Z)({type:"link",size:"small",icon:n.createElement(Ve.Z,{rotate:"up"===e.to?0:180})},i,{onClick:l=>{var r,t;if(l.stopPropagation(),(null===u||void 0===u||!u.disabled)&&d){var o=d.$pos,n=[...d.$pos],a=o[o.length-1];n[n.length-1]="down"===e.to?a+1:Math.max(a-1,0);var i=null===(r=(t=s.props).onMove)||void 0===r?void 0:r.call(t,o,n,null===d||void 0===d?void 0:d.$root);"function"===typeof(null===i||void 0===i?void 0:i.then)?i.then((()=>{s.opreations.move(o,n,d.$root)})):s.opreations.move(o,n,d.$root)}}}),u.props.title||u.title)},El=e=>{var l=e.pos,r=(0,f.Z)(e,sl),o=ml(),i=hl(null===o||void 0===o?void 0:o.helper.formatPos(l)),s=(0,v.useField)();return o?"editable"!==o.field.pattern?null:n.createElement($.Z,{title:s.content||"\u786e\u5b9a\u8981\u5220\u9664\u5f53\u524d\u9762\u6570\u636e\u5417?",okText:"\u662f\u7684",cancelText:"\u6211\u518d\u60f3\u60f3",onConfirm:e=>{var l,r,t;if(null===e||void 0===e||null===(l=e.stopPropagation)||void 0===l||l.call(e),(null===s||void 0===s||!s.disabled)&&i){var n=i.$pos,a=null===(r=(t=o.props).onRemove)||void 0===r?void 0:r.call(t,n,i.$record,i.$lookup,null===i||void 0===i?void 0:i.$root);"function"===typeof(null===a||void 0===a?void 0:a.then)?a.then((()=>{o.opreations.remove(n,i.$root)})):o.opreations.remove(n,i.$root)}}},n.createElement(a.Z,(0,t.Z)({type:"link",size:"small",icon:n.createElement(We.Z,null)},r),s.props.title||s.title)):null},kl=e=>{var l,r=e.pos,o=e.factory,i=e.method,s=(0,f.Z)(e,dl),d=ml(),u=hl(null===d||void 0===d?void 0:d.helper.formatPos(r)),c=(0,v.useField)();return d?"editable"!==d.field.pattern?null:null!==u&&void 0!==u&&null!==(l=u.$extra)&&void 0!==l&&l.expanded?n.createElement(a.Z,(0,t.Z)({type:"dashed",size:"small",icon:n.createElement(Qe.Z,null)},s,{onClick:e=>{var l,r;if(e.stopPropagation(),(null===c||void 0===c||!c.disabled)&&u){var t=u.$pos,n=null===(l=d.props)||void 0===l||null===(r=l.onAdd)||void 0===r?void 0:r.call(l,t,u.$record,u.$lookup,u.$root);"function"===typeof(null===n||void 0===n?void 0:n.then)?n.then((e=>{setTimeout((()=>{d.opreations.append(t,u.$root,null!==e&&void 0!==e?e:null===o||void 0===o?void 0:o(u.$record),i)}))})):d.opreations.append(t,u.$root,(null===o||void 0===o?void 0:o(u.$record))||{},i)}}}),c.props.title||c.title):null:null},xl=e=>{var l=e.pos,r=e.clone,o=(0,f.Z)(e,ul),i=ml(),s=hl(null===i||void 0===i?void 0:i.helper.formatPos(l)),d=(0,v.useField)();return i?"editable"!==i.field.pattern?null:n.createElement(a.Z,(0,t.Z)({type:"link",size:"small",icon:n.createElement(Ge.Z,null)},o,{onClick:e=>{var l,t;if(e.stopPropagation(),(null===d||void 0===d||!d.disabled)&&s){var o=s.$pos,n=null===(l=i.props)||void 0===l||null===(t=l.onCopy)||void 0===t?void 0:t.call(l,o,s.$record,s.$lookup,s.$root);"function"===typeof(null===n||void 0===n?void 0:n.then)?n.then((e=>{i.opreations.copy(o,null!==e&&void 0!==e?e:null===r||void 0===r?void 0:r(s.$record),s.$root)})):i.opreations.copy(o,(null===r||void 0===r?void 0:r(s.$record))||{},s.$root)}}}),d.props.title||d.title):null};gl.Node=yl,gl.Move=jl,gl.Pos=bl,gl.Remove=El,gl.Append=kl,gl.Copy=xl,gl.useNode=ol,gl.useTree=ml,gl.usePos=fl,gl.usePosNode=hl,gl.useRoot=tl,gl.mixin=e=>(e.Node=gl.Node,e.Move=gl.Move,e.Pos=gl.Pos,e.Remove=gl.Remove,e.Append=gl.Append,e.Copy=gl.Copy,e.useNode=gl.useNode,e.useTree=gl.useTree,e.usePos=gl.usePos,e.usePosNode=gl.usePosNode,e.useRoot=gl.useRoot,e);var Zl=gl,Rl=["loadData","treeData","checkedKeys"],Cl=["value","layout","onMove","onRemove","onAdd","onCopy"],wl=(e,l)=>e.value===l.value,_l={title:"label",key:"value",children:"children"},$l=(e,l,r,t)=>{if(r(e,l))return[];var o=t||[];if(!Array.isArray(e.children))return o;for(var n=0;n<e.children.length;n++){var a=e.children[n];if(void 0!==a){if(r(a,l))return o.unshift(n),o;var i=$l(a,l,r,o);if(i.length>0)return o.unshift(n),o}}return o},Sl=(e,l)=>{var r=[];return l.reduce(((e,l)=>{var t,o=null===e||void 0===e||null===(t=e.children)||void 0===t?void 0:t[l];return r.push(o),o}),e),r},Pl=()=>{var e=Zl.useTree(),l=Zl.useNode();return n.createElement(v.RecursionField,{name:null===l||void 0===l?void 0:l.$path,schema:null===e||void 0===e?void 0:e.schema.items})},Nl=(0,v.observer)((e=>{var l,r,o=e.loadData,a=e.treeData,i=(e.checkedKeys,(0,f.Z)(e,Rl)),s=Zl.useRoot(),d=Zl.useTree(),c=(0,n.useMemo)((()=>(0,u.Z)((0,u.Z)({},_l),e.fieldNames)),[e.fieldNames]),v=(0,n.useRef)({loadData:o}),m=(0,n.useCallback)((e=>{if(v.current.loadData){var l=$l(null===s||void 0===s?void 0:s.$root,e,wl),r=Sl(null===s||void 0===s?void 0:s.$root,l),t=r[r.length-1];return t.loading=!0,v.current.loadData(r).then((e=>{null===d||void 0===d||d.opreations.appendChildren(l,null===s||void 0===s?void 0:s.$root,e)})).finally((()=>{t.loading=!1}))}}),[null===s||void 0===s?void 0:s.$root,null===d||void 0===d?void 0:d.opreations]),p=l=>{var r,t=l.dragNode,o=l.node,n=t.pos.split("-").map(Number);n.shift();var a=o.pos.split("-").map(Number);a.shift();var i=null===(r=e.onDrop)||void 0===r?void 0:r.call(e,n,a);"function"===typeof(null===i||void 0===i?void 0:i.then)?i.then((()=>{null===d||void 0===d||d.opreations.move(n,a,null===s||void 0===s?void 0:s.$root)})):null===d||void 0===d||d.opreations.move(n,a,null===s||void 0===s?void 0:s.$root),console.log("onDrop",{before:n,after:a})};return n.createElement(Je.Z,(0,t.Z)({showLine:!0,blockNode:!0,className:"".concat(e.className," fireformily-tree")},i,{expandedKeys:null!==(l=null===s||void 0===s?void 0:s.$root.expandedKeys)&&void 0!==l?l:[],onExpand:e=>{s&&(s.$root.expandedKeys=e)},selectedKeys:null!==(r=null===s||void 0===s?void 0:s.$root.selectedKeys)&&void 0!==r?r:[],onSelect:e=>{s&&(s.$root.selectedKeys=e)},checkedKeys:null===s||void 0===s?void 0:s.$root.checkedKeys,onCheck:(e,l)=>{s&&(s.$root.checkedKeys=e,s.$root.halfCheckedKeys=l.halfCheckedKeys)},titleRender:e=>{if(!s)return null;var l=$l(s.$root,e,wl);return 0===l.length?null:n.createElement(Zl.Node,{pos:l,getExtra:l=>{var r,t,o,n,a=l,i=a.expandedKeys,s=void 0===i?[]:i,d=a.selectedKeys,u=void 0===d?[]:d,v=a.checkedKeys,m=void 0===v?[]:v,p=a.halfCheckedKeys,f=void 0===p?[]:p,h=e[c.key];return{checked:null===m||void 0===m||null===(r=m.includes)||void 0===r?void 0:r.call(m,h),halfChecked:null===f||void 0===f||null===(t=f.includes)||void 0===t?void 0:t.call(f,h),selecteds:null===u||void 0===u||null===(o=u.includes)||void 0===o?void 0:o.call(u,h),expanded:null===s||void 0===s||null===(n=s.includes)||void 0===n?void 0:n.call(s,h)}}},n.createElement(Pl,null))},fieldNames:_l,treeData:a,onDrop:p,loadData:m}))})),zl=(0,v.observer)((e=>{var l,r,o=(0,v.useField)(),a=(0,v.useFieldSchema)(),i=(0,n.useMemo)((()=>(0,u.Z)((0,u.Z)({},_l),e.fieldNames)),[e.fieldNames]),s=o.value,d=e.value,c=e.layout,h=e.onMove,g=e.onRemove,y=e.onAdd,b=e.onCopy,j=(0,f.Z)(e,Cl),E=(e,l)=>{var r=null===h||void 0===h?void 0:h(e,l,o.value);return r},k=(0,n.useRef)({loadData:e.loadData});(0,n.useEffect)((()=>{o.value.children||k.current.loadData&&k.current.loadData([]).then((e=>{o.setState((l=>{l.value.children=e}))}))}),[]),(0,n.useEffect)((()=>{o&&o.setState((e=>{var l,r,t,o,n;e.value.children=null!==(l=null===d||void 0===d?void 0:d.children)&&void 0!==l?l:[],e.value.expandKeys=null!==(r=null===d||void 0===d?void 0:d.expanedKeys)&&void 0!==r?r:[],e.value.checkedKeys=null!==(t=null===d||void 0===d?void 0:d.checkedKeys)&&void 0!==t?t:[],e.value.halfCheckedKeys=null!==(o=null===d||void 0===d?void 0:d.halfCheckedKeys)&&void 0!==o?o:[],e.value.selectedKeys=null!==(n=null===d||void 0===d?void 0:d.selectedKeys)&&void 0!==n?n:[]}))}),[o]);var x=null!==(l=null===(r=s.children)||void 0===r?void 0:r.slice())&&void 0!==l?l:[];return s.__dirty&&(x=(0,p.raw)(s).children.slice(),s.__dirty=!1),n.createElement(n.Fragment,null,n.createElement(Zl,{getRoot:()=>o.value,fieldNames:i,onAdd:y,onRemove:g,onCopy:b,onMove:h},n.createElement(v.RecursionField,{schema:a,onlyRenderSelf:!0}),n.createElement(m.Z,(0,t.Z)({size:"small"},c),n.createElement(Nl,(0,t.Z)({},j,{onDrop:E,treeData:x})),n.createElement(v.RecursionField,{schema:a,name:"",onlyRenderProperties:!0}))))}));Zl.mixin(zl);var Fl=e=>Ce[e%Ce.length],Al=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],l={emap:e.reduce(((e,l)=>(e[l.value]=l.label,e[l.label]=l.value,e)),{}),colors:e.reduce(((e,l,r)=>{var t=l.color||Fl(r);return e[l.value]=t,e[l.label]=t,e}),{}),options:e.map(((e,l)=>(0,u.Z)((0,u.Z)({},e),{},{key:e.value,color:e.color||Fl(l)})))};return l},Kl=function(e){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";return e.map((e=>({key:e[r],label:e[l],value:e[r],color:e.color})))},Ol=function(e){var l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"label",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"value";return Al(e.map((e=>({key:e[r],label:e[l],value:e[r],color:e.color}))))},Dl=(0,p.observable)({}),Tl=Dl,Ml={},ql={},Il=(e,l)=>{Ml[e]=()=>l(Kl).then((l=>{var r=Ol(l);return Dl[e]=r,Dl[e]}))},Ll=e=>{(0,c.cW)("*",(e=>{var l,r=null===(l=e.data)||void 0===l?void 0:l.dict;if(r){var t=e.data.dictNoCache;if(!Dl[r]&&!Ml[r])throw new Error("\u8bcd\u5178 ".concat(r," \u7684\u52a0\u8f7d\u5668\u4e0d\u5b58\u5728!"),r);if(!0!==t&&Dl[r])e.setState((e=>{e.dataSource=Dl[r].options,e.componentProps&&(e.componentProps.options=e.dataSource)}));else if(r&&Ml[r]){e.setState((e=>{e.loading=!0}));var o=ql[r]||Ml[r]();ql[r]=o.then((l=>(e.setState((e=>{e.dataSource=l.options,e.componentProps&&(e.componentProps.options=e.dataSource),e.loading=!1})),l))).catch((l=>{throw e.setState((e=>{e.loading=!1})),l}))}}})),(0,c.lC)("*",(e=>{var l,r,t=null===(l=e.data)||void 0===l?void 0:l.dict;if(t){var o=(e,l)=>{var r=Array.isArray(e)?e[0]:e,t=Array.isArray(l)?l[0]:l;return r===t},n=e.readPretty||e.readOnly;n?o(e.component,Pe)||(e.data.__origin_component=e.component,e.setComponent(Pe)):null!==(r=e.data)&&void 0!==r&&r.__origin_component&&!o(e.data.__origin_component,e.component)&&e.setComponent(e.data.__origin_component)}}))},Bl=e=>{var l="function"===typeof e?e():e;return(0,p.isSupportObservable)(l)?(0,p.observable)(l):(console.log("WARNING!!, not support obserable"),l)},Ul=e=>{var l=(0,n.useMemo)((()=>Bl(null!==e&&void 0!==e?e:{})),[]);return l}},46700:function(e,l,r){var t={"./af":60757,"./af.js":60757,"./ar":22490,"./ar-dz":15633,"./ar-dz.js":15633,"./ar-kw":12602,"./ar-kw.js":12602,"./ar-ly":34074,"./ar-ly.js":34074,"./ar-ma":98317,"./ar-ma.js":98317,"./ar-sa":29752,"./ar-sa.js":29752,"./ar-tn":66061,"./ar-tn.js":66061,"./ar.js":22490,"./az":92136,"./az.js":92136,"./be":57080,"./be.js":57080,"./bg":48473,"./bg.js":48473,"./bm":38856,"./bm.js":38856,"./bn":17146,"./bn-bd":5223,"./bn-bd.js":5223,"./bn.js":17146,"./bo":30594,"./bo.js":30594,"./br":48831,"./br.js":48831,"./bs":67530,"./bs.js":67530,"./ca":82766,"./ca.js":82766,"./cs":3830,"./cs.js":3830,"./cv":74487,"./cv.js":74487,"./cy":60146,"./cy.js":60146,"./da":66186,"./da.js":66186,"./de":86621,"./de-at":72833,"./de-at.js":72833,"./de-ch":78113,"./de-ch.js":78113,"./de.js":86621,"./dv":32345,"./dv.js":32345,"./el":69981,"./el.js":69981,"./en-au":16498,"./en-au.js":16498,"./en-ca":94555,"./en-ca.js":94555,"./en-gb":93204,"./en-gb.js":93204,"./en-ie":89988,"./en-ie.js":89988,"./en-il":3777,"./en-il.js":3777,"./en-in":23231,"./en-in.js":23231,"./en-nz":30533,"./en-nz.js":30533,"./en-sg":73034,"./en-sg.js":73034,"./eo":21496,"./eo.js":21496,"./es":65678,"./es-do":76879,"./es-do.js":76879,"./es-mx":55440,"./es-mx.js":55440,"./es-us":66963,"./es-us.js":66963,"./es.js":65678,"./et":41003,"./et.js":41003,"./eu":90013,"./eu.js":90013,"./fa":29692,"./fa.js":29692,"./fi":68102,"./fi.js":68102,"./fil":22918,"./fil.js":22918,"./fo":87496,"./fo.js":87496,"./fr":67474,"./fr-ca":1853,"./fr-ca.js":1853,"./fr-ch":44675,"./fr-ch.js":44675,"./fr.js":67474,"./fy":97061,"./fy.js":97061,"./ga":96867,"./ga.js":96867,"./gd":18364,"./gd.js":18364,"./gl":96383,"./gl.js":96383,"./gom-deva":64220,"./gom-deva.js":64220,"./gom-latn":87202,"./gom-latn.js":87202,"./gu":25249,"./gu.js":25249,"./he":96022,"./he.js":96022,"./hi":65395,"./hi.js":65395,"./hr":29361,"./hr.js":29361,"./hu":93797,"./hu.js":93797,"./hy-am":85874,"./hy-am.js":85874,"./id":77084,"./id.js":77084,"./is":12592,"./is.js":12592,"./it":54296,"./it-ch":35272,"./it-ch.js":35272,"./it.js":54296,"./ja":17620,"./ja.js":17620,"./jv":46898,"./jv.js":46898,"./ka":62752,"./ka.js":62752,"./kk":5632,"./kk.js":5632,"./km":16667,"./km.js":16667,"./kn":88963,"./kn.js":88963,"./ko":35953,"./ko.js":35953,"./ku":72004,"./ku.js":72004,"./ky":71803,"./ky.js":71803,"./lb":12835,"./lb.js":12835,"./lo":98185,"./lo.js":98185,"./lt":40538,"./lt.js":40538,"./lv":74582,"./lv.js":74582,"./me":23663,"./me.js":23663,"./mi":35840,"./mi.js":35840,"./mk":88701,"./mk.js":88701,"./ml":2209,"./ml.js":2209,"./mn":38391,"./mn.js":38391,"./mr":14481,"./mr.js":14481,"./ms":20135,"./ms-my":29977,"./ms-my.js":29977,"./ms.js":20135,"./mt":81029,"./mt.js":81029,"./my":27402,"./my.js":27402,"./nb":18929,"./nb.js":18929,"./ne":29030,"./ne.js":29030,"./nl":18208,"./nl-be":92510,"./nl-be.js":92510,"./nl.js":18208,"./nn":46456,"./nn.js":46456,"./oc-lnc":98952,"./oc-lnc.js":98952,"./pa-in":9734,"./pa-in.js":9734,"./pl":67042,"./pl.js":67042,"./pt":97351,"./pt-br":63673,"./pt-br.js":63673,"./pt.js":97351,"./ro":62080,"./ro.js":62080,"./ru":78025,"./ru.js":78025,"./sd":51922,"./sd.js":51922,"./se":82651,"./se.js":82651,"./si":16258,"./si.js":16258,"./sk":23337,"./sk.js":23337,"./sl":8683,"./sl.js":8683,"./sq":10119,"./sq.js":10119,"./sr":72660,"./sr-cyrl":9322,"./sr-cyrl.js":9322,"./sr.js":72660,"./ss":33350,"./ss.js":33350,"./sv":19607,"./sv.js":19607,"./sw":16552,"./sw.js":16552,"./ta":25391,"./ta.js":25391,"./te":78149,"./te.js":78149,"./tet":27113,"./tet.js":27113,"./tg":4503,"./tg.js":4503,"./th":33665,"./th.js":33665,"./tk":68356,"./tk.js":68356,"./tl-ph":62917,"./tl-ph.js":62917,"./tlh":42669,"./tlh.js":42669,"./tr":34573,"./tr.js":34573,"./tzl":16022,"./tzl.js":16022,"./tzm":881,"./tzm-latn":30897,"./tzm-latn.js":30897,"./tzm.js":881,"./ug-cn":45472,"./ug-cn.js":45472,"./uk":1300,"./uk.js":1300,"./ur":96961,"./ur.js":96961,"./uz":51699,"./uz-latn":87476,"./uz-latn.js":87476,"./uz.js":51699,"./vi":91544,"./vi.js":91544,"./x-pseudo":22086,"./x-pseudo.js":22086,"./yo":85911,"./yo.js":85911,"./zh-cn":38098,"./zh-cn.js":38098,"./zh-hk":53720,"./zh-hk.js":53720,"./zh-mo":10794,"./zh-mo.js":10794,"./zh-tw":36087,"./zh-tw.js":36087};function o(e){var l=n(e);return r(l)}function n(e){if(!r.o(t,e)){var l=new Error("Cannot find module '"+e+"'");throw l.code="MODULE_NOT_FOUND",l}return t[e]}o.keys=function(){return Object.keys(t)},o.resolve=n,e.exports=o,o.id=46700}}]);