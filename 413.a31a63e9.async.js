"use strict";(self.webpackChunkfireformily=self.webpackChunkfireformily||[]).push([[413],{55413:function(Yr,Ce,S){S.r(Ce),S.d(Ce,{Dict:function(){return he},ImageView:function(){return nn},Linkage:function(){return sn},Loading:function(){return Re},LongText:function(){return gn},PopActions:function(){return q},Popup:function(){return J},QueryForm:function(){return An},QueryList:function(){return kn},QueryTable:function(){return V},Suggestion:function(){return ar},TreeBase:function(){return I},TreeNodes:function(){return Ke},colors:function(){return ve},dict:function(){return Ur},dictEffects:function(){return Wr},eqeq:function(){return Ye},getTreeHelper:function(){return Le},isColorStatus:function(){return fe},registerDictLoader:function(){return Gr},takeTake:function(){return je},useExpressionScope:function(){return te},useLive:function(){return Xr}});var x=S(67294),We=S(97857),C=S.n(We),be={success:"green",processing:"blue",error:"red",warning:"gold",default:"#fafafa"},ve=C()({length:11,0:"magenta",1:"green",2:"cyan",3:"geekblue",4:"purple",5:"red",6:"orange",7:"lime",8:"blue",9:"volcano",10:"gold",magenta:"magenta",green:"green",cyan:"cyan",geekblue:"geekblue",purple:"purple",red:"red",orange:"orange",lime:"lime",blue:"blue",volcano:"volcano",gold:"gold"},be),fe=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return!!be[e]},Je=S(52677),G=S.n(Je),je=function(e){return function(n){return{get key(){return n&&n[e.key]},set key(r){G()(n)==="object"&&(n[e.key]=r)},get title(){return n&&n[e.title]},set title(r){G()(n)==="object"&&(n[e.title]=r)},get children(){return n&&n[e.children]},set children(r){G()(n)==="object"&&(n[e.children]=r)}}}},Xe=Object.prototype.hasOwnProperty;function $e(l,e){return l===e?l!==0||e!==0||1/l===1/e:l!==l&&e!==e}function Ye(l,e){if($e(l,e))return!0;if(G()(l)!=="object"||l===null||G()(e)!=="object"||e===null)return!1;var n=Object.keys(l),r=Object.keys(e);if(n.length!==r.length)return!1;for(var o=0;o<n.length;o++)if(!Xe.call(e,n[o])||!$e(l[n[o]],e[n[o]]))return!1;return!0}var D=S(26713),qe=S(63922),_e=S(20550),s=S(85893),he=function(e){var n=e.strict,r=e.type,o=e.value,a=e.options,i=(0,x.useMemo)(function(){if(!Array.isArray(a))return[];var t=Array.isArray(o)?o.map(function(c){return a.find(function(v){return n?v.value===c:v.value==c})}):[a.find(function(c){return n?c.value===o:c.value==o})];return t.filter(Boolean)},[a,n,o]);return(0,s.jsx)(D.Z,{size:"small",children:i.map(function(t){return r==="badge"?(0,s.jsx)(qe.Z,{status:fe(t==null?void 0:t.color)?t==null?void 0:t.color:void 0,color:fe(t==null?void 0:t.color)||t==null?void 0:t.color,text:t==null?void 0:t.label},t==null?void 0:t.key):r==="tag"?(0,s.jsx)(_e.Z,{color:t==null?void 0:t.color,children:t==null?void 0:t.label},t==null?void 0:t.key):t==null?void 0:t.label})})},Pe=S(63917),en={width:"60px",height:"60px",objectFit:"contain"},nn=function(e){var n=e.value,r=e.style,o=(0,x.useMemo)(function(){var i=Array.isArray(n)?n:[n];return i.filter(Boolean)},[n]),a=(0,x.useMemo)(function(){return C()(C()({},en),r)},[r]);return(0,s.jsx)(x.Fragment,{children:(0,s.jsx)(Pe.Z.PreviewGroup,{children:o.map(function(i){return(0,s.jsx)(Pe.Z,{style:a,src:i,preview:!0},i)})})})},rn=S(19632),Q=S.n(rn),on=S(13769),z=S.n(on),P=S(27420),w=S(85667),re=S(3930),tn=S(45239),ln=["value","loadAll","labelInValue","disabled","multiple","onChange","loadData"],an={width:"100%"},un=function(e,n){return e&&Array.isArray(n)?n.length>0?n==null?void 0:n.reduceRight(function(r,o){return r?(o.children=r,o.__init=!0,[o]):(o.isLeaf=!0,[o])},null):[]:[]},dn=function(e){var n=e.loadData,r=e.loadAll,o=e.value,a=e.labelInValue,i=(0,re.Z)(r||n),t=(0,x.useMemo)(function(){return(0,w.observable)({inited:!1,loading:!1,options:un(a,o),load:function(h){var g,m,p=h[h.length-1];p&&(p.loading=!0,t.loading=!0,(g=i.current)===null||g===void 0||(m=g.call(i,h).then(function(y){y?p.children=y.map(function(b){return C()({isLeaf:!1},b)}):p.isLeaf=!0}))===null||m===void 0||m.finally(function(){p.loading=!1,t.loading=!1}))}})},[]);if(!t.inited&&!t.loading){var c,v,f;t.loading=!0,t.inited=!0;var u=Array.isArray(o)?a?o:o.map(function(d){return{value:d}}):[];(c=i.current)===null||c===void 0||(v=c.call(i,u))===null||v===void 0||(f=v.then(function(d){d&&(t.options=d.map(function(h){return C()({isLeaf:!1},h)}))}))===null||f===void 0||f.finally(function(){t.loading=!1})}return t},sn=function(e){var n=e.value,r=e.loadAll,o=e.labelInValue,a=e.disabled,i=e.multiple,t=e.onChange,c=e.loadData,v=z()(e,ln),f=dn(e),u=(0,x.useCallback)(function(h,g){return o?t==null?void 0:t(g):t==null?void 0:t(h)},[o,t]),d=function h(g){return Array.isArray(g)?g.map(function(m){return Array.isArray(m)?h(m):m.label?m.value:m}):[]};return(0,s.jsx)(P.Observer,{children:function(){return(0,s.jsx)(tn.Z,C()(C()({disabled:a,multiple:i,changeOnSelect:!0},v),{},{loading:f.loading,value:d(n),style:e.style||an,options:Q()(f.options),loadData:r?void 0:f.load,onChange:u}))}})},cn=S(5574),L=S.n(cn),vn=S(19491),fn={position:"absolute",transition:"all ease 0.2s"},Re=function(e){var n=(0,x.useState)(!0),r=L()(n,2),o=r[0],a=r[1];return(0,x.useLayoutEffect)(function(){setTimeout(function(){a(!1)},67)},[]),(0,s.jsx)(vn.Z,{style:C()(C()({},fn),{},{display:o?"":"none"}),paragraph:!0,loading:!0})},Se=S(49420),hn=Se.Z.Paragraph,gn=function(e){return(0,s.jsx)(hn,C()(C()({copyable:!0,ellipsis:!0},e),{},{style:{marginBottom:0},children:e.value}))},Ae=S(63463),Z=S(71577),mn=function(){},oe=function(e){var n,r,o,a,i=e.field,t=e.loading,c=e.open,v=e.scope,f=(v==null?void 0:v.$index)!==void 0,u=t?mn:c;return i.display!=="visible"?null:(0,s.jsx)(Z.Z,{onClick:u,size:f?"small":(r=i.componentProps)===null||r===void 0?void 0:r.size,type:f?"link":(a=i.componentProps)===null||a===void 0?void 0:a.type,children:i==null?void 0:i.title})},W=S(99619),pn=S(44620),te=function(){var e=(0,P.useField)(),n=(0,P.useExpressionScope)();return e.record?C()({$record:e.record,$lookup:e.records,$records:e.records,$index:e.index},n):n},yn=["pageSize","current"],ke=function(){},Te=(0,x.createContext)(null),xn=x.memo(function(l){var e,n=(0,P.useForm)(),r=(0,x.useRef)({}),o=(0,pn.Z)(),a=L()(o,2),i=a[0],t=a[1],c=(0,x.useRef)(!1),v=te(),f=(0,x.useRef)(!1),u=(0,x.useRef)({service:l.service}),d=(0,x.useCallback)(function(y){var b=u.current.service;if(r.current=y,l.syncUrl){var j=y||{pagination:{}},R=j.pagination,$=R.pageSize,A=R.current,N=j.params;t(function(k){var T=C()({},k);return Object.keys(T).forEach(function(F){T[F]=void 0}),C()(C()(C()({},T),N),{},{pageSize:$,current:A})})}return p.current._loading=!0,b(C()(C()({},y),{},{scope:v})).then(function(k){var T=k.list,F=k.total,B=p.current._address.table,H=n.query(B).take();return B?(H.setState(function(M){(0,w.batch)(function(){M.value=T,M.data=M.data||{},M.data.pagination=M.data.pagination||{},M.data.pagination.total=F})}),{list:T,total:F}):{list:[],total:0}}).finally(function(){p.current._loading=!1})},[n,l.syncUrl,v,t]),h=(0,x.useCallback)(function(){var y=p.current._address.query,b=n.query(y).take(),j=p.current._address.table,R=n.query(j).take();return d(C()({params:b==null?void 0:b.value},R==null?void 0:R.data))},[d,n]),g=(0,x.useCallback)(function(){var y=r.current;return d(y)},[d]),m=(0,x.useCallback)(function(){var y,b,j=p==null||(y=p.current)===null||y===void 0||(b=y._address)===null||b===void 0?void 0:b.table;if(j){var R;(R=n.query(j).take())===null||R===void 0||R.setState(function($){(0,w.batch)(function(){$.data=$.data||{},$.data.pagination=$.data.pagination||{},$.data.pagination.current=1})})}return h()},[h,n]),p=(0,x.useRef)((0,w.observable)(C()(C()({},l),{},{service:l.service?d:void 0,syncUrl:l.syncUrl,pageSize:l.pageSize,_refresh:l.service?g:void 0,_reset:l.service?m:void 0,_trigger:l.service?h:void 0,_address:{query:"",table:""},_scope:v,_cofnig:{_size:(e=l.size)!==null&&e!==void 0?e:"default",_columns:[],_showColumns:[],_selectedRows:[],_selectedRowKeys:[],_selectClear:ke,_selectReverse:ke}})));return(0,x.useEffect)(function(){if(l.syncUrl&&!c.current){var y=p.current._address,b=i||{},j=b.pageSize,R=b.current,$=z()(b,yn);if(j&&y!==null&&y!==void 0&&y.table){var A;(A=n.query(y.table).take())===null||A===void 0||A.setState(function(k){(0,w.batch)(function(){k.data=k.data||{},k.data.pagination=k.data.pagination||{},k.data.pagination.pageSize=Number(i.pageSize),k.data.pagination.current=Number(i.current)})})}if($&&Object.keys($).length>0&&y!==null&&y!==void 0&&y.query){var N;(N=n.query(y.query).take())===null||N===void 0||N.setState(function(k){k.value=C()(C()({},k.value),$)})}y!=null&&y.table&&setTimeout(function(){c.current=!0},0)}},[n,l.syncUrl,i]),(0,x.useEffect)(function(){if(u.current.service){var y=(0,w.autorun)(function(){var b,j=(b=p.current._address)===null||b===void 0?void 0:b.table;f.current===!1&&j&&p.current.autoload!==!1&&setTimeout(function(){h(),f.current=!0})});return function(){y()}}},[h]),(0,x.useEffect)(function(){var y=p.current;y.autoload!==l.autoload&&(y.autoload=l.autoload),y.filterRemote!==l.filterRemote&&(y.filterRemote=l.filterRemote),y.sortRemote!==l.sortRemote&&(y.sortRemote=l.sortRemote),y.syncUrl!==l.syncUrl&&(y.syncUrl=l.syncUrl)},[l.autoload,l.filterRemote,l.sortRemote,l.syncUrl]),(0,s.jsx)(Te.Provider,{value:p.current,children:(0,s.jsx)(P.ExpressionScope,{value:{get $query(){var y,b=(y=p.current._address)===null||y===void 0?void 0:y.query;return b?n.query(b).take().value:null},get $list(){var y,b=(y=p.current._address)===null||y===void 0?void 0:y.table;return b?n.query(b).take().value:null}},children:l.children})})}),K=function(){var e=(0,x.useContext)(Te);return e},Cn=function(){return new Promise(function(e){setTimeout(function(){e("")},0)})},bn=function(e){return(0,w.isObservable)(e)?e:Array.isArray(e)?Q()(e):C()({},e)},Y=function(){return Promise.resolve({})},jn=function(e){return Promise.resolve(C()({},e))},ie=function(){var e,n=(0,P.useField)(),r=te(),o=K(),a=n==null||(e=n.componentProps)===null||e===void 0?void 0:e.actions,i=(0,x.useRef)({open:!1,reset:!1,submit:!1}),t=(0,P.useFieldSchema)(),c=(0,re.Z)(a||{}),v=(0,x.useState)(!1),f=L()(v,2),u=f[0],d=f[1],h=(0,x.useState)(!1),g=L()(h,2),m=g[0],p=g[1],y=(0,x.useCallback)(function(){if(!n.disabled&&!m&&!i.current.open){i.current.open=!0;var N=c.current.load||jn;return p(!0),N(r).then(function(k){n.setState(function(T){T.value=bn(k)}),d(!0)}).finally(function(){i.current.open=!1,p(!1)})}},[n,m,c,r]),b=(0,x.useCallback)(function(){if(!n.disabled&&!(m||!u)&&!i.current.reset){i.current.reset=!0;var N=(0,W.isVoidField)(n)?Y:function(){return n.reset()},k=c.current.cancel||Y;return N().then(function(){return k(r)}).then(function(){d(!1)}).finally(function(){i.current.reset=!1,p(!1)})}},[n,m,c,r,u]),j=(0,x.useCallback)(function(){if(!n.disabled&&!(m||!u)&&!i.current.submit){i.current.submit=!0;var N=(0,W.isVoidField)(n)?Y:function(){return n.submit()},k=(0,W.isVoidField)(n)?Y:function(){return n.reset()},T=c.current.submit||Y;return N().then(function(F){return T(F,r)}).then(function(){return d(!1),Cn().then(k)}).finally(function(){var F;p(!1),i.current.submit=!1,o==null||(F=o._refresh)===null||F===void 0||F.call(o)})}},[o,n,m,c,r,u]),R=(0,x.useMemo)(function(){return n.content?n.content:null},[n.content]),$=(0,x.useMemo)(function(){return t?(0,s.jsx)(x.Fragment,{children:(0,s.jsx)(P.RecursionField,{schema:t})}):null},[t]),A=(0,x.useMemo)(function(){return(0,s.jsxs)(D.Z,{style:{display:"flex",justifyContent:"flex-end",marginBottom:"16px"},children:[(0,s.jsx)(Z.Z,{loading:m,onClick:b,children:"\u53D6\u6D88"}),(0,s.jsx)(Z.Z,{loading:m,onClick:j,type:"primary",children:"\u786E\u5B9A"})]})},[m,b,j]);return{submit:j,field:n,reset:b,open:y,visible:u,loading:m,body:$,header:R,footer:A,scope:r}},$n=function(e){var n=ie(),r=n.body,o=n.field,a=n.footer,i=n.header,t=n.loading,c=n.scope,v=n.open,f=n.reset,u=n.visible;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Ae.Z,C()(C()({width:"68.88%",closable:!0,keyboard:!0},e),{},{title:e.title||o.title,onClose:function(h){var g;f(),e==null||(g=e.onClose)===null||g===void 0||g.call(e,h)},open:u,afterOpenChange:function(h){var g;h||f(),e==null||(g=e.afterOpenChange)===null||g===void 0||g.call(e,h)},footer:a,children:[i,r]})),(0,s.jsx)(oe,{open:v,field:o,loading:t,scope:c})]})},Ne=S(85402),Fe=function(e){var n=ie(),r=n.visible,o=n.body,a=n.field,i=n.scope,t=n.footer,c=n.header,v=n.loading,f=n.open,u=n.reset;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Ne.Z,C()(C()({maskClosable:!1,keyboard:!1,closable:!1,width:"68.88%"},e),{},{afterClose:function(){var h;e==null||(h=e.afterClose)===null||h===void 0||h.call(e),u()},open:r,title:e.title||a.title,footer:t,children:[c,o]})),(0,s.jsx)(oe,{open:f,field:a,loading:v,scope:i})]})},ge=S(65360),Pn=function(e){var n=ie(),r=n.body,o=n.field,a=n.header,i=n.loading,t=n.scope,c=n.open,v=n.reset,f=n.submit,u=n.visible;return(0,s.jsx)(ge.Z,C()(C()({},e),{},{title:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h4",{children:o.title||a}),o.title?null:a,r]}),cancelButtonProps:{loading:i},okButtonProps:{loading:i},onCancel:v,onConfirm:f,open:u,onOpenChange:function(h){var g;h||v(),e==null||(g=e.onOpenChange)===null||g===void 0||g.call(e,h)},children:(0,s.jsx)(oe,{open:c,field:o,loading:i,scope:t})}))},Oe=S(55241),Rn=function(e){var n=ie(),r=n.body,o=n.field,a=n.scope,i=n.footer,t=n.header,c=n.loading,v=n.open,f=n.reset,u=n.visible;return console.log("--popovver",{visible:u}),(0,s.jsx)(Oe.Z,C()(C()({},e),{},{trigger:"click",title:e.title||o.title,content:(0,s.jsxs)(s.Fragment,{children:[t,r,i]}),open:u,onOpenChange:function(h){var g;e==null||(g=e.onOpenChange)===null||g===void 0||g.call(e,h),h||f()},children:(0,s.jsx)(oe,{open:v,field:o,loading:c,scope:a})}))},q=Fe;q.Drawer=$n,q.Modal=Fe,q.Popconfirm=Pn,q.Popover=Rn;var E=S(9168),Sn=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.maxRows||1,r=(0,x.useMemo)(function(){return E.FormGrid.createFormGrid({maxColumns:e.maxColumns||4,maxWidth:e.maxWidth||320,maxRows:n,shouldVisible:function(c,v){return c.index===r.childSize-1||v.maxRows===1/0?!0:c.shadowRow<n+1}})},[e.maxColumns,e.maxWidth,n]),o=r.fullnessLastColumn?r.shadowRows-1:r.shadowRows,a=o<=n?void 0:r.maxRows===1/0,i=function(){r.maxRows===1/0?r.maxRows=n:r.maxRows=1/0};return{grid:r,expanded:a,toggle:i}},An=(0,P.observer)(function(l){var e,n=l.resetText,r=l.submitText,o=(0,P.useField)(),a=(0,P.useForm)(),i=Sn(l.grid),t=i.grid,c=i.expanded,v=i.toggle,f=K(),u=f||{},d=u._loading,h=u._refresh,g=u._reset,m=u._trigger,p=function(){if(!d)if(f){var R;a.reset((R=f._address)===null||R===void 0?void 0:R.query,{forceClear:!0,validate:!1}).then(function(){g==null||g()})}else setTimeout(function(){g==null||g()})},y=function(){if(!d)return m==null?void 0:m()};(0,x.useEffect)(function(){f&&(f._address.query=o.address.toString())},[f,o==null||(e=o.address)===null||e===void 0?void 0:e.toString()]);var b=function(){return(0,s.jsxs)(E.FormButtonGroup,{align:"right",style:{width:"100%",marginBottom:"22px",display:"flex",justifyContent:"flex-end"},children:[c!==void 0?(0,s.jsx)(Z.Z,{type:"link",onClick:function($){$.preventDefault(),v()},children:c?"\u6536\u8D77":"\u5C55\u5F00"}):null,(0,s.jsx)(Z.Z,{onClick:p,children:n||"\u91CD\u7F6E"}),(0,s.jsx)(Z.Z,{onClick:y,type:"primary",children:r||"\u67E5\u8BE2"})]})};return l.children?(0,s.jsxs)(E.FormGrid,C()(C()({},t),{},{grid:t,children:[l.children,(0,s.jsx)(E.FormGrid.GridColumn,{gridSpan:-1,style:{display:"flex",justifyContent:"space-between"},children:b()})]})):null}),kn=function(e){return(0,s.jsx)(xn,C()(C()({},e),{},{children:e.children}))},Tn=S(31194),Nn=S(86296),Fn=function l(e){var n=e.items||e,r=n.reduceProperties(function(o,a){var i;return o||(a["x-component"]==="QueryTable"?null:((i=a["x-component"])===null||i===void 0?void 0:i.indexOf("SortHandle"))>-1?a:a.properties||a.items?l(a):o)});return r},me=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Column"))>-1},we=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Operations"))>-1},On=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Actions"))>-1},Ze=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Addition"))>-1},wn=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Expand"))>-1},Zn=function(e){var n;return((n=e["x-component"])===null||n===void 0?void 0:n.indexOf("Selection"))>-1},Dn=function(){var e=(0,P.useFieldSchema)();return e.reduceProperties(function(n,r,o){return Ze(r)?(0,s.jsx)(P.RecursionField,{schema:r,name:o}):n},null)},En=S(5085),Ln=S.n(En),le=S(3567),pe=S(13013),ye=E.ArrayBase,In=function(e,n){if(!e)return[];var r=[],o=(0,le.isArr)(e)?e:[e];return o.reduce(function(a,i){var t=n(i);return t?a.concat(t):a},r)},Bn=function(e,n,r,o){var a=Object.keys(n.properties||{}).length,i=e.maxItems||2,t=a>i?n.mapProperties(function(c,v,f){return f<i?null:{key:f,label:(0,s.jsx)(P.RecursionField,{schema:c,name:"".concat(r,".").concat(v)})}}).filter(Boolean):void 0;return(0,s.jsx)(ye.Item,{index:r,record:function(){var v;return o==null||(v=o.value)===null||v===void 0?void 0:v[r]},children:(0,s.jsxs)(D.Z,{size:"small",children:[n.mapProperties(function(c,v,f){return f>=i?null:(0,s.jsx)(P.RecursionField,{schema:c,name:"".concat(r,".").concat(v)},"".concat(r,".").concat(v))}),a>i?(0,s.jsx)(pe.Z,{menu:{items:t},children:(0,s.jsx)("a",{children:(0,s.jsx)(Ln(),{})})}):null]})})},Mn=function(e){var n=K(),r=(0,P.useFieldSchema)(),o=function f(u){if(me(u)||we(u)||Ze(u)){var d,h,g;if(!((d=u["x-component-props"])!==null&&d!==void 0&&d.dataIndex)&&!u.name)return[];var m=((h=u["x-component-props"])===null||h===void 0?void 0:h.dataIndex)||u.name,p=e.query(e.address.concat(m)).take(),y=(p==null||(g=p.component)===null||g===void 0?void 0:g[1])||u["x-component-props"]||{},b=(p==null?void 0:p.display)||u["x-display"];return[{name:m,display:b,field:p,schema:u,columnProps:y}]}else return u.properties?u.reduceProperties(function(j,R){return j.concat(f(R))},[]):[]};if(!r)throw new Error("can not found schema object");var a=In(r.items,o),i=r.reduceProperties(function(f,u){return On(u)?u:f},null),t=a.reduce(function(f,u,d){var h,g=u.name,m=u.columnProps,p=u.schema,y=u.display;return n&&n._cofnig&&(n==null?void 0:n._cofnig._showColumns.length)>0&&(n==null||(h=n._cofnig._showColumns)===null||h===void 0?void 0:h.findIndex(function(b){return b===g}))===-1||y==="hidden"?f:we(p)?f.concat(C()(C()({fixed:!0},m),{},{key:d,dataIndex:g,render:function(j,R){var $,A=e==null||($=e.value)===null||$===void 0?void 0:$.indexOf(R);return Bn(m,p,A,e)}})):me(p)?f.concat(C()(C()({},m),{},{filters:Array.isArray(m.filters)?m.filters:void 0,key:g,dataIndex:g,render:function(j,R){var $,A=e==null||($=e.value)===null||$===void 0?void 0:$.indexOf(R),N=(0,s.jsx)(ye.Item,{index:A,record:function(){var T;return e==null||(T=e.value)===null||T===void 0?void 0:T[A]},children:(0,s.jsx)(P.RecursionField,{schema:p,name:A,onlyRenderProperties:!0})});return N}})):f},[]);if(i){var c=C()(C()({},i["x-component-props"]),{},{key:"_act_",title:i.title,dataIndex:"\u64CD\u4F5C",render:function(u,d){var h,g=e==null||(h=e.value)===null||h===void 0?void 0:h.indexOf(d),m=(0,s.jsx)(ye.Item,{index:g,record:function(){var y;return e==null||(y=e.value)===null||y===void 0?void 0:y[g]},children:(0,s.jsx)(P.RecursionField,{schema:i,name:g,onlyRenderProperties:!0})});return m}});t.push(c)}var v=function(){return a.map(function(u,d){return me(u.schema)?(0,s.jsx)(P.RecursionField,{schema:u.schema,name:u.name,onlyRenderSelf:!0},d):null})};return[t,v]},zn=function l(e){var n;return((n=e.parent)===null||n===void 0?void 0:n["x-component"])==="QueryList"?e.parent:e.parent?l(e.parent):null},Kn=function l(e){if(e){var n=e.reduceProperties(function(r,o){if(r)return r;var a=o["x-component"]==="QueryTable.Selection";return a?!0:o.properties?l(o):!1},!1);return n}else return!1},Vn=function(e,n){var r=(0,P.useField)(),o=K(),a=(0,P.useFieldSchema)(),i=Kn(zn(a)),t=(0,x.useRef)(e);(0,x.useEffect)(function(){t.current=e},[e]);var c=(0,x.useCallback)(function(){var v,f;if(o&&!(!i&&!n)){var u=o._cofnig,d=(0,w.observable)(C()(C()({type:"checkbox"},n),{},{selectedRows:(v=u._selectedRows)!==null&&v!==void 0?v:[],selectedRowKeys:(f=u._selectedRowKeys)!==null&&f!==void 0?f:[],clear:function(){u._selectedRowKeys=[],u._selectedRows=[]},reverse:function(){var g=r.value,m=g.filter(function(y){return!u._selectedRows.find(function(b){return b===y})}),p=m.map(function(y){var b=typeof t.current=="function"?t.current(y):y[t.current];return b});u._selectedRowKeys=p,u._selectedRows=m},onChange:function(g,m){u._selectedRowKeys=g,u._selectedRows=m}}));return u._selectReverse=d.reverse,u._selectClear=d.clear,d}},[o,r.value,i,n]);return c()},De=S(27049),Hn=function(){var e=K(),n=(0,P.useFieldSchema)(),r=n.reduceProperties(function(o,a,i){return Zn(a)&&o.push((0,s.jsx)(P.RecordScope,{getRecord:function(){var c,v,f,u;return{selectedRowKeys:(c=e==null||(v=e._cofnig)===null||v===void 0?void 0:v._selectedRowKeys)!==null&&c!==void 0?c:[],selectedRows:(f=e==null||(u=e._cofnig)===null||u===void 0?void 0:u._selectedRows)!==null&&f!==void 0?f:[]}},getIndex:function(){return-1},children:(0,s.jsx)(D.Z,{split:(0,s.jsx)(De.Z,{type:"vertical"}),children:a.mapProperties(function(t,c){return(0,s.jsx)(P.RecursionField,{schema:t,name:c},c)})})},i)),o},[]);return r.length>0?r:null},Qn=S(8683),Ee=S(95742),Un=(0,Ee.W8)(function(l){return(0,s.jsx)("tr",C()({},l))}),Gn=(0,Ee.JN)(function(l){return(0,s.jsx)("tbody",C()({},l))}),Wn=function(e){return(0,s.jsx)(Un,C()({index:e["data-row-sort-index"]||0},e))},Jn=function(e,n){var r=document.body.querySelector(".".concat(n,"-sort-helper"));if(r){var o=e.querySelectorAll("td");requestAnimationFrame(function(){r.querySelectorAll("td").forEach(function(a,i){o[i]&&(a.style.width=getComputedStyle(o[i]).width)})})}},Xn=function(e){var n=(0,Qn.usePrefixCls)("formily-array-table"),r=(0,P.useField)(),o=(0,P.useFieldSchema)(),a=te(),i=(0,x.useMemo)(function(){return Fn(o)},[o]),t=K(),c=(0,x.useCallback)(function(f){return(0,s.jsx)(Gn,C()({useDragHandle:!0,lockAxis:"y",helperClass:"".concat(n,"-sort-helper"),helperContainer:function(){var d;return(d=e.current)===null||d===void 0?void 0:d.querySelector("tbody")},onSortStart:function(d){var h=d.node;Jn(h,n)},onSortEnd:function(d){var h,g=d.oldIndex,m=d.newIndex,p=(h=r.componentProps)===null||h===void 0?void 0:h.onSort;if(typeof p=="function"){var y=p(g,m,(0,w.toJS)(r.value),a);y instanceof Promise?(r.setLoading(!0),r.move(g,m),y.then(function(b){if(b){var j;t==null||(j=t._refresh)===null||j===void 0||j.call(t)}r.setLoading(!1)}).catch(function(){r.move(m,g),r.setLoading(!1)})):r.move(g,m)}else r.move(g,m)}},f))},[t,r,e,n,a]),v={wrapper:i?c:void 0,row:i?Wn:void 0};return v},Yn=E.ArrayBase,qn=function(e){var n=(0,P.useField)(),r=(0,P.useFieldSchema)(),o=r.reduceProperties(function(i,t,c){return wn(t)?t:i},null),a=(0,x.useMemo)(function(){if(o)return C()(C()({},e),{},{expandedRowRender:function(t,c,v,f){return(0,s.jsx)(Yn.Item,{index:c,record:function(){var d;return n==null||(d=n.value)===null||d===void 0?void 0:d[c]},children:(0,s.jsx)(P.RecursionField,{schema:o,name:c,onlyRenderProperties:!0})},f?"expand-".concat(new Date):"hidden-".concat(c))}})},[n==null?void 0:n.value,o,e]);return a},_n=S(7339),er=S(24887),nr=S(15026),rr=S(32808),or=S(14670),tr=(0,P.observer)(function(l){var e=(0,P.useField)(),n=K();if(!n)return null;var r=n==null?void 0:n._cofnig,o=[{label:"\u9ED8\u8BA4",key:"default"},{label:"\u4E2D\u7B49",key:"middle"},{label:"\u7D27\u51D1",key:"small"}],a=Hn(),i=r._columns.map(function(t){var c=r._showColumns.findIndex(function(u){return u===t.key}),v=c>-1,f=function(d){d.stopPropagation(),d.preventDefault(),v?r._showColumns.splice(c,1):r._showColumns.push(t.key)};return{label:(0,s.jsxs)(D.Z,{onClick:f,children:[(0,s.jsx)(rr.Z,{checked:v}),t.label]}),key:t.key}});return(0,s.jsxs)(D.Z,{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[(0,s.jsxs)(D.Z,{size:"small",children:[(0,s.jsx)(Se.Z.Title,{level:5,children:e.title||l.title}),r._selectedRowKeys.length?(0,s.jsx)(or.Z,{style:{padding:"3px 4px"},type:"info",message:(0,s.jsxs)(D.Z,{size:"small",split:(0,s.jsx)(De.Z,{type:"vertical"}),children:[(0,s.jsxs)(Z.Z,{type:"text",size:"small",children:["\u9009\u4E2D ",r._selectedRowKeys.length," \u9879"]}),(0,s.jsx)(Z.Z,{size:"small",onClick:function(){var c;(c=r._selectClear)===null||c===void 0||c.call(r)},type:"link",children:"\u53D6\u6D88\u9009\u62E9"}),(0,s.jsx)(Z.Z,{size:"small",onClick:function(){var c;(c=r._selectReverse)===null||c===void 0||c.call(r)},type:"link",children:"\u53CD\u5411\u9009\u62E9"}),a]})}):null]}),(0,s.jsxs)(D.Z,{size:"small",children:[(0,s.jsx)(D.Z,{children:l.children}),(0,s.jsxs)(D.Z,{size:"large",children:[(0,s.jsx)(_n.Z,{onClick:function(){var c;n==null||(c=n._refresh)===null||c===void 0||c.call(n)},loop:n==null?void 0:n._loading}),(0,s.jsx)(pe.Z,{menu:{onClick:function(c){r._size=c.key},defaultValue:r._size,items:o},children:(0,s.jsx)(er.Z,{})},"size"),(0,s.jsx)(pe.Z,{menu:{items:i},children:(0,s.jsx)(nr.Z,{})},"columns")]})]})]})}),xe,qr=function(e,n){return"\u7B2C ".concat(n[-1],"-").concat(n[1]," \u6761, \u5171 ").concat(e," \u6761\u6570\u636E")},V=(0,P.observer)(function(l){var e,n,r=(0,x.useRef)(null),o=(0,Tn.F)("formily-array-table"),a=K(),i=(0,P.useField)(),t=Array.isArray(i.value)?i.value.slice():[],c=function(j){return t.indexOf(j)},v=Xn(r),f=Mn(i),u=L()(f,2),d=u[0],h=u[1],g=Dn(),m=qn(l.expandable),p=Vn(l.rowKey||c,l.rowSelection);(0,x.useEffect)(function(){a&&(a._address.table=i.address.toString())},[a,i==null||(e=i.address)===null||e===void 0?void 0:e.toString()]),(0,x.useEffect)(function(){a!=null&&a.service&&i&&!i.data&&(i.data={},i.data.pagination={current:1,pageSize:a.pageSize||10})},[a,i,l.pagination]),(0,x.useEffect)(function(){if(a){var b=a._cofnig;d.forEach(function(j){b._columns.findIndex(function(R){return R.key===j.dataIndex})===-1&&(b._columns.push({label:j.title,key:j.dataIndex}),b._showColumns.push(j.dataIndex))})}},[d,a]);var y=function(){var j,R=i==null||(j=i.data)===null||j===void 0?void 0:j.pagination,$=l.pagination||{},A=R?R.pageSize>R.total?!1:C()(C()(C()({},$),R),{},{showTotal:function(k,T){return"\u7B2C ".concat(T[0],"-").concat(T[1]," \u6761, \u5171 ").concat(k," \u6761\u6570\u636E")}}):!1;return A};return(0,s.jsx)("div",{ref:r,className:o,children:(0,s.jsxs)(E.ArrayBase,{children:[(0,s.jsx)(Nn.Z,C()(C()({rowKey:c},l),{},{size:a==null||(n=a._cofnig)===null||n===void 0?void 0:n._size,expandable:m,rowSelection:p,onRow:function(j,R){var $,A=(l==null||($=l.onRow)===null||$===void 0?void 0:$.call(l,j,R))||{};return A["data-row-sort-index"]=R,A},columns:d,loading:l.loading||(a==null?void 0:a._loading),components:{body:v},dataSource:t,pagination:y(),onChange:function(j,R,$,A){if(i.setData({pagination:j,filters:R,sorter:$,extra:A}),A.action==="paginate"){var N;a==null||(N=a._trigger)===null||N===void 0||N.call(a)}else if(A.action==="sort"&&a!==null&&a!==void 0&&a.sortRemote){var k;a==null||(k=a._trigger)===null||k===void 0||k.call(a)}else if(A.action==="filter"&&a!==null&&a!==void 0&&a.filterRemote){var T;a==null||(T=a._trigger)===null||T===void 0||T.call(a)}}})),h(),g]})})});E.ArrayBase===null||E.ArrayBase===void 0||(xe=E.ArrayBase.mixin)===null||xe===void 0||xe.call(E.ArrayBase,V),V.Operations=function(){return(0,s.jsx)(x.Fragment,{})},V.Actions=function(){return(0,s.jsx)(x.Fragment,{})},V.Column=function(){return(0,s.jsx)(x.Fragment,{})},V.Expand=function(){return(0,s.jsx)(x.Fragment,{})},V.Selection=function(){return(0,s.jsx)(x.Fragment,{})},V.Titlebar=tr;var ir=S(34041),lr=function(e,n){var r=n;return e&&(r=Array.isArray(n)?n:[]),r},ar=function(e){var n=(0,x.useState)([]),r=L()(n,2),o=r[0],a=r[1],i=(0,x.useState)(lr(e.multiple,e.value)),t=L()(i,2),c=t[0],v=t[1],f=(0,x.useState)(!1),u=L()(f,2),d=u[0],h=u[1],g=(0,x.useRef)(e.suggest);(0,x.useEffect)(function(){e.suggest&&(g.current=e.suggest)},[e.suggest]);var m=(0,x.useRef)(null),p=(0,x.useRef)(0),y=(0,x.useCallback)(function(R){var $=++p.current;m.current&&clearTimeout(m.current),m.current=setTimeout(function(){var A,N;h(!0),g.current||h(!1),(A=g.current)===null||A===void 0||(N=A.call(g,R))===null||N===void 0||N.then(function(k){$<p.current||a(k)}).finally(function(){h(!1)})},200)},[]),b=function($){g.current&&($?y(C()(C()({},e.params),{},{kw:$})):a([]))},j=function($){var A;v($),(A=e.onChange)===null||A===void 0||A.call(e,$)};return(0,s.jsx)(ir.Z,{showSearch:!0,loading:d,value:c,labelInValue:e.labelInValue,mode:e.multiple?"multiple":void 0,placeholder:e.placeholder,style:e.style,disabled:e.disabled,defaultActiveFirstOption:!1,showArrow:!1,filterOption:!1,onSearch:b,onChange:j,options:o})},ur=S(45211),dr=S(98261),sr=S(82061),cr=S(51042),vr=S(85175),fr=S(53416),hr=function(e,n){return JSON.parse(JSON.stringify(e,function(r,o){return r===n?"__CLONE_".concat((0,fr.x0)()):o}))},gr=function l(e,n){var r,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],a=arguments.length>3?arguments[3]:void 0,i=a||{};return(r=n(e).children)===null||r===void 0||r.forEach(function(t,c){var v=[].concat(Q()(o),[c]);i[n(t).key]={parentKey:n(e).key,index:c,pos:v},n(t).children&&l(t,n,v,i)}),i},Le=function(e,n,r){var o=je(n),a=r!=null?r:function(f){return hr(f,n.key)},i={pos:{},mapper:{}},t=function(){console.log("computed start");var u=performance.now();i.mapper=gr(e.root,o),i.pos=Object.keys(i.mapper).reduce(function(h,g){var m=i.mapper[g].pos;return h[g]=m,h},i.pos);var d=performance.now();console.log("computed end",d-u)},c=function(){t(),o(e.root).children=Q()(o(e.root).children)};t();var v={get dataSource(){var f=o(e.root).children;return f},take:function(u){return o(u)},getPos:function(u){if(u===e.root)return[];var d=o(u).key;return d?(i.pos[d]||t(),i.pos[d]):null},posToParents:function(u){var d=e.root;return u.reduce(function(h,g){var m,p=(m=o(d).children)===null||m===void 0?void 0:m[g];return h.push(p),d=p,h},[])},posToPath:function(u){if(u){var d=u.reduce(function(h,g){return h?"".concat(h,".").concat(n.children,".").concat(g):"".concat(n.children,".").concat(g)},"");return d}},getNodeAtPos:function(u){if(u===null)return null;var d=u.reduce(function(h,g){var m;return(m=o(h).children)===null||m===void 0?void 0:m[g]},e.root);return d},append:function(u){for(var d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"push",h=arguments.length,g=new Array(h>2?h-2:0),m=2;m<h;m++)g[m-2]=arguments[m];var p=this.getNodeAtPos(u);p&&(0,w.batch)(function(){if(!o(p).children||d==="replace")o(p).children=g;else if(d==="push"){var y;(y=o(p).children)===null||y===void 0||y.push.apply(y,g)}else{var b;(b=o(p).children)===null||b===void 0||b.unshift.apply(b,g)}c()})},copy:function(u,d){var h=this.getNodeAtPos(u),g=d!=null?d:a(h),m=u.slice(0,u.length-1),p=this.getNodeAtPos(m);!p||!h||(0,w.batch)(function(){var y,b=u[u.length-1]+1;(y=o(p).children)===null||y===void 0||y.splice(b,0,g),c()})},remove:function(u){var d=u.slice(0,u.length-1),h=u[u.length-1];if(h!=null){var g=this.getNodeAtPos(d);g&&(0,w.batch)(function(){var m;(m=o(g).children)===null||m===void 0||m.splice(h,1),c()})}},move:function(u,d){var h=this;if(JSON.stringify(u)!==JSON.stringify(d)){var g=u.length===d.length&&u.slice(0,u.length-1).join("_")===d.slice(0,d.length-1).join("_");(0,w.batch)(function(){if(g){var m,p,y=h.getNodeAtPos(u.slice(0,u.length-1)),b=u[u.length-1],j=d[d.length-1],R=(m=o(y).children)===null||m===void 0?void 0:m.splice(b,1)[0];(p=o(y).children)===null||p===void 0||p.splice(j,0,R)}else{var $,A,N,k,T=h.getNodeAtPos(u.slice(0,u.length-1)),F=($=o(T).children)===null||$===void 0||(A=$.splice)===null||A===void 0?void 0:A.call($,u[u.length-1],1)[0];if(console.log("move before pick",F),!F)return;var B=h.getNodeAtPos(d.slice(0,d.length-1));(N=o(B).children)===null||N===void 0||(k=N.splice)===null||k===void 0||k.call(N,d[d.length-1],0,F)}c()})}}};return v},mr={title:"label",key:"value",children:"children"},Ie=(0,x.createContext)(null),Be=(0,x.createContext)(null),ae=function(){var e=(0,x.useContext)(Ie);return e},_=function(){var e=ae();return e==null?void 0:e.$helper},U=function(e){var n=ae(),r=(0,x.useContext)(Be);if(e){var o=Array.isArray(e)?n==null?void 0:n.$helper.take(n==null?void 0:n.$helper.getNodeAtPos(e)).key:e;return n==null?void 0:n.$refs.get(o)}return r},pr=function(e){var n=e.children,r=e.getRoot,o=(0,x.useRef)({getRoot:r}),a=(0,x.useMemo)(function(){var i=new Map,t=C()(C()({},mr),e.fieldNames),c=Le({root:o.current.getRoot()},t),v={get $root(){var f=o.current.getRoot();return f},get $helper(){return c},get $fieldNames(){return t},get $refs(){return i}};return v},[]);return(0,s.jsx)(P.ExpressionScope,{value:a,children:(0,s.jsx)(Ie.Provider,{value:a,children:n})})},yr=function(e){var n=ae(),r=e.getPos,o=e.getNode,a=e.children,i=(0,x.useRef)({getPos:r,getNode:o,disposer:function(){}}),t=(0,x.useMemo)(function(){if(!n)return null;var c=n.$refs,v=n.$helper,f={get $root(){return n.$root},get $pos(){return i.current.getPos(n.$root)},get $path(){return v.posToPath(this.$pos)},get $extra(){var d;return(d=e.getExtra)===null||d===void 0?void 0:d.call(e,this.$root)},get $record(){var d=typeof i.current.getNode=="function"?i.current.getNode(n.$root):v.getNodeAtPos(this.$pos),h=d===this.$root;return h?d:G()(d)==="object"?(0,le.lazyMerge)(d,{get $lookup(){return f.$lookup},get $index(){return f.$index},get $pos(){return f.$pos}}):d},get $lookup(){var d,h,g=((d=this.$pos)===null||d===void 0?void 0:d.slice(0,this.$pos.length-1))||[],m=v.getNodeAtPos(g),p=m?(h=n.$refs.get(v.take(m).key))===null||h===void 0?void 0:h.$record:void 0;return p!=null?p:this.$root},get $records(){var d;return(d=v.take(this.$lookup).children)!==null&&d!==void 0?d:[]},get $parents(){var d=Array.isArray(this.$pos)?Q()(this.$pos):[],h=[];return d.reduce(function(g,m){var p;h.push(g);var y=(p=v.take(g).children)===null||p===void 0?void 0:p[m];return y},this.$root),h},get $index(){return this.$pos?this.$pos[this.$pos.length-1]:-1}},u=v.take(f.$record).key;return c.set(u,f),f},[]);return(0,s.jsx)(Be.Provider,{value:t,children:(0,s.jsx)(P.ExpressionScope,{value:t,children:a})})},xr=["pos"],Cr=["pos"],br=["pos","factory","method"],jr=["pos","clone"],Me=(0,x.createContext)(null),$r=(0,x.createContext)(null),ee=function(){return(0,x.useContext)(Me)},Pr=function(e){return Array.isArray(e)?e:typeof e=="string"?e.split("-").map(Number).filter(function(n){return!Number.isNaN(n)}):[]},Rr=function(e){var n=U();return e?Pr(e):n==null?void 0:n.$pos},O=function(e){var n=e.fieldNames,r=e.getRoot,o=e.children,a=(0,P.useField)(),i=(0,P.useFieldSchema)(),t=(0,x.useMemo)(function(){return{field:a,schema:i,props:e}},[a,e,i]);return(0,s.jsx)(Me.Provider,{value:t,children:(0,s.jsx)(pr,{fieldNames:n,getRoot:r,children:o})})},Sr=function(e){var n=e.pos,r=e.children,o=e.getNode,a=e.getExtra;return(0,s.jsx)(yr,{getPos:n,getNode:o,getExtra:a,children:(0,s.jsx)($r.Provider,{value:e,children:r})})},Ar=function(e){var n,r=U(e.pos);return(r==null?void 0:r.$record)===(r==null?void 0:r.$root)?null:(0,s.jsxs)("span",C()(C()({},e),{},{children:["#",r==null||(n=r.$pos)===null||n===void 0?void 0:n.join("-")," "]}))},kr=function(e){var n,r,o=e.pos,a=z()(e,xr),i=ee(),t=U(o),c=(0,P.useField)(),v=_();if((t==null?void 0:t.$record)===(t==null?void 0:t.$root)||!i||i.field.pattern!=="editable")return null;var f=e.to==="up"&&(t==null?void 0:t.$index)===0||e.to==="down"&&(t==null?void 0:t.$index)===((n=t==null||(r=t.$records)===null||r===void 0?void 0:r.length)!==null&&n!==void 0?n:-1)-1;return f?null:(0,s.jsx)(Z.Z,C()(C()({type:"link",size:"small",icon:(0,s.jsx)(dr.Z,{rotate:e.to==="up"?0:180})},a),{},{onClick:function(d){var h,g;if(d.stopPropagation(),!(c!=null&&c.disabled)&&t){var m=t.$pos,p=Q()(m),y=m[m.length-1];p[p.length-1]=e.to==="down"?y+1:Math.max(y-1,0);var b=(h=(g=i.props).onMove)===null||h===void 0?void 0:h.call(g,m,p,t==null?void 0:t.$root);typeof(b==null?void 0:b.then)=="function"?b.then(function(){v==null||v.move(m,p)}):v==null||v.move(m,p)}},children:c.props.title||c.title}))},Tr=function(e){var n=e.pos,r=z()(e,Cr),o=ee(),a=U(n),i=(0,P.useField)(),t=_();return!o||o.field.pattern!=="editable"||(a==null?void 0:a.$record)===(a==null?void 0:a.$root)?null:(0,s.jsx)(ge.Z,{title:i.content||"\u786E\u5B9A\u8981\u5220\u9664\u5F53\u524D\u6570\u636E\u5417?",okText:"\u662F\u7684",cancelText:"\u6211\u518D\u60F3\u60F3",onConfirm:function(v){var f,u,d;if(v==null||(f=v.stopPropagation)===null||f===void 0||f.call(v),!(i!=null&&i.disabled)&&a){var h=a.$pos,g=(u=(d=o.props).onRemove)===null||u===void 0?void 0:u.call(d,h,a.$record,a.$lookup,a==null?void 0:a.$root);typeof(g==null?void 0:g.then)=="function"?g.then(function(){t==null||t.remove(h)}):t==null||t.remove(h)}},children:(0,s.jsx)(Z.Z,C()(C()({onClick:function(v){return v.stopPropagation()},type:"link",size:"small",icon:(0,s.jsx)(sr.Z,{})},r),{},{children:i.props.title||i.title}))})},Nr=function(e){var n=e.pos,r=e.factory,o=e.method,a=z()(e,br),i=ee(),t=U(n),c=(0,P.useField)(),v=_();return!i||i.field.pattern!=="editable"?null:(0,s.jsx)(Z.Z,C()(C()({type:"dashed",size:"small",icon:(0,s.jsx)(cr.Z,{})},a),{},{onClick:function(u){var d,h;if(u.stopPropagation(),!(c!=null&&c.disabled)&&t){var g=t.$pos,m=(d=i.props)===null||d===void 0||(h=d.onAdd)===null||h===void 0?void 0:h.call(d,g,t.$record,t.$lookup,t.$root);typeof(m==null?void 0:m.then)=="function"?m.then(function(p){setTimeout(function(){v==null||v.append(g,o,p!=null?p:r==null?void 0:r(t.$record))})}):v==null||v.append(g,o,(r==null?void 0:r(t.$record))||{})}},children:c.props.title||c.title}))},Fr=function(e){var n=e.pos,r=e.clone,o=z()(e,jr),a=ee(),i=U(n),t=(0,P.useField)(),c=_();return!a||a.field.pattern!=="editable"||(i==null?void 0:i.$record)===(i==null?void 0:i.$root)?null:(0,s.jsx)(Z.Z,C()(C()({type:"link",size:"small",icon:(0,s.jsx)(vr.Z,{})},o),{},{onClick:function(f){var u,d;if(f.stopPropagation(),!(t!=null&&t.disabled)&&i){var h=i.$pos,g=(u=a.props)===null||u===void 0||(d=u.onCopy)===null||d===void 0?void 0:d.call(u,h,i.$record,i.$lookup,i.$root);if(typeof(g==null?void 0:g.then)=="function")g.then(function(p){var y=p!=null?p:r==null?void 0:r(i.$record);c==null||c.copy(h,y)});else{var m=r==null?void 0:r(i.$record);c==null||c.copy(h,m)}}},children:t.props.title||t.title}))};O.Node=Sr,O.Move=kr,O.Pos=Ar,O.Remove=Tr,O.Append=Nr,O.Copy=Fr,O.useNode=U,O.useTree=ee,O.usePos=Rr,O.useRoot=ae,O.useHelper=_,O.mixin=function(l){return l.Node=O.Node,l.Move=O.Move,l.Pos=O.Pos,l.Remove=O.Remove,l.Append=O.Append,l.Copy=O.Copy,l.useNode=O.useNode,l.useTree=O.useTree,l.usePos=O.usePos,l.useRoot=O.useRoot,l.useHelper=O.useHelper,l};var I=O,Or=["loadAll","loadData","checkedKeys","fieldNames","children"],wr=["onAdd","value","fieldNames","onCopy","onMove","onRemove","layout"],Zr={title:"label",key:"value",children:"children"},ze=function(){var e=(0,x.useRef)(null);return(0,x.useEffect)(function(){for(var n,r=(n=e.current)===null||n===void 0?void 0:n.parentElement,o=null;r&&!o;)o=/ant-tree-treenode/.test(r.getAttribute("class")||"")?r:null,r=r.parentElement;o&&o.setAttribute("style","display: none")},[]),(0,s.jsx)("span",{ref:e,children:"hack"})},Dr=function(e){var n=I.useTree(),r=I.useHelper(),o=I.useNode(),a=(r==null?void 0:r.take(o==null?void 0:o.$record).key)!==e.dataKey;return a?(0,s.jsx)(ze,{}):(0,s.jsx)("div",{onClick:function(t){var c;(t==null||(c=t.target)===null||c===void 0?void 0:c.tagName)==="INPUT"&&t.stopPropagation()},children:(0,s.jsx)(P.RecursionField,{name:o==null?void 0:o.$path,schema:n==null?void 0:n.schema.items})})},Er=(0,P.observer)(function(l){var e,n,r=l.loadAll,o=l.loadData,a=l.checkedKeys,i=l.fieldNames,t=l.children,c=z()(l,Or),v=I.useHelper(),f=(0,P.useField)(),u=(0,re.Z)({loadData:o,loadAll:r,onDrop:l.onDrop}),d=(0,x.useCallback)(function(g){if(!u.current.loadAll&&u.current.loadData&&v){var m=v.getPos(g),p=v.posToParents(m),y=p[p.length-1];return y.loading=!0,u.current.loadData(p).then(function(b){v.append.apply(v,[m,"replace"].concat(Q()(b)))}).finally(function(){y.loading=!1})}},[v,u]),h=(0,x.useCallback)(function(g){var m,p,y=g.dragNode,b=g.node,j=y.pos.split("-").map(Number);j.shift();var R=b.pos.split("-").map(Number);R.shift();var $=(m=(p=u.current).onDrop)===null||m===void 0?void 0:m.call(p,j,R);typeof($==null?void 0:$.then)=="function"?$.then(function(){v==null||v.move(j,R)}):v==null||v.move(j,R)},[v,u]);return(0,s.jsxs)(x.Fragment,{children:[(0,s.jsx)(Re,{}),(0,s.jsx)(ur.Z,C()(C()({showLine:!0,blockNode:!0},c),{},{className:"".concat(l.className," fireformily-tree"),titleRender:function(m){if(!v)return null;var p=v.getPos(m);return p?(0,s.jsx)(I.Node,{pos:function(){return v.getPos(m)},getExtra:function(){var b,j,R,$,A=v.take(m).key,N=f.value,k=N,T=k.selectedKeys,F=T===void 0?[]:T,B=k.checkedKeys,H=B===void 0?[]:B,M=k.halfCheckedKeys,se=M===void 0?[]:M,Ge=k.expandedKeys,ce=Ge===void 0?[]:Ge;return{checked:H==null||(b=H.includes)===null||b===void 0?void 0:b.call(H,A),halfChecked:se==null||(j=se.includes)===null||j===void 0?void 0:j.call(se,A),selecteds:F==null||(R=F.includes)===null||R===void 0?void 0:R.call(F,A),expanded:ce==null||($=ce.includes)===null||$===void 0?void 0:$.call(ce,A)}},children:(0,s.jsx)(Dr,{dataKey:v.take(m).key})},v.take(m).key):(0,s.jsx)(ze,{})},expandedKeys:(e=f.value.expandedKeys)!==null&&e!==void 0?e:[],onExpand:function(m){f.setState(function(p){p.value.expandedKeys=m})},selectedKeys:(n=f.value.selectedKeys)!==null&&n!==void 0?n:[],onSelect:function(m){f.setState(function(p){p.value.selectedKeys=m})},checkedKeys:f.value.checkedKeys,onCheck:function(m,p){if(f.value){var y=Array.isArray(m)?m:m.checked,b=Array.isArray(m)?p.halfCheckedKeys:m.halfChecked;f.setState(function(j){j.value.checkedKeys=y,j.value.halfCheckedKeys=b!=null?b:[]})}},fieldNames:i,treeData:v==null?void 0:v.dataSource,onDrop:h,loadData:o&&!r?d:void 0}))]})}),Ke=function(e){var n=e.onAdd,r=e.value,o=e.fieldNames,a=e.onCopy,i=e.onMove,t=e.onRemove,c=e.layout,v=z()(e,wr),f=(0,P.useField)(),u=(0,P.useFieldSchema)(),d=(0,x.useMemo)(function(){return C()(C()({},Zr),o)},[o]),h=(0,re.Z)({loader:e.loadAll||e.loadData});return(0,x.useEffect)(function(){h.current.loader&&(f.selfModified||h.current.loader([]).then(function(g){console.log("reloaddd"),f.setState(function(m){m.value.children=g})}))},[]),(0,s.jsx)(x.Fragment,{children:(0,s.jsxs)(I,{getRoot:function(){return f.value},fieldNames:d,onAdd:n,onRemove:t,onCopy:a,onMove:i,children:[(0,s.jsx)(P.RecursionField,{schema:u,onlyRenderSelf:!0}),(0,s.jsxs)(D.Z,C()(C()({size:"small"},c),{},{children:[(0,s.jsxs)(D.Z,{direction:"vertical",size:"small",children:[(0,s.jsx)(I.Node,{getNode:function(){return f.value},pos:function(){return[]},children:(0,s.jsx)(P.RecursionField,{schema:u.items,onlyRenderProperties:!0,name:""})}),(0,s.jsx)(Er,C()(C()({},v),{},{fieldNames:d}))]}),(0,s.jsx)(P.RecursionField,{schema:u,name:"",onlyRenderProperties:!0})]}))]})})};I.mixin(Ke);var Lr=function(){},ne=function(e){var n,r=e.field,o=e.loading,a=e.open,i=o?Lr:a;return r.display!=="visible"?null:(0,s.jsx)(Z.Z,C()(C()({size:"small",type:"link"},(n=r.componentProps)===null||n===void 0?void 0:n.openButton),{},{onClick:i,children:r==null?void 0:r.title}))},Ir=function(){return new Promise(function(e){setTimeout(function(){e("")},0)})},Ve=function(){return Promise.resolve({})},ue=function(){var e,n,r=(0,P.useField)(),o=(0,P.useForm)(),a=(0,P.useFieldSchema)(),i=(0,x.useContext)(P.SchemaComponentsContext),t=(0,x.useContext)(P.SchemaOptionsContext),c=(0,x.useMemo)(function(){var T;return(0,W.createForm)(r==null||(T=r.componentProps)===null||T===void 0?void 0:T.formOptions)},[r==null||(e=r.componentProps)===null||e===void 0?void 0:e.formOptions]),v=(0,x.useRef)((r==null||(n=r.componentProps)===null||n===void 0?void 0:n.actions)||{}),f=(0,x.useRef)({open:!1,reset:!1,submit:!1}),u=(0,x.useState)(!1),d=L()(u,2),h=d[0],g=d[1],m=(0,x.useState)(!1),p=L()(m,2),y=p[0],b=p[1],j=(0,x.useCallback)(function(){if(!r.disabled&&!y&&!f.current.open){f.current.open=!0;var T=v.current.load||function(){return Promise.resolve((0,le.clone)(r.record))};return b(!0),T(r.record,r,o,c).then(function(F){c.setValues((0,le.clone)(F)),g(!0)}).finally(function(){f.current.open=!1,b(!1)})}},[r,y,v]),R=(0,x.useCallback)(function(){if(!r.disabled&&!(y||!h)&&!f.current.reset){f.current.reset=!0;var T=c.reset,F=v.current.cancel||Ve;return T().then(function(){return F(r.record,r,o,c)}).then(function(){g(!1)}).finally(function(){f.current.reset=!1})}},[r,y,v,h]),$=(0,x.useCallback)(function(){if(!r.disabled&&!(y||!h)&&!f.current.submit){f.current.submit=!0;var T=c.submit,F=c.reset,B=v.current.submit||Ve;return T().then(function(H){return B(H,r,o,c)}).then(function(){return g(!1),Ir().then(F)}).finally(function(){f.current.submit=!1})}},[r,y,v,h]),A=(0,x.useMemo)(function(){return r.content?r.content:null},[r.content]),N=(0,x.useMemo)(function(){var T=(0,P.createSchemaField)(C()({components:C()(C()({},t.components),i)},t));return a?(0,s.jsx)(P.FormProvider,{form:c,children:(0,s.jsx)(T,{schema:a})}):null},[a]),k=(0,x.useMemo)(function(){return(0,s.jsxs)(D.Z,{style:{display:"flex",justifyContent:"flex-end",marginBottom:"16px"},children:[r.componentProps.showCancel!==!1?(0,s.jsx)(Z.Z,{loading:y,onClick:R,children:r.componentProps.cancelText||"\u53D6\u6D88"}):null,(0,s.jsx)(Z.Z,{loading:y,onClick:$,type:"primary",children:r.componentProps.okText||"\u786E\u5B9A"})]})},[y,R,$]);return{submit:$,field:r,reset:R,open:j,visible:h,loading:y,body:N,header:A,footer:k}},Br=function(e){var n=ue(),r=n.body,o=n.field,a=n.footer,i=n.header,t=n.loading,c=n.open,v=n.reset,f=n.visible;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Ae.Z,C()(C()({closable:!0,keyboard:!0,width:"68.88%"},e),{},{title:e.title||o.title,onClose:function(){var d;v();for(var h=arguments.length,g=new Array(h),m=0;m<h;m++)g[m]=arguments[m];e==null||(d=e.onClose)===null||d===void 0||d.call.apply(d,[e].concat(g))},visible:f,afterVisibleChange:function(d){d||v(),e.afterVisibleChange(d)},children:[i,r,a]})),(0,s.jsx)(ne,{open:c,field:o,loading:t})]})},He=function(e){var n=ue(),r=n.visible,o=n.body,a=n.field,i=n.footer,t=n.header,c=n.loading,v=n.open,f=n.reset;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Ne.Z,C()(C()({closable:!0,keyboard:!0,width:"68.88%"},e),{},{onCancel:function(d){var h;f(),e==null||(h=e.onCancel)===null||h===void 0||h.call(e,d)},afterClose:function(){var d;f(),e==null||(d=e.afterClose)===null||d===void 0||d.call(e)},open:r,title:e.title||a.title,footer:i,children:[t,o]})),(0,s.jsx)(ne,{open:v,field:a,loading:c})]})},Mr={position:"relative",top:"-3px",left:"4px"},zr=function(e){var n=ue(),r=n.body,o=n.field,a=n.header,i=n.loading,t=n.open,c=n.reset,v=n.submit,f=n.visible;return(0,s.jsx)(ge.Z,C()(C()({},e),{},{title:(0,s.jsxs)(x.Fragment,{children:[(0,s.jsx)("span",{style:Mr,children:o.title||a}),(0,s.jsxs)("div",{children:[o.title?null:a,r]})]}),cancelButtonProps:{loading:i},okButtonProps:{loading:i},onCancel:c,onConfirm:v,open:f,onOpenChange:function(d){var h;d||c(),e==null||(h=e.onOpenChange)===null||h===void 0||h.call(e,d)},children:(0,s.jsx)(ne,{open:t,field:o,loading:i})}))},Kr=function(e){var n=ue(),r=n.body,o=n.field,a=n.footer,i=n.header,t=n.loading,c=n.open,v=n.reset,f=n.visible;return(0,s.jsx)(Oe.Z,C()(C()({},e),{},{trigger:"click",title:e.title||o.title,content:(0,s.jsxs)(s.Fragment,{children:[i,r,a]}),open:f,onOpenChange:function(d){var h;d||v(),e==null||(h=e.onOpenChange)===null||h===void 0||h.call(e,d)},children:(0,s.jsx)(ne,{open:c,field:o,loading:t})}))},J=He;J.Drawer=Br,J.Modal=He,J.Popconfirm=zr,J.Popover=Kr,J.Open=ne;var Qe=function(e){return ve[e%ve.length]},Vr=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],n={emap:e.reduce(function(r,o){return r[o.value]=o.label,r[o.label]=o.value,r},{}),colors:e.reduce(function(r,o,a){var i=o.color||Qe(a);return r[o.value]=i,r[o.label]=i,r},{}),options:e.map(function(r,o){return C()(C()({},r),{},{key:r.value,color:r.color||Qe(o)})})};return n},Hr=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"label",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"value";return e.map(function(o){return{key:o[r],label:o[n],value:o[r],color:o.color}})},Qr=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"label",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"value";return Vr(e.map(function(o){return{key:o[r],label:o[n],value:o[r],color:o.color}}))},X=(0,w.observable)({}),Ur=X,de={},Ue={},Gr=function(e,n){de[e]=function(){return n(Hr).then(function(r){var o=Qr(r);return X[e]=o,X[e]})}},Wr=function(e){(0,W.onFieldMount)("*",function(n){var r,o=(r=n.data)===null||r===void 0?void 0:r.dict;if(o){var a=n.data.dictNoCache;if(!X[o]&&!de[o])throw new Error("\u8BCD\u5178 ".concat(o," \u7684\u52A0\u8F7D\u5668\u4E0D\u5B58\u5728!"),o);if(a!==!0&&X[o])n.setState(function(t){t.dataSource=X[o].options,t.componentProps&&(t.componentProps.options=t.dataSource)});else if(o&&de[o]){n.setState(function(t){t.loading=!0});var i=Ue[o]||de[o]();Ue[o]=i.then(function(t){return n.setState(function(c){c.dataSource=t.options,c.componentProps&&(c.componentProps.options=c.dataSource),c.loading=!1}),t}).catch(function(t){throw n.setState(function(c){c.loading=!1}),t})}}}),(0,W.onFieldReact)("*",function(n){var r,o,a=(r=n.data)===null||r===void 0?void 0:r.dict;if(a){var i=function(v,f){var u=Array.isArray(v)?v[0]:v,d=Array.isArray(f)?f[0]:f;return u===d},t=n.readPretty||n.readOnly;t?i(n.component,he)||(n.data.__origin_component=n.component,n.setComponent(he)):(o=n.data)!==null&&o!==void 0&&o.__origin_component&&!i(n.data.__origin_component,n.component)&&n.setComponent(n.data.__origin_component)}})},Jr=function(e){var n=typeof e=="function"?e():e;return(0,w.isSupportObservable)(n)?(0,w.observable)(n):(console.log("WARNING!!, not support obserable"),n)},Xr=function(e){var n=(0,x.useMemo)(function(){return Jr(e!=null?e:{})},[]);return n}}}]);
